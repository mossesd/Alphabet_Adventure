ponseCacheKey)}async storeMiddleTierResponseAsync(t){await this.cacheManager.setDataAsync(i.MiddleTierResponseCacheKey,t);await this.cacheManager.setDataAsync(i.MiddleTierResponseTimeCacheKey,n.getCurrentTime())}async storeQuerySuggestionsDataAsync(n){await this.cacheManager.setDataAsync(i.SuggestionsCacheKey,n)}async clearMiddleTierResponseAsync(){await this.cacheManager.deleteDataAsync(i.MiddleTierResponseCacheKey);await this.cacheManager.deleteDataAsync(i.MiddleTierResponseTimeCacheKey);await this.cacheManager.deleteDataAsync(i.SuggestionsCacheKey)}async refreshMainPageAsync(t){var h,c,l,a,v,y,p,w,b,k,d;const{shouldFetch:g,shouldRender:nt,isBackgroundUpdate:u}=t;let e;n.msbPerfLogger&&(typeof this.lastMainPagePerfMarkCallId=="undefined"&&(this.lastMainPagePerfMarkCallId=0),e=this.lastMainPagePerfMarkCallId++,n.msbPerfLogger.mark(n.MsbPerfProbe.DsbMainPageRefreshStarted,e));const tt=!g&&nt,o=this.isBundleReloadColdStart();let s=this.suggestionsData;if(o||tt){const t=!(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbDsbNoCache)&&await this.getCachedResponseAsync();if(t?(this.dismissalHistory=await this.cacheManager.getDataAsync(i.FeedDismissalHistoryCacheKey),this.mainPageData=await this.constructMainPageDataAsync(t,this.dismissalHistory,!0),await this.fireDataChangedAsync("MainPageData",e),this.log3SRenderEvents(u,!0)):(this.mainPageData=await this.constructMainPageDataAsync(undefined,undefined,!1),await this.fireDataChangedAsync("MainPageData",e)),n.config.msbDsbRecentQueriesEnabled){const t=(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbDsbNoCache)?undefined:await this.cacheManager.getDataAsync(i.SuggestionsCacheKey);s=t}}if(g){n.msbPerfLogger===null||n.msbPerfLogger===void 0?void 0:n.msbPerfLogger.mark(n.MsbPerfProbe.DsbMainPageRequested,e);const tt=await this.getCachedResponseAsync(),it=i.getAnswersInCacheHashes(tt),rt=n.getCurrentTime();let d="Succeeded",g="";try{const p=await this.recordRequestAsync(f,()=>this.msbServiceClient.getMainPageAsync(it));let r=p.result;g=(h=p.responseContext.serverTraceId)!==null&&h!==void 0?h:"";n.msbPerfLogger===null||n.msbPerfLogger===void 0?void 0:n.msbPerfLogger.mark(n.MsbPerfProbe.DsbMainPageResponded,e);n.msbDsbHost.instrumentationManager.instrumentFetch(rt,n.getCurrentTime());const w=i.getAnswersInCache(tt);if(n.config.msbDsbReplaceFailedAnswers){const n=((a=(l=(c=this.dismissalHistory)===null||c===void 0?void 0:c.dismissedAnswers)===null||l===void 0?void 0:l.length)!==null&&a!==void 0?a:0)>0;r=i.replaceFailedAnswersWithCachedAn