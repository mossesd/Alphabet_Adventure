tes(!1);case 2:case"end":return e.stop()}}),e)})))),(u=this.createPrivacyMessage()).style.marginTop="12px",r.appendChild(u),n.appendChild(r),e.abrupt("return",Promise.resolve(this.utilities.createNotificationModule(n,this.GetNotificationName(),this)));case 25:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"CreateSuccessMessage",value:function(){var e=this;this.utilities.applyStyles(this.flyoutData.common.shopping,this.assets.getStyles());var t=Oi("div",{id:"divCashBackPopup"});t.slot="header-content";var n=Oi("DIV",{className:"lateralMargin"});n.id="divConfirmationCb";var i=Oi("div",{id:"divCashBackTitle"}),r=Oi("h2",{id:"h2RebatesTitle"});r.textContent=this.flyoutData.strings.EnrollSuccessTitle,i.appendChild(r),n.appendChild(i);var o=Oi("span",{className:"txtSmall",style:"line-height: 20px; margin-top: 16px;"}),a=Oi("fluent-anchor",{className:"aLinkCbenroll"});a.appearance="lightweight",a.href="#",a.textContent=this.flyoutData.strings.commonMicrosoftCashback,a.addEventListener("click",(function(){e.pageHandlerModule.NavigateToBingRebatesHistory()})),o.textContent=this.flyoutData.strings.cbConfirmationEnrollBonusSuccessMessage.split("$1")[0],o.appendChild(a);var s=document.createTextNode(this.flyoutData.strings.cbConfirmationEnrollBonusSuccessMessage.split("$1")[1]);return o.appendChild(s),n.appendChild(o),t.appendChild(n),t}},{key:"CreateCashBackHeaderText",value:function(e,t,n,i){var r=this.flyoutData.strings.cbEnrollBonusTitle;this.PopulateCreateCashBackHeaderHtml(e,r,i,!1)}},{key:"PopulateCreateCashBackHeaderHtml",value:function(e,t,n,i){this.flyoutData.strings.cbMainTitleOffWithPdpCashbackEstimate===t||this.flyoutData.strings.cbMainTitleOffWithCashbackEstimate,jn.ReplaceElementInKey(e,t,n),this.flyoutData.common.popupOrigination!==rn.AUTO_SHOW_REBATES_ORGANIC&&this.flyoutData.common.popupOrigination!==rn.AUTO_SHOW_REBATES_ORGANIC_NEW&&this.flyoutData.common.popupOrigination!==rn.AUTO_SHOW_REBATES_CHECKOUT&&this.flyoutData.common.popupOrigination!==rn.AUTO_SHOW_REBATES||(e.style.fontSize="21px",e.style.lineHeight="32px",e.style.fontWeight="600",this.utilities.shouldRenderSmallNotification()&&(e.style.fontSize="20px",e.style.lineHeight="28px"))}},{key:"createPrivacyMessage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"lightweight",n=Oi("span",{id:"divPrivacyMessage",className:"txtSmall"}),i=Oi("fluent-anchor",{className:"aLinkCb"});i.appearance=t,i.href="#",i.textContent=this.flyoutData.strings.commonMicrosoftRewards,i.addEventListener("click",(function(){e.pageHandlerModule.NavigateToMicrosoftRewards()}));var r=Oi("fluent-anchor",{className:"aLinkCb"});r.appearance=t,r.href="#",r.textContent=this.flyoutData.strings.cbPrivacyMessageTerm,r.addEventListener("click",(function(){e.pageHandlerModule.NavigateToTermsStatementFlyout()}));var o=Oi("fluent-anchor",{className:"aLinkCb"});return o.appearance=t,o.href="#",o.textContent=this.flyoutData.strings.cbPrivacyMessagePrivacyCookies,o.addEventListener("click",(function(){e.pageHandlerModule.NavigateToPrivacyCookiesStatement()})),jn.ReplaceElementInKey(n,this.flyoutData.strings.cbEnrollPrivacyMessage,i,r,o),n}}]),e}(),Fne=Bne;function Une(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=S(e);if(t){var r=S(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return b(this,n)}}var Hne=function(e){C(n,e);var t=Une(n);function n(e,i,o){return r(this,n),t.call(this,e,i,o)}return c(n,[{key:"GetPopupOriginationList",value:function(){return[rn.AUTO_SHOW_GIFT_CARD]}},{key:"PostProcessingNotification",value:function(e,t){this.PostProcessing(re.GIFT_CARD,0,t)}},{key:"GetNotificationName",value:function(){return oe.GIFT_CARD}},{key:"ShouldRenderNotification",value:function(){this.pageHandlerModule.TriggerExperiment(h.amazongiftCardExp);var e=v.isExperimentActive(h.amazongiftCardExp),t=this.flyoutData.common.popupOrigination===rn.AUTO_SHOW_GIFT_CARD;return Promise.resolve(t&&e)}},{key:"RenderNotification",value:function(){var e=this.createModule();if(e){var t=this.utilities.createNotificationModule(e,this.GetNotificationName(),this);return Promise.resolve(t)}return Promise.resolve(null)}}]),n}(SZ);function Gne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Vne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gne(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gne(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function jne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=S(e);if(t){var r=S(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return b(this,n)}}var Wne=function(e){C(s,e);var n,o,a=jne(s);function s(e,t,n,i){var o;return r(this,s),u(m(o=a.call(this,e,t,n,i)),"activatedItem",void 0),u(m(o),"categoryTitle",""),u(m(o),"searchResultItem",void 0),u(m(o),"cartNotificationItem",void 0),u(m(o),"shouldShowCategory",void 0),u(m(o),"shouldShowSearch",void 0),u(m(o),"shouldShowCartOffer",void 0),u(m(o),"shouldShowTotalCashback",void 0),u(m(o),"totalCashbackAmount",0),u(m(o),"totalCategoryCashbackAmount",0),u(m(o),"shouldShowRelatedPDPOffer",!1),u(m(o),"autoShowPdpItem",void 0),u(m(o),"shouldRenderPdpItem",void 0),u(m(o),"pdpTraceId",""),u(m(o),"autoShowRelatedItem",void 0),u(m(o),"shouldRenderRelatedItem",void 0),u(m(o),"shouldConfirmActivation",void 0),u(m(o),"shouldConfirmMultipleActivation",void 0),u(m(o),"renderedType",void 0),u(m(o),"activatedCashbackTotal",""),u(m(o),"activatedCashbackImages",[]),u(m(o),"searchTraceId",""),u(m(o),"showConsentNotification",!1),u(m(o),"instantAddToCartEnabled",!1),u(m(o),"relatedPDPOffer",void 0),o.shouldConfirmActivation=!1,o.shouldShowSearch=!1,o.shouldShowTotalCashback=!1,o.shouldRenderPdpItem=!1,o.shouldRenderRelatedItem=!1,o}return c(s,[{key:"GetPopupOriginationList",value:function(){return[rn.AUTO_SHOW_GROCERY_ITEMIZED_CASHBACK,rn.AUTO_SHOW_GROCERY_ITEMIZED_CASHBACK_LANDING]}},{key:"PostProcessingNotification",value:function(e,t){var n=this,i=document.querySelector("#footerDiv #snooze"),r=document.querySelector("#footerDiv #notshow"),o=document.querySelectorAll("#footerDiv #doNotShowOverlay > fluent-menu-item"),a=document.querySelector("#btnFlyoutClose"),s={activatedItem:this.activatedItem,searchResultItem:this.searchResultItem,autoShowPdpItem:this.autoShowPdpItem,autoShowRelatedItem:this.autoShowRelatedItem,relatedPDPOffer:this.relatedPDPOffer};i&&i.addEventListener("click",(function(e){n.telemetryHandler.LogButtonClickICSpecificTelemetry(O.ICGrocerySnoozeButton,void 0,"Snooze button clicked on grocery cashback notification",n.renderedType,{cashbackOffers:s})})),r&&r.addEventListener("click",(function(e){n.telemetryHandler.LogButtonClickICSpecificTelemetry(O.ICGroceryDoNotShowButton,void 0,"Do not show button clicked on grocery cashback notification",n.renderedType,{cashbackOffers:s})})),a&&a.addEventListener("click",(function(e){n.telemetryHandler.LogButtonClickICSpecificTelemetry(O.ICGroceryDismissButton,void 0,"Dismiss button clicked on grocery cashback notification",n.renderedType,{cashbackOffers:s})})),o&&o.forEach((function(e){e.addEventListener("click",(function(t){n.telemetryHandler.LogButtonClickICSpecificTelemetry(O.ICGroceryDoNotShowButtonOption,void 0,JSON.stringify({dontShowOption:e.textContent}),n.renderedType,{cashbackOffers:s})}))}))}},{key:"RenderNotification",value:(o=t(i().mark((function e(){var t,n,r,o,a,s,l,c,u,d,p,h,f,g,v,m,y,C,b,S;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.utilities.applyStyles(this.flyoutData.common.shopping,this.assets.getStyles(),void 0,this.assets.getDarkModeStyles()),e.prev=1,!this.shouldShowCartOffer||!this.cartNotificationItem){e.next=10;break}return this.renderedType=_.PdpItemNotification,t=this.groceryCashbackComponents.createElementCartPageOfferAutoActivation(this.cartNotificationItem,this.renderedType,!0,P.CartPageCashbackNotification,P.CartPageCashbackNotification),n=this.utilities.createNotificationModule(t,this.GetNotificationName(),this),this.telemetryHandler.LogICSpecificTelemetry(P.CartPageCashbackNotification,"",this.renderedType,{requestTraceId:this.pdpTraceId,offerId:this.cartNotificationItem.id,offerItem:this.cartNotificationItem.cashbackProducts[0],productTitle:this.cartNotificationItem.cashbackProducts[0].title,productId:this.cartNotificationItem.cashbackProducts[0].productId}),e.abrupt("return",Promise.resolve(n));case 10:if(!this.shouldRenderRelatedItem||!this.autoShowRelatedItem){e.next=19;break}return this.renderedType=_.RelatedItemNotification,r=this.CreateGroceryOfferNotification(this.autoShowRelatedItem,this.renderedType,P.ICRelatedOfferNotificationHover,P.ICRelatedOfferNotificationClick,!1,!1,!0),o=this.utilities.createNotificationModule(r,this.GetNotificationName(),this),this.storageHandler.clearStorage(dr.ICIsRelatedOffer),this.telemetryHandler.LogICSpecificTelemetry(P.ICRelatedOfferNotification,"",this.renderedType),e.abrupt("return",Promise.resolve(o));case 19:if(!this.shouldRenderPdpItem||!this.autoShowPdpItem){e.next=27;break}return this.renderedType=_.PdpItemNotification,a=this.groceryCashbackComponents.createElementForOfferPdp(this.autoShowPdpItem,this.renderedType,!0,P.ICPdpCashbackNotificationHover,P.ICPdpCashbackNotificationClick),s=this.utilities.createNotificationModule(a,this.GetNotificationName(),this),this.telemetryHandler.LogICSpecificTelemetry(P.ICPdpCashbackNotification,"",this.renderedType,{requestTraceId:this.pdpTraceId,offerId:this.autoShowPdpItem.id,offerItem:this.autoShowPdpItem.cashbackProducts[0],productTitle:this.autoShowPdpItem.cashbackProducts[0].title,productId:this.autoShowPdpItem.cashbackProducts[0].productId}),e.abrupt("return",Promise.resolve(s));case 27:if(!this.shouldConfirmActivation||!this.activatedItem){e.next=36;break}return this.renderedType=_.ActivatedNotification,this.shouldConfirmActivation=!1,l=this.CreateGroceryOfferNotification(this.activatedItem,this.renderedType,P.ICActivatedNotificationHover,P.ICActivatedNotificationClick,!0),c=this.utilities.createNotificationModule(l,this.GetNotificationName(),this),this.telemetryHandler.LogICSpecificTelemetry(P.ICActivatedNotification,"",this.renderedType),e.abrupt("return",Promise.resolve(c));case 36:if(!(this.shouldShowSearch&&this.searchResultItem||this.shouldShowCartOffer)){e.next=45;break}if(this.renderedType=_.PdpNotification,void 0===(u=this.RenderSearchNotificationVariation())){e.next=42;break}return d=this.utilities.createNotificationModule(u,this.GetNotificationName(),this),e.abrupt("return",Promise.resolve(d));case 42:this.telemetryHandler.LogIcError("Error in render search notification",void 0),e.next=85;break;case 45:if(!this.shouldConfirmMultipleActivation){e.next=53;break}return this.renderedType=_.MultipleActivatedNotification,p=this.groceryCashbackComponents.CreateElementForMultipleActivated(this.renderedType,this.activatedCashbackTotal,this.activatedCashbackImages,!0),h=this.utilities.createNotificationModule(p,this.GetNotificationName(),this),this.telemetryHandler.LogICSpecificTelemetry(P.ICMultipleActivatedNotificationRender,"",this.renderedType),e.abrupt("return",Promise.resolve(h));case 53:if(!this.shouldShowTotalCashback){e.next=67;break}return e.next=56,this.storageHandler.getStorageString(dr.GroceryAutoShowData);case 56:if(f=e.sent,"AnyPage"!==(g=JSON.parse(f)).ActiveAutoShowType&&"AmazonFresh"!==g.ActiveAutoShowType||!this.totalCashbackAmount||!(this.totalCashbackAmount>0)){e.next=64;break}return this.renderedType=_.TotalCashBackNotification,v=this.groceryCashbackComponents.CreateElementForTotalCashbackNotification(this.renderedType,this.totalCashbackAmount,!0),m=this.utilities.createNotificationModule(v,this.GetNotificationName(),this),this.telemetryHandler.LogICSpecificTelemetry(P.ICTotalCashbackNotification,"",this.renderedType),e.abrupt("return",Promise.resolve(m));case 64:this.telemetryHandler.LogIcError("Error in rednering total cashback autoshow notification:\n                    Autoshow type: ".concat(null==g?void 0:g.ActiveAutoShowType,",\n                    Valid cashback amount: ").concat(this.totalCashbackAmount&&this.totalCashbackAmount>0),void 0),e.next=85;break;case 67:if(!this.shouldShowCategory){e.next=77;break}if(!(this.totalCategoryCashbackAmount&&this.totalCategoryCashbackAmount>0&&this.categoryTitle)){e.next=74;break}return this.renderedType=_.CategorySearchPage,y=this.groceryCashbackComponents.CreateElementForTotalCashbackWithCategoryNotification(this.renderedType,this.totalCategoryCashbackAmount,this.categoryTitle,!0),C=this.utilities.createNotificationModule(y,this.GetNotificationName(),this),this.telemetryHandler.LogICSpecificTelemetry(P.ICCategoryNotification,"",this.renderedType),e.abrupt("return",Promise.resolve(C));case 74:this.telemetryHandler.LogIcError("\n                    Unable to render category notification. Cashback amount is valid:\n                    ".concat(this.totalCategoryCashbackAmount&&this.totalCategoryCashbackAmount>0,",\n                    Category title is valid: ").concat(!!this.categoryTitle)),e.next=85;break;case 77:if(!this.shouldShowRelatedPDPOffer){e.next=85;break}if(!this.relatedPDPOffer){e.next=84;break}return this.renderedType=_.AddedToCartRelatedItemNotification,b=this.groceryCashbackComponents.createElementForOfferPdpOnAddToCart(this.relatedPDPOffer,this.renderedType,!0,P.ICAddedToCartPDPRelatedOfferHover),S=this.utilities.createNotificationModule(b,this.GetNotificationName(),this),this.telemetryHandler.LogICSpecificTelemetry(P.ICAddedToCartPDPRelatedOfferRender,"",this.renderedType),e.abrupt("return",Promise.resolve(S));case 84:this.telemetryHandler.LogIcError("Unable to render related PDP offer when user adds to cart. Related offer is invalid",void 0);case 85:this.telemetryHandler.LogIcError("Error in render grocery notification. Notification not shown"),e.next=91;break;case 88:e.prev=88,e.t0=e.catch(1),this.telemetryHandler.LogIcError("Error in render grocery notification. Unexpected error",e.t0,this.renderedType);case 91:return e.abrupt("return",Promise.resolve(null));case 92:case"end":return e.stop()}}),e,this,[[1,88]])}))),function(){return o.apply(this,arguments)})},{key:"ShouldRenderNotification",value:(n=t(i().mark((function e(){var t,n,r,o,a,s,l,c,u,p,h,f,g,v,m,y,C,b,S,x,T,k,E,A,O,I,_,D,w,N,M,R,L;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},n=this.flyoutData.common.popupOrigination,r=this.flyoutData.common.openedWith,e.prev=3,!qr.IsGroceryCashbackNotification(n,r)){e.next=130;break}return e.next=7,this.storageHandler.getStorageString(dr.GroceryCashbackItem);case 7:if(!d(s=e.sent))try{this.activatedItem=JSON.parse(s)}catch(e){this.telemetryHandler.LogIcError("Error parsing activatedCashbackData",void 0),a=JSON.stringify(e)}return this.storageHandler.clearStorage(dr.GroceryCashbackItem),e.next=12,this.storageHandler.getStorageString(dr.ICNotificationType);case 12:l=e.sent,(c=this.flyoutData.dataStoreModule.GroceryCashbackData)||(t.isGroceryDataEmpty=!0),null!=c&&null!==(o=c.Cashback)&&void 0!==o&&o.pdpCashBack&&(c.Cashback.pdpCashBack.relatedOffers.length>0||c.Cashback.pdpCashBack.pdpOffer)&&(l=vp.PDP),t.notificationType=l,e.t0=l,e.next=e.t0===vp.ActivatedOffers?21:e.t0===vp.Search?33:e.t0===vp.CategoryAutoshow?51:e.t0===vp.PDP?62:e.t0===vp.GroceryAutoShow?76:e.t0===vp.AddedToCartPDP?91:e.t0===vp.CartPageNotification?102:108;break;case 21:return e.next=23,this.storageHandler.getStorageString(dr.ICActivatedCashbackTotal);case 23:return u=e.sent,this.activatedCashbackTotal=u,e.next=28,this.storageHandler.getStorageString(dr.ICActivatedCashbackImages);case 28:p=e.sent;try{this.activatedCashbackImages=JSON.parse(p).images}catch(e){a=JSON.stringify(e)}return this.shouldConfirmMultipleActivation=!(!u||"0"===u),e.abrupt("break",108);case 33:if(null!=c&&c.searchCategoryData){e.next=36;break}return t.isSearchAndCategoryDataEmpty=!0,e.abrupt("break",108);case 36:if(h=c.searchCategoryData,f=h.shouldAutoshow,g=h.renderedPageType,v=h.cashbackItemsFromSearchAndCategory,m=h.requestTraceId,g&&(this.renderedType=g),this.searchTraceId=m,this.shouldShowSearch=f&&v.length>0,!this.shouldShowSearch){e.next=48;break}return e.next=43,to.GetNotActivatedAndNotSubmittedOffer(this.flyoutData,v,this.storageHandler);case 43:y=e.sent,this.searchResultItem=null!=y?y:v[0],t.searchItem=this.searchResultItem,e.next=50;break;case 48:t.shouldAutoshow=f,t.cashbackItemsFromSearchAndCategory=v.length;case 50:return e.abrupt("break",108);case 51:if(null!=c&&c.searchCategoryData){e.next=54;break}return t.isSearchAndCategoryDataEmpty=!0,e.abrupt("break",108);case 54:return C=c.searchCategoryData,b=C.cashBackOffersTypeTitle,S=C.cashbackItemsFromSearchAndCategory,x=C.renderedPageType,T=C.requestTraceId,this.totalCategoryCashbackAmount=Yp.GetTotalCashback(S),this.categoryTitle=b,x&&(this.renderedType=x),this.searchTraceId=T,this.categoryTitle||(this.categoryTitle="this department"),S.length>0&&this.totalCategoryCashbackAmount>0&&this.categoryTitle&&(this.shouldShowCategory=!0),e.abrupt("break",108);case 62:if(null!=c&&null!==(k=c.Cashback)&&void 0!==k&&k.pdpCashBack){e.next=67;break}return t.isPDpDataEMpty=!0,e.abrupt("break",108);case 67:return e.next=69,to.GetActivatedAndSubmittedIds(this.flyoutData,this.storageHandler);case 69:return A=e.sent,O=c.Cashback.pdpCashBack,this.pdpTraceId=O.requestTraceId,null!==(E=O.pdpOffer)&&void 0!==E&&E.id?A.has(O.pdpOffer.id)?this.activatedItem=O.pdpOffer:(this.autoShowPdpItem=O.pdpOffer,this.shouldRenderPdpItem=!0):O.relatedOffers.length>0&&((I=O.relatedOffers.find((function(e){return!A.has(e.id)&&e.cashbackProducts.length>0}))||O.relatedOffers[0]).id?(this.autoShowRelatedItem=I,this.shouldRenderRelatedItem=!0):t.pdpRelatedOfferNotValid=!0),e.abrupt("break",108);case 76:return e.prev=76,e.next=79,this.storageHandler.getStorageString(dr.GroceryAutoShowData);case 79:_=e.sent,t.autoShowDataStr=_,D=to.ParseWithErrorCatch(_),t.isAutoShowData=!!D,D&&(N=this.flyoutData.dataStoreModule.GroceryCashbackData,t.isGroceryCashbackData=!!N,this.totalCashbackAmount=Yp.GetTotalCashback(null==N||null===(w=N.Cashback)||void 0===w?void 0:w.ItemizedCashback)||D.TotalCashbackAmount,t.totalCashbackAmount=this.totalCashbackAmount,this.totalCashbackAmount>0&&("AnyPage"===D.ActiveAutoShowType||"AmazonFresh"===D.ActiveAutoShowType)&&(this.shouldShowTotalCashback=!0)),t.shouldShowTotalCashback=this.shouldShowTotalCashback,e.next=90;break;case 87:e.prev=87,e.t1=e.catch(76),this.telemetryHandler.LogIcError("Handle GroceryAutoShow notification",e.t1,this.renderedType,t);case 90:return e.abrupt("break",108);case 91:return e.prev=91,e.next=94,this.storageHandler.getStorageString(dr.ICRelatedPDPOffer);case 94:(M=e.sent)&&(R=JSON.parse(M),this.relatedPDPOffer=R.RelatedOffer,this.shouldShowRelatedPDPOffer=!0,this.storageHandler.clearStorage(dr.ICRelatedPDPOffer)),e.next=101;break;case 98:e.prev=98,e.t2=e.catch(91),this.telemetryHandler.LogIcError("Handle AddedToCartPDP notification",e.t2);case 101:return e.abrupt("break",108);case 102:if(null!=c&&c.CartCashbackNotification){e.next=105;break}return e.abrupt("return",Promise.resolve(!1));case 105:return this.shouldShowCartOffer=!0,this.cartNotificationItem=c.CartCashbackNotification,e.abrupt("break",108);case 108:if(this.shouldConfirmActivation=!!this.activatedItem&&l!==vp.Search&&l!==vp.Confirmation,(L=Boolean(this.shouldRenderRelatedItem&&this.autoShowRelatedItem||this.showConsentNotification||this.shouldRenderPdpItem&&this.autoShowPdpItem||this.shouldConfirmActivation&&this.activatedItem||this.shouldShowSearch&&this.searchResultItem||this.shouldConfirmMultipleActivation||this.shouldShowTotalCashback||this.shouldShowCategory||this.shouldShowRelatedPDPOffer||this.shouldShowCartOffer))||l&&l!==vp.Confirmation){e.next=113;break}return e.abrupt("return",Promise.resolve(!1));case 113:if(L){e.next=127;break}return e.t3=this.telemetryHandler,e.t4=P.OnErrorInvoked,e.t5=this.renderedType,e.t6=Vne,e.t7=this.activatedItem,e.t8=a,e.next=122,this.storageHandler.getStorageString(dr.ICCurrentPageInfo);case 122:e.t9=e.sent,e.t10={activatedItem:e.t7,error:e.t8,currentPageInfo:e.t9},e.t11=t,e.t12=(0,e.t6)(e.t10,e.t11),e.t3.LogICSpecificTelemetry.call(e.t3,e.t4,"Grocery Notification Not shown",e.t5,e.t12);case 127:return e.abrupt("return",Promise.resolve(L));case 130:return e.abrupt("return",Promise.resolve(!1));case 132:e.next=138;break;case 134:return e.prev=134,e.t13=e.catch(3),this.telemetryHandler.LogIcError("Error in ShouldRenderNotification for GROCERY_CASHBACK_NOTIFICATION",e.t13,this.renderedType,t),e.abrupt("return",Promise.resolve(!1));case 138:case"end":return e.stop()}}),e,this,[[3,134],[76,87],[91,98]])}))),function(){return n.apply(this,arguments)})},{key:"GetNotificationName",value:function(){return oe.GROCERY_CASHBACK_NOTIFICATION}},{key:"RenderSearchNotificationVariation",value:function(){var e=this.flyoutData.dataStoreModule.GroceryCashbackData,t=null==e?void 0:e.Cashback;if(this.searchResultItem){var n,i=null==t||null===(n=t.Variations)||void 0===n?void 0:n.get("autoShowUX");switch(this.telemetryHandler.LogICSpecificTelemetry(P.ICSearchNotification,"",this.renderedType,{requestTraceId:this.searchTraceId,offerId:this.searchResultItem.id,offerItem:this.searchResultItem.cashbackProducts[0]}),i){case"varation1":case"variation1":return this.CreateGroceryOfferNotificationCompact(this.searchResultItem,this.renderedType,P.ICSearchNotificationHover,P.ICSearchNotificationClick);case"varation2":case"variation2":return this.CreateGroceryOfferNotification(this.searchResultItem,this.renderedType,P.ICSearchNotificationHover,P.ICSearchNotificationClick,!1,!0,!1,!0);default:return this.CreateGroceryOfferNotification(this.searchResultItem,this.renderedType,P.ICSearchNotificationHover,P.ICSearchNotificationClick,!1,!0)}}}},{key:"CreateGroceryOfferNotificationCompact",value:function(e,t,n,i){return this.utilities.applyStyles(this.flyoutData.common.shopping,this.assets.getSmallerNotificationCssStyles(),UZ.ICNotification),this.groceryCashbackComponents.createElementForCompactSearch(e,t,!0,n,i)}},{key:"CreateGroceryOfferNotification",value:function(e,t,n,i,r,o,a,s){var l,c;this.utilities.applyStyles(this.flyoutData.common.shopping,this.assets.getSmallerNotificationCssStyles(),UZ.ICNotification);var u=null===(l=this.flyoutData.dataStoreModule)||void 0===l||null===(l=l.GroceryCashbackData)||void 0===l||null===(l=l.Cashback)||void 0===l||null===(l=l.Variations)||void 0===l?void 0:l.get("userRatings"),d=null===(c=this.flyoutData.dataStoreModule)||void 0===c||null===(c=c.GroceryCashbackData)||void 0===c||null===(c=c.Cashback)||void 0===c||null===(c=c.Variations)||void 0===c?void 0:c.get("shortTitleVariation");return this.groceryCashbackComponents.createElementForOffer(e,t,!0,r,n,null!=o&&o,null!=a&&a,s,u,i,d,this.instantAddToCartEnabled)}}]),s}(JZ),zne=Wne;function Kne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=S(e);if(t){var r=S(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return b(this,n)}}var $ne=function(e){C(s,e);var n,o,a=Kne(s);function s(e,t,n,i){var o;return r(this,s),u(m(o=a.call(this,e,t,n,i)),"rebatesAmount",""),u(m(o),"shouldShowNotificationPending",!1),u(m(o),"shouldShowNotificationActivated",!1),o.rebatesAmount="",o}return c(s,[{key:"GetPopupOriginationList",value:function(){return this.isAnonymousFlowEnabled?[rn.AUTO_SHOW_GROCERY_ITEMIZED_CASHBACK,rn.AUTO_SHOW_PACKAGE_TRACKING,rn.AUTO_SHOW_REBATES_ACTIVATION_FAILED]:[rn.AUTO_SHOW_GROCERY_ITEMIZED_CASHBACK,rn.AUTO_SHOW_PACKAGE_TRACKING]}},{key:"PostProcessingNotification",value:function(e,t){}},{key:"RenderNotification",value:(o=t(i().mark((function e(){var t,n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.utilities.applyStyles(this.flyoutData.common.shopping,this.assets.getStyles(),void 0,this.assets.getDarkModeStyles()),!this.shouldShowNotificationPending&&!this.shouldShowNotificationActivated){e.next=8;break}return t=this.shouldShowNotificationActivated||to.GetIsRebatesUser(this.flyoutData)?P.ICConfirmationNotification:P.ICPendingCashbackNotification,this.LogICSpecificTelemetry(t,""),n=this.CreateCashbackEarnedNotification(),r=this.utilities.createNotificationModule(n,this.GetNotificationName(),this),this.markTransactionAsShown(),e.abrupt("return",Promise.resolve(r));case 8:return e.abrupt("return",Promise.resolve(null));case 9:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"ShouldRenderNotification",value:(n=t(i().mark((function e(){var t,n,r,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ISGroceryCashbackNotification()){e.next=4;break}return e.abrupt("return",Promise.resolve(!1));case 4:return e.next=6,this.storageHandler.getStorageString(dr.ICNotificationType);case 6:if(!(n=e.sent)||n===vp.Confirmation){e.next=11;break}return e.abrupt("return",Promise.resolve(!1));case 11:if(this.storageHandler.clearStorage(dr.GroceryCashbackItem),this.lastGroceryTransaction=this.GetTransactionToShow(),null===(t=this.lastGroceryTransaction)||void 0===t||!t.isShownAsNotification){e.next=16;break}return e.abrupt("return",Promise.resolve(!1));case 16:if(this.lastGroceryTransaction&&this.lastGroceryTransaction.rebatesAmount){e.next=19;break}return e.abrupt("return",Promise.resolve(!1));case 19:if(r=this.isConfirmationPage(),this.rebatesAmount=this.lastGroceryTransaction.rebatesAmount.toFixed(2),this.shouldShowNotificationActivated=void 0===this.lastGroceryTransaction.isActivated||this.lastGroceryTransaction.isActivated,this.shouldShowNotificationPending=!1===this.lastGroceryTransaction.isActivated,!r.isConfirmationPage||r.purchaseIdFromUrl===this.lastGroceryTransaction.transactionId){e.next=28;break}return e.abrupt("return",Promise.resolve(!1));case 28:if(r.isConfirmationPage||this.shouldShowNotificationActivated){e.next=31;break}return e.abrupt("return",Promise.resolve(!1));case 31:return(o=this.shouldShowNotificationActivated||this.shouldShowNotificationPending)||(this.LogICSpecificTelemetry(P.OnErrorInvoked,"Grocery Notification on Confirmation Page Not shown"),this.storageHandler.clearStorage(dr.GroceryCashbackItem)),e.abrupt("return",Promise.resolve(o));case 35:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"GetNotificationName",value:function(){return oe.GROCERY_CASHBACK_PENDING_NOTIFICATION}},{key:"ISGroceryCashbackNotification",value:function(){var e=this.flyoutData.common.popupOrigination===rn.AUTO_SHOW_GROCERY_ITEMIZED_CASHBACK||this.flyoutData.common.popupOrigination===rn.AUTO_SHOW_PACKAGE_TRACKING;return this.isAnonymousFlowEnabled&&(e=e||this.flyoutData.common.popupOrigination===rn.AUTO_SHOW_REBATES_ACTIVATION_FAILED),this.flyoutData.common.openedWith===J.Auto&&e}},{key:"CreateCashbackEarnedNotification",value:function(){return this.utilities.applyStyles(this.flyoutData.common.shopping,this.assets.getSmallerNotificationCssStyles(),UZ.ICNotification),this.createElementForEarnedCashback(!0,this.rebatesAmount,this.shouldShowNotificationActivated)}},{key:"markTransactionAsShown",value:function(){var e=pn(to.lastGroceryTransaction);e.isShownAsNotification=!0,hn(to.lastGroceryTransaction,JSON.stringify(e))}}]),s}(tJ),Yne=$ne;function qne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Xne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qne(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qne(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Zne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=S(e);if(t){var r=S(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return b(this,n)}}var Jne=function(e){C(s,e);var n,o,a=Zne(s);function s(){var e;r(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return u(m(e=a.call.apply(a,[this].concat(n))),"cashbackItem",void 0),u(m(e),"secondaryCashbackOffers",[]),u(m(e),"spbOffersCount",0),u(m(e),"variationToShow",mp.autoActivationVariation),u(m(e),"isExactMatchPdp",!1),u(m(e),"isPdp",!1),u(m(e),"isHomePage",!1),e}return c(s,[{key:"GetPopupOriginationList",value:function(){return[rn.AUTO_SHOW_SPB_CASHBACK_LANDING,rn.AUTO_SHOW_PERSONALIZED_CASHBACK]}},{key:"PostProcessingNotification",value:function(e,t){var n=this,i=document.querySelector("#footerDiv #snooze"),r=document.querySelector("#footerDiv #notshow"),o=document.querySelectorAll("#footerDiv #doNotShowOverlay > fluent-menu-item"),a=document.querySelector("#btnFlyoutClose"),s=JSON.stringify({offer:this.cashbackItem,secondaryOffers:this.secondaryCashbackOffers});i&&i.addEventListener("click",(function(e){n.telemetryHandler.LogButtonClickICSpecificTelemetry(O.ICGrocerySnoozeButton,void 0,"Snooze button clicked on SPB notification",n.renderedPageType,{cashbackOffers:s})})),r&&r.addEventListener("click",(function(e){n.telemetryHandler.LogButtonClickICSpecificTelemetry(O.ICGroceryDoNotShowButton,void 0,"Do not show button clicked on SPB notification",n.renderedPageType,{cashbackOffers:s})})),a&&a.addEventListener("click",(function(e){n.telemetryHandler.LogButtonClickICSpecificTelemetry(O.ICGroceryDismissButton,void 0,"Dismiss button clicked on grocery cashback notification",n.renderedPageType,{cashbackOffers:s})})),o&&o.forEach((function(e){e.addEventListener("click",(function(t){n.telemetryHandler.LogButtonClickICSpecificTelemetry(O.ICGroceryDoNotShowButtonOption,void 0,JSON.stringify({dontShowOption:e.innerHTML}),n.renderedPageType,{cashbackOffers:s})}))}))}},{key:"RenderNotification",value:(o=t(i().mark((function e(){var t,n,r,o,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.flyoutData.dataStoreModule.CashBackData,n=null,this.cashbackItem?(this.utilities.applyStyles(this.flyoutData.common.shopping,this.assets.getStyles()+" "+this.assets.getSpbStyles(),void 0,this.assets.getDarkModeStyles()+" "+this.assets.getSpbStylesDarkMode()),n=this.CreateSpbNotificationDiv(this.cashbackItem),r=Boolean(this.isExactMatchPdp&&this.cashbackItem.isActivated),this.telemetryHandler.LogICSpecificTelemetry(this.isPdp?r?P.ICPdpNotificationSPBActivated:P.ICPdpNotificationSPB:this.isHomePage?P.ICHomeNotificationSPB:P.ICSearchNotificationSPB,JSON.stringify({OffersCount:this.spbOffersCount}),this.renderedPageType,{offerId:this.cashbackItem.id,offerItem:this.cashbackItem.adsOffer})):t&&t.isSpbActivated&&(o=new Wj,this.utilities.applyStyles(this.flyoutData.common.shopping,o.getStyles(),UZ.ICNotification),this.renderedPageType=_.SPBActivatedNotification,n=this.spbActivatedNotificationUtils.createSpbActivatedNotification(t),this.telemetryHandler.LogICSpecificTelemetry(P.SPBActivatedNotificationShown,"SPB activation rendered",this.renderedPageType,{offerId:t.personalizedCashback.offerId,offerItem:t.personalizedCashback.adsCashback[0]})),!n){e.next=8;break}return a=this.utilities.createNotificationModule(n,this.GetNotificationName(),this),e.abrupt("return",Promise.resolve(a));case 8:return this.telemetryHandler.LogIcError("Error in render spb notification. Notification not shown",void 0,this.renderedPageType),e.abrupt("return",Promise.resolve(null));case 10:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"ShouldRenderNotification",value:(n=t(i().mark((function e(){var t,n,r,o,a,s,l,c,u,d,p,f,g,m;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.flyoutData.dataStoreModule.CashBackData,!this.IsItemizedCashBackNotification(t)){e.next=55;break}return e.next=5,this.storageHandler.getStorageString(dr.ICNotificationType);case 5:if(o=e.sent,this.flyoutData.common.popupOrigination!==rn.AUTO_SHOW_PERSONALIZED_CASHBACK||null==t||!t.isSpbActivated){e.next=9;break}return e.abrupt("return",Promise.resolve(!0));case 9:if(a=this.flyoutData.dataStoreModule.SPBItemizedCashbackData){e.next=14;break}return this.telemetryHandler.LogIcError("Error in should render spb notification. No SPBItemizedCashbackData",void 0,this.renderedPageType,{notificationType:o},P.OnErrorInvoked),e.abrupt("return",Promise.resolve(!1));case 14:this.visibilityFeedbackUrlBase=null!==(n=null==a||null===(r=a.AdsMetadata)||void 0===r?void 0:r.visibilityFeedbackUrl)&&void 0!==n?n:"",this.variationToShow=mp.variation1,s={},a.SpbPDPData&&(a.SpbPDPData.RelatedOffers.length>0||a.SpbPDPData.ItemizedCashbackExactMatch)&&(o=vp.PdpSPB),e.t0=o,e.next=e.t0===vp.SpbHomePage?21:e.t0===vp.PdpSPB?24:31;break;case 21:return null!==(l=a.homePageSpbOffers)&&void 0!==l&&l.notificationOffer?(this.isHomePage=!0,this.renderedPageType=_.HomePageNotification,this.cashbackItem=a.homePageSpbOffers.notificationOffer,this.spbOffersCount=a.homePageSpbOffers.homePageSpbOffers.length,this.variationToShow=mp.variation3,this.visibilityFeedbackUrlBase=a.homePageSpbOffers.notificationOffer.visibilityFeedbackUrlBase):s.isSpbHomePageNotificationItemPresent=!1,e.abrupt("break",36);case 24:return this.isPdp=!0,this.visibilityFeedbackUrlBase=(null===(c=a.SpbPDPData)||void 0===c||null===(c=c.AdsMetadata)||void 0===c?void 0:c.visibilityFeedbackUrl)||"",p=null===(u=a.SpbPDPData)||void 0===u?void 0:u.RelatedOffers,(f=null===(d=a.SpbPDPData)||void 0===d?void 0:d.ItemizedCashbackExactMatch)?(this.cashbackItem=f,this.renderedPageType=_.SPBpdpExactMatchNotification,this.spbOffersCount=1,this.isExactMatchPdp=!0,this.variationToShow=mp.variation2):p&&p.length>0&&(this.cashbackItem=p[0],this.renderedPageType=_.SPBpdpNotification,this.spbOffersCount=p.length,null!=a&&a.pdpNotificationVariation&&(this.variationToShow=a.pdpNotificationVariation)),e.abrupt("break",36);case 31:v.isExperimentActive(h.instantAddToCart)||v.isExperimentActive(h.spbAutoActivationOnSearch)||v.getServiceExperimentValue(h.spbSearchAutoActivation)?this.variationToShow=mp.autoActivationVariation:null!=a&&a.searchNotificationVariation&&(this.variationToShow=a.searchNotificationVariation),(g=(null==a?void 0:a.ItemizedCashback)||[]).length>0?(this.cashbackItem=g[0],g.length>1&&(this.secondaryCashbackOffers=g.slice(1,2)),this.renderedPageType=_.SPBSearchNotification,this.spbOffersCount=g.length):s.isCashbackItemsFromSearchAndCategory=!1;case 36:if(m=void 0!==this.cashbackItem){e.next=51;break}return e.t1=this.telemetryHandler,e.t2=void 0,e.t3=this.renderedPageType,e.t4=Xne,e.t5=o,e.next=45,this.storageHandler.getStorageString(dr.ICCurrentPageInfo);case 45:e.t6=e.sent,e.t7={notificationType:e.t5,currentPageInfo:e.t6},e.t8=s,e.t9=(0,e.t4)(e.t7,e.t8),e.t10=P.OnErrorInvoked,e.t1.LogIcError.call(e.t1,"Error in should render spb notification. Cannot show",e.t2,e.t3,e.t9,e.t10);case 51:return e.abrupt("return",Promise.resolve(m));case 55:return e.abrupt("return",Promise.resolve(!1));case 56:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"GetNotificationName",value:function(){return oe.ITEMIZED_CASHBACK_NOTIFICATION}},{key:"IsItemizedCashBackNotification",value:function(e){return this.flyoutData.common.openedWith===J.Auto&&(this.flyoutData.common.popupOrigination===rn.AUTO_SHOW_SPB_CASHBACK_LANDING||this.flyoutData.common.popupOrigination===rn.AUTO_SHOW_PERSONALIZED_CASHBACK&&e&&(null==e?void 0:e.isSpbActivated))}},{key:"CreateSpbNotificationDiv",value:function(e){return this.utilities.applyStyles(this.flyoutData.common.shopping,this.assets.getSmallerNotificationCssStyles(),UZ.ICNotification),this.pickVariation(e,this.variationToShow)}},{key:"pickVariation",value:function(e,t){var n=!this.isExactMatchPdp,i=this.isPdp?P.ICPdpNotificationSPBHover:this.isHomePage?P.ICHomeNotificationSPBHover:P.ICSearchNotificationSPBHover;switch(t){case mp.variation1:return this.createElementForOfferV1(e,this.renderedPageType,i,n);case mp.variation2:return this.createElementForOfferV2(e,this.renderedPageType,i,n);case mp.variation3:return this.createElementForOfferV3And4(e,this.renderedPageType,i,!0);case mp.variation4:return this.createElementForOfferV3And4(e,this.renderedPageType,i,!1);case mp.variation5:return this.createElementForOfferV5(e,this.renderedPageType,i,n);case mp.variation6:return this.createElementForOfferV6(e,this.renderedPageType,i,n);case mp.variation7:return this.createElementForOfferV7(e,this.renderedPageType,i,n);case mp.variation8:return this.createElementForOfferV8(e,this.renderedPageType,i,n);case mp.variation9:return this.createElementForOfferV9(e,this.renderedPageType,i,n);case mp.autoActivationVariation:return this.createElementForOfferV2AutoActivate(e,this.renderedPageType,i,n);default:return this.createElementForOfferV7(e,this.renderedPageType,i,n)}}},{key:"createElementForOfferV9",value:function(e,t,n,i){var r=this.createElementForOfferV1(e,t,n,i,!0),o=r.querySelector(".icTextContainer"),a=null==o?void 0:o.querySelector(".icCashbackContainer");if(o&&a){var s,l=Oi("span",void 0,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(null===(s=e.adsOffer)||void 0===s||null===(s=s.promotionInformation)||void 0===s?void 0:s.rebateValue)),c=Oi("p");c.className="icCashbackText",jn.ReplaceElementInKey(c,this.flyoutData.strings.gcGetCashBack,l),c.style.fontSize="24px",c.style.padding="5px 0",o.replaceChild(c,a)}var u=r.querySelector("#gcActivateBtn");return u&&(u.textContent=this.flyoutData.strings.gcOkButtonText),r}},{key:"createElementForOfferV7",value:function(e,t,n,i){var r=this.createElementForOfferV1(e,t,n,i),o=r.querySelector(".icTextContainer"),a=null==o?void 0:o.querySelector(".icCashbackContainer");if(o&&a){var s,l=Oi("span",void 0,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(null===(s=e.adsOffer)||void 0===s||null===(s=s.promotionInformation)||void 0===s?void 0:s.rebateValue)),c=Oi("p");c.className="icCashbackText",jn.ReplaceElementInKey(c,this.flyoutData.strings.gcGetCashBack,l),c.style.fontSize="24px",c.style.padding="5px 0",o.replaceChild(c,a)}var u=r.querySelector("#gcActivateBtn");return u&&(u.textContent=this.flyoutData.strings.gcOkButtonText),r}},{key:"createElementForOfferV2AutoActivate",value:function(e,t,n,i){var r=this.spbComponentUtils.createElementForOfferAutoActivateCard(e,t,n,this.isPdp,i,!0,this.visibilityFeedbackUrlBase),o=r.rootDiv,a=r.content;if(this.spbOffersCount>1){var s=this.CreateSeeMoreOffersButton(!1);a.appendChild(s)}return(v.isExperimentActive(h.spbAutoActivationOnSearch)||v.getServiceExperimentValue(h.spbSearchAutoActivation))&&this.makeBackgroundActivation(e),o}},{key:"makeBackgroundActivation",value:function(e){var n=this.pageHandlerModule.NavigateToUrlBackgroundWithResult(e.adsOffer.url,e.adsOffer.destinationUrl,!0),r=this;n.then(function(){var n=t(i().mark((function t(n){var o,a,s,l;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=n.result,!(a=to.ParseWithErrorCatch(o))){t.next=15;break}return s=Ur(a.destinationUrl,"msclkid"),l=Ur(e.adsOffer.url,"ld"),r.pageHandlerModule.RefreshDealsResponse(l,s,!1),t.next=12,Rn.Sleep(50);case 12:r.pageHandlerModule.UpdateLoadTimeData(),t.next=16;break;case 15:r.telemetryHandler.LogIcError("Error in render spb auto activate offer. Notification not shown",void 0,this.renderedPageType);case 16:case"end":return t.stop()}}),t,this)})));return function(e){return n.apply(this,arguments)}}())}},{key:"createElementForOfferV8",value:function(e,t,n,i){var r=this.createElementForOfferV1(e,t,n,i),o=r.querySelector("#gcActivateBtn");if(o){var a=this.flyoutData.common.domain.split("."),s=a.length>0?a[0]:"",l=s.charAt(0).toUpperCase()+s.slice(1),c=this.flyoutData.strings.gcGetDealOnRetailer.replace("$1",l);o.textContent=c}return r}},{key:"createElementForOfferV6",value:function(e,t,n,i){if(1===this.spbOffersCount)return this.createElementForOfferV2(e,this.renderedPageType,n,i);this.utilities.applyStyles(this.flyoutData.common.shopping,"msft-edge-shopping::part(header) {\n                margin-top: 0px !important;\n                margin-bottom: 0px !important;\n            }");var r=this.spbComponentUtils.createElementForOfferV6Card(e,t,n,this.isPdp,i,!0,this.visibilityFeedbackUrlBase,this.secondaryCashbackOffers),o=r.rootDiv,a=r.content;if(this.spbOffersCount>1){this.secondaryCashbackOffers[0].visibilityFeedbackUrlBase=this.visibilityFeedbackUrlBase;var s=this.spbComponentUtils.createElementForSecondaryOffer(this.secondaryCashbackOffers[0],t,n,i,this.isPdp);a.appendChild(s)}if(this.spbOffersCount>2){var l=this.CreateSeeMoreOffersButton(!1);a.appendChild(l)}return o}},{key:"createElementForOfferV5",value:function(e,t,n,i){this.utilities.applyStyles(this.flyoutData.common.shopping,this.spbComponentUtils.assetsItemizedCashback.getStyles()+this.spbComponentUtils.assetsItemizedCashback.getVariant5Styles(),void 0,this.spbComponentUtils.assetsItemizedCashback.getDarkModeStyles());var r=this.spbComponentUtils.GetPriceData(e),o=r.discount.amount>this.spbComponentUtils.showDiscountMin,a=this.spbComponentUtils.commonSetUp(e,t,n,this.visibilityFeedbackUrlBase,!0),s=a.rootDiv,l=a.content,c=Oi("DIV");if(c.className="icTextContainer",o){var u=bV(this.flyoutData,"".concat(r.discount.toDisplay," ").concat(this.flyoutData.strings.gcOff));u.className="icPercentOff",l.style.position="relative",l.appendChild(u)}var d=Oi("div");d.className="icCashbackContainer";var p=Oi("p",void 0,r.finalPrice.toDisplay);p.className="icFinalPrice";var h=Oi("p",void 0,r.listPrice.toDisplay);h.className="icListPrice";var f=Oi("p",void 0,"(".concat(r.discount.toDisplay," ").concat(this.flyoutData.strings.gcOff,")"));f.className="icPercentOffText",d.appendChild(p),d.appendChild(h),d.appendChild(f);var g=UV(this.isDarkMode,e.adsOffer.name);g.className="icDescriptionText";var v=this.spbComponentUtils.CreateAdsIconWithText(),m=kV(this.flyoutData,r.cashbackValue.toDisplay,this.isDarkMode,!0);m.className="icWithCashback",c.appendChild(v),c.appendChild(g),c.appendChild(d),c.appendChild(m);var y=this.spbComponentUtils.createCashImageInWrapper(!0,e.imageUrl);y.title=e.adsOffer.name,y.style.flex="1";var C=Oi("DIV");C.className=this.spbComponentUtils.textAndImageContainerClassName,C.appendChild(y);var b=Oi("DIV");b.className="divider",C.appendChild(b),C.appendChild(c);var S=this.spbComponentUtils.CreateActionButton(r.cashbackValue.toDisplay,e,this.isPdp,i,!0,t);if(l.appendChild(C),l.appendChild(S),this.spbOffersCount>1){var x=this.CreateSeeMoreOffersButton(!1);l.appendChild(x)}return s}},{key:"createElementForOfferV3And4",value:function(e,t,n,i){this.utilities.applyStyles(this.flyoutData.common.shopping,this.spbComponentUtils.assetsItemizedCashback.getVariant3Styles(),void 0,this.spbComponentUtils.assetsItemizedCashback.getDarkModeStyles());var r,o=this.spbComponentUtils.commonSetUp(e,t,n,this.visibilityFeedbackUrlBase,!0),a=o.rootDiv,s=o.content,l=Oi("DIV");l.className="icFoundCashbackText",l.style.display="flex",l.style.flexWrap="wrap";var c="",u=Yp.GetCashbackValue(this.flyoutData);if(u)r=this.utilities.createCommissionArrow("$".concat(u),!1,Du.Medium),c=this.flyoutData.strings.gcSpbHomePageText1;else{var d=Yp.GetNumberOfOffers(this.flyoutData);d?(r=Oi("span",void 0,"".concat(d)),c=this.flyoutData.strings.gcSpbHomePageText2):c=this.flyoutData.strings.gcSpbHomePageTextDefault}r?jn.ReplaceElementInKey(l,c,r):l.textContent=c,s.appendChild(l);var p=this.CreateSeeMoreOffersButton(!0,this.flyoutData.strings.gcSeeCashbackDeals);return s.appendChild(p),a}},{key:"createElementForOfferV2",value:function(e,t,n,i){var r=this.spbComponentUtils.createElementForOfferV2Card(e,t,n,this.isPdp,i,!0,this.visibilityFeedbackUrlBase,this.isExactMatchPdp),o=r.rootDiv,a=r.content;if(this.spbOffersCount>1){var s=this.CreateSeeMoreOffersButton(!1);a.appendChild(s)}return o}},{key:"createElementForOfferV1",value:function(e,t,n,i,r){this.utilities.applyStyles(this.flyoutData.common.shopping,this.spbComponentUtils.assetsItemizedCashback.getStyles(),void 0,this.spbComponentUtils.assetsItemizedCashback.getDarkModeStyles());var o=this.spbComponentUtils.GetPriceData(e),a=o.discount.amount>this.spbComponentUtils.showDiscountMin,s=this.spbComponentUtils.commonSetUp(e,t,n,this.visibilityFeedbackUrlBase,!0,r?this.secondaryCashbackOffers:void 0),l=s.rootDiv,c=s.content,u=Oi("DIV");if(u.className="icTextContainer",a){var d=bV(this.flyoutData,"".concat(o.discount.toDisplay," ").concat(this.flyoutData.strings.gcOff));d.className="icPercentOff",c.style.position="relative",c.appendChild(d)}var p=Oi("div");p.className="icCashbackContainer";var h=Oi("p",void 0,o.cashbackValue.toDisplay);h.className="icCashbackValueText";var f=Oi("p",void 0,this.flyoutData.strings.gcCashBack);f.className="icCashbackText",p.appendChild(h),p.appendChild(f);var g=UV(this.isDarkMode,e.adsOffer.name);g.className="icDescriptionText";var v=this.spbComponentUtils.CreateAdsIconWithText();u.appendChild(v),u.appendChild(p),u.appendChild(g);var m=this.spbComponentUtils.createCashImageInWrapper(!0,e.imageUrl);m.title=e.adsOffer.name,m.style.flex="1";var y=Oi("DIV");y.className=this.spbComponentUtils.textAndImageContainerClassName,y.appendChild(m);var C=Oi("DIV");C.className="divider",y.appendChild(C),y.appendChild(u);var b=this.spbComponentUtils.CreateActionButton(o.cashbackValue.toDisplay,e,this.isPdp,i,!0,t);if(c.appendChild(y),c.appendChild(b),r){if(this.spbOffersCount>1){this.secondaryCashbackOffers[0].visibilityFeedbackUrlBase=this.visibilityFeedbackUrlBase;var S=this.spbComponentUtils.createElementForSecondaryOffer(this.secondaryCashbackOffers[0],t,n,i,this.isPdp);c.appendChild(S)}if(this.spbOffersCount>2){var x=this.CreateSeeMoreOffersButton(!1);c.appendChild(x)}}else if(this.spbOffersCount>1){var T=this.CreateSeeMoreOffersButton(!1);c.appendChild(T)}return l}},{key:"CreateSeeMoreOffersButton",value:function(e,t){var n=this,i=e?function(){var e=Oi("fluent-button");return e.setAttribute("appearance","accent"),e.classList.add(_t.PrimaryColor),e}():Di();return i.className="icSeeMoreOffersButton",e||i.classList.add("asLink"),i.textContent=t||this.flyoutData.strings.gcSeeOtherDeals,i.addEventListener("click",(function(e){e.stopPropagation(),n.isHomePage&&n.telemetryHandler.LogICSpecificTelemetry(P.ICHomeNotificationSPBClick,"Home page micro notification clicked for spb",n.renderedPageType),n.telemetryHandler.LogButtonClickICSpecificTelemetry(O.SPBSeeMoreDealsButton,void 0,"See more deals clicked on spb notification",n.renderedPageType),n.pageHandlerModule.OpenPane(n.flyoutData.common.popupOrigination)})),i}}]),s}(vJ),Qne=Jne;function eie(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=S(e);if(t){var r=S(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return b(this,n)}}var tie=function(e){C(n,e);var t=eie(n);function n(e,i,o,a){return r(this,n),t.call(this,e,i,o,a)}return c(n,[{key:"GetPopupOriginationList",value:function(){return[rn.AUTO_SHOW_PACKAGE_TRACKING]}},{key:"PostProcessingNotification",value:function(e,t){t.classList.add("lateralMargin"),t.slot="header-content",this.createButtonContainer(this.flyoutData.common.shopping)}},{key:"GetNotificationName",value:function(){return oe.TRACKING_CONFIRMATION}},{key:"ShouldRenderNotification",value:function(){var e,t,n;if(!0===(null===(e=this.flyoutData)||void 0===e||null===(e=e.dataStoreModule)||void 0===e||null===(e=e.OrderTrackingData)||void 0===e?void 0:e.packageTrackingUserConsented))return Promise.resolve(!1);var i=!0===(null===(t=this.flyoutData)||void 0===t||null===(t=t.dataStoreModule)||void 0===t||null===(t=t.CashBackData)||void 0===t?void 0:t.isConfirmationPage)&&!0===(null===(n=this.flyoutData)||void 0===n||null===(n=n.dataStoreModule)||void 0===n||null===(n=n.OrderTrackingData)||void 0===n?void 0:n.shouldShowPackageTrackingNotification)&&this.flyoutData.common.openedWith===J.Auto&&this.flyoutData.common.popupOrigination===rn.AUTO_SHOW_PACKAGE_TRACKING;return Promise.resolve(i)}},{key:"RenderNotification",value:function(){var e;this.utilities.applyStyles(this.flyoutData.common.shopping,this.assets.getConfirmationNotificationStyles());var t=Oi("DIV",{id:"trackingConfirmationPopup"}),n=this.createPopupContent();if(t.appendChild(n),null!==(e=this.flyoutData)&&void 0!==e&&null!==(e=e.dataStoreModule)&&void 0!==e&&null!==(e=e.CashBackData)&&void 0!==e&&e.isConfirmationPage){var i=Oi("DIV",{style:"display: flex;\n                                                                            align-items: center; justify-content: center;\n                                                                            padding-top: 12px;"}),r=Oi("msft-package-tracker-card-new");r.mainTitle=this.flyoutData.strings.packageTrackingOrderPlaced,r.progressPercentage="15";var o=this.createMainItemImage();r.appendChild(o),i.appendChild(r),t.appendChild(i)}var a=this.utilities.createNotificationModule(t,this.GetNotificationName(),this);return Promise.resolve(a)}},{key:"createPopupContent",value:function(){var e,t=Oi("DIV",{className:"txtMedium"});if(t.className="trackingConfirmationPopupContent",t.style.width="100%",t.style.display="flex",t.style.justifyContent="center",null!==(e=this.flyoutData)&&void 0!==e&&null!==(e=e.dataStoreModule.CashBackData)&&void 0!==e&&e.isConfirmationPage){this.flyoutData.strings.packageTrackingNotificationTitle;"margin: 0px; font-weight: 600; font-size: 20px; line-height: 26px; width: calc(100% - 20px);";var n=Oi("H2",{style:"margin: 0px; font-weight: 600; font-size: 20px; line-height: 26px; width: calc(100% - 20px);"},this.flyoutData.strings.packageTrackingNewNotificationTitle);t.appendChild(n)}return t}},{key:"createMainItemImage",value:function(){var e=Oi("IMG",{style:"width: 40px; height: 40px; float: left;"});return e.src="".concat(this.flyoutData.common.resourcesEndpoint,"retailerBranding/SquareIcons/").concat(this.flyoutData.common.domain,".png"),e.setAttribute("aria-hidden","true"),e.addEventListener("error",(function(){e.style.visibility="hidden"})),e.classList.add("my-main-image"),e.slot="main-image",e}}]),n}(BJ),nie=function(){function e(t,n,i,o){r(this,e),u(this,"utilities",void 0),u(this,"flyoutData",void 0),u(this,"storageHandler",void 0),u(this,"pageHandlerModule",void 0),this.utilities=n.viewModulesUtilities,this.flyoutData=t,this.storageHandler=n.storageHandler,this.pageHandlerModule=n.pageHandlerModule}return c(e,[{key:"GetPopupOriginationList",value:function(){return[rn.AUTO_SHOW_POST_PURCHASE_TRACKING]}},{key:"PostProcessingNotification",value:function(e,t){t.classList.add("lateralMargin"),t.slot="header-content",this.createButtonContainer(this.flyoutData.common.shopping)}},{key:"GetNotificationName",value:function(){return oe.TRACKING_CONFIRMATION}},{key:"ShouldRenderNotification",value:function(){var e,t=v.isExperimentActive(h.postPurchaseTracking),n=this.flyoutData.common.openedWith===J.Auto&&this.flyoutData.common.popupOrigination===rn.AUTO_SHOW_POST_PURCHASE_TRACKING,i=!0===(null===(e=this.flyoutData.dataStoreModule.OrderTrackingData)||void 0===e?void 0:e.priceMatchingUserConsented),r=n&&t&&!i;return Promise.resolve(r)}},{key:"RenderNotification",value:function(){var e=Oi("DIV"),t=this.createConsentCard();e.appendChild(t);var n=this.utilities.createNotificationModule(e,this.GetNotificationName(),this);return Promise.resolve(n)}},{key:"createConsentCard",value:function(){var e=Oi("div",{className:"imageWrapper"}),t=Oi("img",{className:"zeroStateImage"}),n=this.flyoutData.common.resourcesEndpoint+"packageTracking/priceMatch.png";this.utilities.setImageSrc(t,n),t.style.pointerEvents="none",t.style.width="150px",t.style.height="123px",t.setAttribute("aria-hidden","true"),e.appendChild(t),e.slot="image";var i=Oi("msft-consent-card");return i.description=this.flyoutData.strings.postPurchaseTrackingNotificationTitle,i.subtitle=this.flyoutData.strings.postPurchaseTrackingNotificationSubtitle,i.style.minHeight="220px",i.style.height="min-content",i.style.maxHeight="220px",i.appendChild(e),i}},{key:"createButtonContainer",value:function(e){if(e){var t=Oi("div");t.id="trackingConfirmationButtonContainer";var n=Oi("DIV",{id:"trackingOptInButtonContainer"});n.style.padding="0px 16px",n.style.display="flex",n.style.justifyContent="center",this.flyoutData.common.openedWith!==J.Auto&&(n.style.marginTop="10px");var i=this.createOptInButton();n.appendChild(i),t.appendChild(n),e.appendChild(t)}}},{key:"createOptInButton",value:function(){var e=this,t=_i(this.utilities);t.id="trackingOptInButton";var n=this.flyoutData.strings.postPurchaseTrackingNotificationCTA;return t.textContent=n,t.setAttribute("aria-label",n),t.addEventListener("click",(function(){e.storageHandler.setStorageBool(dr.PriceMatchConsent,!0),e.pageHandlerModule.DismissPopup()})),t}}]),e}(),iie=c((function e(){r(this,e),u(this,"timeStamp",void 0),u(this,"allowed",void 0),u(this,"productBestCoupon",void 0)})),rie=function(){function e(){r(this,e)}return c(e,[{key:"getStyles",value:function(){return"\n        msft-edge-shopping::part(header) {\n            margin-top: 0px !important;\n        }\n        #ProductBestCouponNotification {\n            text-align: center;\n        }\n        #header {\n            margin: 0px 0px 4px;\n            font-size: 24px;\n            font-weight: 600;\n            line-height: 32px;\n        }\n        #productName {\n            font-weight: 600;\n            margin: 0px 30px 5px;\n            white-space: nowrap;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            width: 220px;\n        }\n        #applyOnCheckoutTag {\n            font-size: 10px;\n            font-weight: 400;\n            line-height: 14px;\n            margin: 2px 0px 12px;\n            color: #707070;\n        }\n        "}},{key:"getDarkModeStyles",value:function(){return"\n        #applyOnCheckoutTag {\n            color: #E0E0E0;\n        }\n        "}}]),e}(),oie=function(){function e(t,n){r(this,e),u(this,"assets",void 0),u(this,"flyoutData",void 0),u(this,"logModule",void 0),u(this,"storageHandler",void 0),u(this,"pageHandlerModule",void 0),u(this,"utilities",void 0),u(this,"productBestCoupon",void 0),u(this,"telemetryUtilities",void 0),this.assets=new rie,this.flyoutData=t,this.logModule=n.logModule,this.storageHandler=n.storageHandler,this.utilities=n.viewModulesUtilities,this.pageHandlerModule=n.pageHandlerModule,this.telemetryUtilities=n.telemetryHandler}var n,o;return c(e,[{key:"RenderNotification",value:(o=t(i().mark((function e(n){var r,o,a,s,l,c,u,p,h,f,g,v,m,y,C=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=Oi("DIV")).id="ProductBestCouponNotification",this.utilities.applyStyles(a,this.assets.getStyles(),void 0,this.assets.getDarkModeStyles()),this.productBestCoupon.coupon.discountPercent&&((s=Oi("H2")).id="header",s.textContent="Up to ".concat(this.productBestCoupon.coupon.discountPercent,"% off"),s.classList.add("txtInstantSavings"),a.append(s)),null!==(r=this.flyoutData.dataStoreModule.PriceComparisonData)&&void 0!==r&&r.entityName&&((c=Oi("P")).id="productName",c.textContent=null===(l=this.flyoutData.dataStoreModule.PriceComparisonData)||void 0===l?void 0:l.entityName,c.classList.add("txtSmall"),a.append(c)),(u=Oi("fluent-button")).id="bestCouponBtn",u.classList.add("copyCouponBtn"),u.appearance="stealth",u.textContent=this.productBestCoupon.coupon.couponCode,u.setAttribute("aria-label","Best coupon for current product"),(p=Oi("DIV")).style.display="flex",p.style.marginLeft="6px",p.slot="end",p.innerHTML=this.utilities.commonAssets.getCopyIcon(),p.setAttribute("aria-hidden","true"),u.appendChild(p),u.addEventListener("click",t(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:p.innerHTML=C.utilities.commonAssets.getBlueCheckCircle(),C.pageHandlerModule.CopyCoupon(C.productBestCoupon.coupon.couponCode),t=new $i(O.CouponCopied,C.telemetryUtilities.setContentViewed(C.GetNotificationName())),C.pageHandlerModule.RecordAsUserAction(qi.COUPONS_COPIED),C.logModule.LogInfoEvent(A.ButtonClick,"Product best coupon copied",t);case 6:case"end":return e.stop()}}),e)})))),(h=Oi("P")).id="applyOnCheckoutTag",h.textContent=this.flyoutData.strings.pdpApplyBestCoupon,a.append(u),a.append(h),(f=_i(this.utilities)).textContent="Ok",f.className+=" lateralMargin",a.append(f),e.next=30,this.storageHandler.getStorageString(dr.ProductBestCouponConsent);case 30:return g=e.sent,v=d(g)?{}:JSON.parse(g),m=null!==(o=this.flyoutData.common.domain)&&void 0!==o?o:jn.GetDomainName(),f.addEventListener("click",(function(){var e=new $i(O.AutoApplyBestCouponConsent,C.telemetryUtilities.setContentViewed(C.GetNotificationName()));C.pageHandlerModule.RecordAsUserAction(qi.TRY_PRODUCT_BEST_COUPON),C.pageHandlerModule.RecordAsUserEngagement(si.TRY_PRODUCT_BEST_COUPON,C.flyoutData.common.popupOrigination),C.logModule.LogInfoEvent(A.ButtonClick,"",e);var t=new iie;t.timeStamp=(new Date).toUTCString(),t.allowed=!0,t.productBestCoupon=C.productBestCoupon.coupon,v[m]=t;try{C.storageHandler.setStorageString(dr.ProductBestCouponConsent,JSON.stringify(v))}catch(e){}C.pageHandlerModule.DismissPopup()})),y=this.utilities.createNotificationModule(a,this.GetNotificationName(),this),e.abrupt("return",Promise.resolve(y));case 36:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"ShouldRenderNotification",value:(n=t(i().mark((function e(){var t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.flyoutData.common.popupOrigination===rn.AUTO_SHOW_PRODUCT_BEST_COUPON_CONSENT,this.flyoutData.common.openedWith!==J.Auto||!n||null===(t=this.flyoutData.dataStoreModule.ProductBestCouponData)||void 0===t||!t.coupon){e.next=4;break}return this.productBestCoupon=this.flyoutData.dataStoreModule.ProductBestCouponData,e.abrupt("return",Promise.resolve(!0));case 4:return e.abrupt("return",Promise.resolve(!1));case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"GetNotificationName",value:function(){return oe.PRODUCT_BEST_COUPON}},{key:"PostProcessingNotification",value:function(e,t){}},{key:"GetPopupOriginationList",value:function(){return[rn.AUTO_SHOW_PRODUCT_BEST_COUPON_CONSENT]}}]),e}(),aie=oie;function sie(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=S(e);if(t){var r=S(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return b(this,n)}}var lie=function(e){C(n,e);var t=sie(n);function n(e,i,o){return r(this,n),t.call(this,i,o,e)}return c(n,[{key:"GetPopupOriginationList",value:function(){return[rn.AUTO_SHOW_SERVER_DRIVEN_REWARDS]}},{key:"PostProcessingNotification",value:function(e,t){this.PostProcessing(this.GetModuleName(),0,t)}},{key:"RenderNotification",value:function(){var e=Oi("div",{style:"width: 100%;"}),t=Oi("div");t.className="divRewardTitle",t.id="titleRewardTwo",t.textContent=this.flyoutData.strings.rewardTitleRewardTwo;var n=Oi("div");n.className="divRewardDetailsSection",n.id="detailRewardTwo",n.textContent=this.flyoutData.strings.rewardDetailTwo;var i=this.renderIconSetSection(),r=this.renderLearnMoreButton();e.appendChild(t),e.appendChild(n),e.appendChild(i),e.appendChild(r);var o=this.utilities.createNotificationModule(e,this.GetNotificationName(),this);this.disableNotificationHeader();var a=new k(P.RewardNotification);return this.logModule.LogInfoEvent(A.EdgeFlyoutStatus,"User saw reward notification",a,yn.CouponImpressionId),Promise.resolve(o)}},{key:"ShouldRenderNotification",value:function(){var e,t=this.flyoutData.dataStoreModule.RewardData;return Promise.resolve(null!==(e=null==t?void 0:t.shouldRenderRewardNotification)&&void 0!==e&&e)}},{key:"GetNotificationName",value:function(){return oe.REWARD}},{key:"disableNotificationHeader",value:function(){var e=this;zi.queueUpdate((function(){var t=e.flyoutData.common.shopping;t.shadowRoot&&(t.shadowRoot.querySelector(".header").style.display="none")}))}},{key:"renderLearnMoreButton",value:function(){var e=this,t=Oi("fluent-button");return t.classList.add(_t.PrimarySmallNotification),t.id="rewardButtonLearnMore",t.textContent=this.flyoutData.strings.commonLearnMore,t.appearance="accent",t.addEventListener("click",(function(){e.pageHandlerModule.NavigateToRewardsInfo();var t=new $i(O.RewardInfo,e.telemetryUtilities.setContentViewed(e.GetNotificationName()));e.logModule.LogInfoEvent(A.ButtonClick,"User navigated to learn more about rewards",t,yn.CouponImpressionId)})),t}}]),n}(C9),cie=function(){function e(t,n){r(this,e),u(this,"flyoutData",void 0),u(this,"utilities",void 0),u(this,"logModule",void 0),u(this,"sanConsentUtils",void 0),this.flyoutData=t,this.utilities=n.viewModulesUtilities,this.logModule=n.logModule,this.sanConsentUtils=new x9(t,n,Ae.OtherNotification)}return c(e,[{key:"ShouldRenderNotification",value:function(){var e=this.flyoutData.common.popupOrigination===rn.AUTO_SHOW_SAN_CONSENT_CONFIRMATION&&this.flyoutData.common.openedWith===J.Auto&&v.isExperimentActive(h.sanConsent)&&this.sanConsentUtils.CanPromptConsent();return Promise.resolve(e)}},{key:"RenderNotification",value:function(e){var t=this.sanConsentUtils.CreateSANConsentDiv(!1,P.ICSanConsentNotificationHover),n=new k(P.SanConsentViewed);n.Metadata=JSON.stringify({isEu:this.sanConsentUtils.IsEu()}),this.logModule.LogInfoEvent(A.EdgeFlyoutStatus,"SanConsent shown in notification to user",n);var i=this.utilities.createNotificationModule(t,this.GetNotificationName(),this);return Promise.resolve(i)}},{key:"GetNotificationName",value:function(){return oe.SAN_CONSENT_NOTIFICATION}},{key:"PostProcessingNotification",value:function(e,t){}},{key:"GetPopupOriginationList",value:function(){return[rn.AUTO_SHOW_SAN_CONSENT_CONFIRMATION]}}]),e}();function uie(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=S(e);if(t){var r=S(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return b(this,n)}}var die=function(e){C(a,e);var n,o=uie(a);function a(e,t,n,i){return r(this,a),o.call(this,e,t,n,i)}return c(a,[{key:"GetPopupOriginationList",value:function(){return[rn.AUTO_SHOW_SHOPRUNNER]}},{key:"PostProcessingNotification",value:function(e,t){t.classList.add("lateralMargin")}},{key:"GetNotificationName",value:function(){return oe.SHOPRUNNER_SIGN_UP_NOTIFICATION}},{key:"ShouldRenderNotification",value:function(){try{var e;return Br.IsBuildVersionSupported(O9)&&(null===(e=this.flyoutData)||void 0===e||null===(e=e.common)||void 0===e?void 0:e.popupOrigination)===rn.AUTO_SHOW_SHOPRUNNER?Promise.resolve(!0):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}},{key:"RenderNotification",value:(n=t(i().mark((function e(){var t,n,r,o,a,s,l,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.utilities.applyStyles(this.flyoutData.common.shopping,this.assets.getStyles()),this.utilities.applyStyles(this.flyoutData.common.shopping,this.assets.getSignUpNotificationStyles(),void 0,this.assets.getDarkModeStyles()),e.next=4,this.shopRunnerUtilities.isExistingShopRunnerMember();case 4:return n=e.sent,r=Oi("DIV",{id:"shopRunnerPopup"}),o=this.createShoprunnerMSIcon(),r.appendChild(o),a=this.createCustomerIncentiveDiv(n),r.appendChild(a),s=this.createShopRunnerPDPButton(r,n),r.appendChild(s),l=new k(P.ShopRunnerSignUpNotificationShown,void 0,void 0,null===(t=this.flyoutData)||void 0===t||null===(t=t.common)||void 0===t?void 0:t.domain),this.logModule.LogInfoEvent(A.EdgeFlyoutStatus,"Shoprunner signup notification shown - existing member: ".concat(n),l),c=this.utilities.createNotificationModule(r,this.GetNotificationName(),this),e.abrupt("return",Promise.resolve(c));case 16:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"createCustomerIncentiveDiv",value:function(e){var t=Oi("DIV",{id:"shopRunnerPopupContentContainer"}),n=Oi("P"),i=this.flyoutData.strings.shopRunnerNotificationPDPheading,r=Oi("SPAN");r.style.color="#008A21";var o=P9.shopRunnerPDPSavings(this.flyoutData.common.domain),a="".concat(Q.currency).concat(o);r.textContent=jn.ReplaceStringsPlaceholders(a);var s,l=Oi("DIV",{style:"\n                font-size: 18px;\n                font-weight: 600;\n                margin-top: 10px;\n                line-height: 24px;\n            "});jn.ReplaceElementInKey(l,i,r),e?n.textContent=this.flyoutData.strings.shopRunnerConfirmationNotificationSubHead:(s=Oi("H2"),jn.ReplaceElementInKey(s,this.flyoutData.strings.shopRunnerNotificationHeading));var c=Oi("IMG");c.src="".concat(this.flyoutData.common.resourcesEndpoint,e?"shopRunner/shoprunnerPdp.png":"shopRunner/freeShipping.png"),c.setAttribute("aria-hidden","true");var u=Oi("DIV",{style:"\n                margin-top: 15px;\n            "});return t.style.display="flex",t.style.flexDirection="row",e?(u.appendChild(l),u.appendChild(n),n.style.marginTop="3px",t.appendChild(u)):t.appendChild(s),t.appendChild(c),t}},{key:"createShopRunnerPDPButton",value:function(e,n){var r=this,o=_i(this.utilities);return o.textContent=n?this.flyoutData.strings.shopRunnerNotificationApplyText:this.flyoutData.strings.shopRunnerNotificationButtonText,o.addEventListener("click",t(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=new $i(O.ShopRunnerNotificationSeeDetails,r.telemetryUtilities.setContentViewed(r.GetNotificationName())),"User clicked on ShopRunner notification to see more details",r.logModule.LogInfoEvent(A.ButtonClick,"User clicked on ShopRunner notification to see more details",t),r.pageHandlerModule.RecordAsUserAction(qi.SHOPRUNNER_SEEMORE),r.pageHandlerModule.RecordAsUserEngagement(si.SHOPRUNNER_SEEMORE,r.flyoutData.common.popupOrigination),r.pageHandlerModule.DismissPopup();case 6:case"end":return e.stop()}}),e)})))),o}}]),a}(w9),pie=die;function hie(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=S(e);if(t){var r=S(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return b(this,n)}}var fie=function(e){C(s,e);var n,o,a=hie(s);function s(e,t,n,i){var o;return r(this,s),u(m(o=a.call(this,e,t,n,i)),"shippingFeeCost",void 0),o}return c(s,[{key:"GetPopupOriginationList",value:function(){return[rn.AUTO_SHOW_SHOPRUNNER]}},{key:"PostProcessingNotification",value:function(e,t){t.classList.add("lateralMargin")}},{key:"GetNotificationName",value:function(){return oe.SHOPRUNNER_SHIPPING_FEE_SAVINGS_NOTIFICATION}},{key:"ShouldRenderNotification",value:(o=t(i().mark((function e(){var t,n,r,o,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((null===(t=this.flyoutData)||void 0===t||null===(t=t.common)||void 0===t?void 0:t.popupOrigination)===rn.AUTO_SHOW_SHOPRUNNER){e.next=2;break}return e.abrupt("return",!1);case 2:if((o=null===(n=this.flyoutData)||void 0===n||null===(n=n.dataStoreModule)||void 0===n||null===(n=n.ApiData)||void 0===n||null===(n=n.retailerData)||void 0===n||null===(n=n.GetCurrentCheckoutPage(null===(r=this.flyoutData)||void 0===r||null===(r=r.common)||void 0===r?void 0:r.lastCommittedURL))||void 0===n?void 0:n.shipmentSelector)&&!d(o)){e.next=5;break}return e.abrupt("return",!1);case 5:return e.next=7,this.storageHandler.getStorageString(dr.ShippingFee);case 7:if(!d(a=e.sent)){e.next=10;break}return e.abrupt("return",!1);case 10:return this.shippingFeeCost=JSON.parse(a),e.abrupt("return",!d(this.shippingFeeCost));case 12:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"RenderNotification",value:(n=t(i().mark((function e(){var t,n,r,o,a,s,l,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.utilities.applyStyles(this.flyoutData.common.shopping,this.assets.getStyles()),this.utilities.applyStyles(this.flyoutData.common.shopping,this.assets.getShippingFeeSavingsNotificationStyles()),e.next=4,this.shopRunnerUtilities.isExistingShopRunnerMember();case 4:return n=e.sent,r=Oi("DIV",{id:"shopRunnerPopup"}),n?(o=this.createConfirmationDiv(),r.appendChild(o)):(a=this.createShippingFeeSavingsContentForNewShopRunnerMembers(),r.appendChild(a),s=this.createShopRunnerSignUpButton(r),r.appendChild(s)),l=new k(P.ShopRunnerShippingFeeSavingsNotificationShown,void 0,void 0,null===(t=this.flyoutData)||void 0===t||null===(t=t.common)||void 0===t?void 0:t.domain),this.logModule.LogInfoEvent(A.EdgeFlyoutStatus,"Shoprunner shipping fee savings notification shown - existing member: ".concat(n),l),c=this.utilities.createNotificationModule(r,this.GetNotificationName(),this),e.abrupt("return",Promise.resolve(c));case 11:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"createShoprunnerMSIcon",value:function(){var e=Oi("DIV");return e.id="shopRunnerMSIcon",this.flyoutData.common.isPane&&(e.style.marginTop="10px"),e.setAttribute("aria-hidden","true"),e.innerHTML=this.commonAssets.getShoprunnerMSLogo(),e}},{key:"createShippingFeeSavingsContentForNewShopRunnerMembers",value:function(){var e=Oi("DIV",{id:"shopRunnerShippingFeeSavingsContentContainer"}),t=Oi("DIV"),n=Oi("H2",{},jn.ReplaceValueInKey("shopRunnerShippingFeeSavingsNotificationHeading",this.flyoutData.strings.shopRunnerShippingFeeSavingsNotificationHeading,this.shippingFeeCost)),i=Oi("H4",{},this.flyoutData.strings.shopRunnerShippingFeeSavingsNotificationSubHeading),r=Oi("IMG"),o=this.utilities.isDarkMode()?"ShopRunnerLogoNegative.png":"ShopRunnerLogoPositive.png";return r.src="".concat(this.flyoutData.common.resourcesEndpoint,"shopRunner/").concat(o),t.appendChild(n),t.appendChild(i),e.appendChild(t),e.appendChild(r),e}},{key:"createShopRunnerSignUpButton",value:function(e){var n=this,r=_i(this.utilities);return r.id="shopRunnerSignUpButton",r.textContent=this.flyoutData.strings.shopRunnerShippingFeeSavingsNotificationSignUpButtonText,r.setAttribute("aria-live","assertive"),r.addEventListener("click",t(i().mark((function t(){var r,o,a;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=new $i(O.ShopRunnerShippingFeeSavingsNotificationSeeDetails,n.telemetryUtilities.setContentViewed(n.GetNotificationName())),"User clicked on ShopRunner shipping fee savings notification to see more details",n.logModule.LogInfoEvent(A.ButtonClick,"User clicked on ShopRunner shipping fee savings notification to see more details",r),n.pageHandlerModule.RecordAsUserAction(qi.SHOPRUNNER_SEEMORE),n.pageHandlerModule.RecordAsUserEngagement(si.SHOPRUNNER_SEEMORE,rn.AUTO_SHOW_SHOPRUNNER),o=n.getMainContainer(),a=window.trustedTypes.emptyHTML,null!=e&&(e.innerHTML=a,e.appendChild(o));case 8:case"end":return t.stop()}}),t)})))),r}}]),s}(pie),gie=fie;function vie(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=S(e);if(t){var r=S(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return b(this,n)}}var mie=function(e){C(a,e);var n,o=vie(a);function a(){return r(this,a),o.apply(this,arguments)}return c(a,[{key:"GetPopupOriginationList",value:function(){return[rn.AUTO_SHOW_SHOPRUNNER_CONFIRMATION]}},{key:"GetNotificationName",value:function(){return oe.SHOPRUNNER_CONFIRMATION_NOTIFICATION}},{key:"PostProcessingNotification",value:function(e,t){var n=this;rS(S(a.prototype),"PostProcessingNotification",this).call(this,e,t),setTimeout((function(){n.pageHandlerModule.DismissPopup()}),4500)}},{key:"ShouldRenderNotification",value:(n=t(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Br.IsBuildVersionSupported(O9)){e.next=2;break}return e.abrupt("return",Promise.resolve(!1));case 2:if(this.flyoutData.common.popupOrigination===rn.AUTO_SHOW_SHOPRUNNER_CONFIRMATION){e.next=4;break}return e.abrupt("return",Promise.resolve(!1));case 4:return e.abrupt("return",Promise.resolve(!0));case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"RenderNotification",value:function(){this.utilities.applyStyles(this.flyoutData.common.shopping,this.assets.getConfirmationNotificationStyles());var e=Oi("DIV",{id:"shopRunnerConfirmationMainContainer"}),t=Oi("DIV",{id:"shopRunnerConfirmationTextContainer",className:"txtMedium"}),n=Oi("H2",{id:"shopRunnerConfirmationTextTitle"},this.flyoutData.strings.shopRunnerConfirmationNotificationTitle),i=Oi("H3",{id:"shopRunnerConfirmationTextTitle"},this.flyoutData.strings.shopRunnerConfirmationNotificationText);t.appendChild(n),t.appendChild(i);var r=Oi("IMG"),o=this.utilities.isDarkMode()?"ShopRunnerLogoNegative.png":"ShopRunnerLogoPositive.png";r.src="".concat(this.flyoutData.common.resourcesEndpoint,"shopRunner/").concat(o),e.appendChild(t),e.appendChild(r);var a=this.utilities.createNotificationModule(e,this.GetNotificationName(),this);return Promise.resolve(a)}}]),a}(pie),yie=mie,Cie=function(){function e(t,n,i){r(this,e),u(this,"logModule",void 0),u(this,"utilities",void 0),u(this,"pageHandlerModule",void 0),u(this,"flyoutData",void 0),u(this,"notificationType",void 0),u(this,"productTrackingViewUtilities",void 0),u(this,"productTrackingUtilities",void 0),u(this,"stateManagement",void 0),u(this,"telemetryUtilities",void 0),this.utilities=i.viewModulesUtilities,this.pageHandlerModule=i.pageHandlerModule,this.flyoutData=n,this.logModule=i.logModule,this.productTrackingViewUtilities=new oQ(i,n,t),this.productTrackingUtilities=new NI(i,this.flyoutData,this.stateManagement),this.stateManagement=t,this.telemetryUtilities=i.telemetryHandler}var n,o,a;return c(e,[{key:"GetPopupOriginationList",value:function(){return[rn.AUTO_SHOW_SERVER_DRIVEN_NOTIFICATION]}},{key:"PostProcessingNotification",value:function(e,t){var n=this.getProductData();if(e===oe.PRODUCT_TRACKING_PRICE_DROP_NOTIFICATION)this.productTrackingUtilities.ResetOutOfFlowNotificationFrequency(),this.stateManagement.setState(ir.outOfFlow,an.PRODUCT_TRACKING_EXP_PRICE_DROP),this.pageHandlerModule.OnOpenNotification(an.PRODUCT_TRACKING_EXP_PRICE_DROP,"","");else if(e===oe.ViewedProductPriceDrop){var i;this.stateManagement.setState(ir.outOfFlow,an.PRODUCT_TRACKING_IMP_PRICE_DROP),this.pageHandlerModule.OnOpenNotification(an.PRODUCT_TRACKING_IMP_PRICE_DROP,null==n?void 0:n.ProductUrl,null==n||null===(i=n.CurrentPrice)||void 0===i?void 0:i.toString())}"ProductTrackingData"===this.notificationType&&this.productTrackingUtilities.LogProductNotification(this.flyoutData.common.muid,null==n?void 0:n.ProductUrl)}},{key:"RenderNotification",value:(a=t(i().mark((function e(){var t,n,r,o,a,s,l,c,u,d,p;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.getProductData())){e.next=29;break}if((n=Oi("msft-notification-header")).slot="header-content",r=t.CurrencySymbol||"$",o="".concat(r).concat(this.utilities.formatPrice(t.CurrentPrice)),a="".concat(r).concat(this.utilities.formatPrice(t.basePrice)),s="".concat(r).concat(this.utilities.formatPrice(t.basePrice-t.CurrentPrice)),n.title="Price dropped",n.savings=s,n.oldPrice=a,n.currentPrice=o,l=Oi("IMG"),t.imageUrl&&""!==t.imageUrl&&(t.imageUrl.startsWith("http")||t.imageUrl.startsWith("data:image")||(t.imageUrl="https://"+t.imageUrl),l.src=t.imageUrl),(c=this.utilities.createProductImage(88,88,l,t.Title)).slot="image",n.appendChild(c),(u=this.renderShopButton(t.domain||"",t.ProductUrl)).style.placeSelf="center",u.slot="actions",this.flyoutData.common.shopping.appendChild(u),"ProductTrackingData"!==this.notificationType){e.next=26;break}return e.next=24,this.renderTrackingToggle(t);case 24:(d=e.sent)&&this.flyoutData.common.shopping.appendChild(d);case 26:return this.flyoutData.common.shopping.classList.add("noSections"),p=this.utilities.createNotificationModule(n,this.GetNotificationName(),this),e.abrupt("return",Promise.resolve(p));case 29:return e.abrupt("return",Promise.resolve(null));case 30:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"ShouldRenderNotification",value:(o=t(i().mark((function e(){var t,n,r,o,a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.flyoutData,r=n.common,o=n.dataStoreModule,r.openedWith===J.Auto&&r.popupOrigination===rn.AUTO_SHOW_SERVER_DRIVEN_NOTIFICATION){e.next=3;break}return e.abrupt("return",!1);case 3:if(!((a=o.ProductTrackingNotificationData)&&(null===(t=a.PriceDropProducts)||void 0===t?void 0:t.length)>0)){e.next=12;break}return this.notificationType="ProductTrackingData",o.ProductTrackingData||(o.ProductTrackingData=new Ud(void 0)),o.ProductTrackingData._currentProduct=null==a?void 0:a.PriceDropProducts[0],e.abrupt("return",!0);case 12:if(s=o.ViewedProductListData,this.pageHandlerModule.TriggerExperiment(h.priceDropNotification),!s||null==s||!s.productShowItem){e.next=17;break}return this.notificationType="ViewedProductData",e.abrupt("return",v.isExperimentActive(h.priceDropNotification));case 17:return e.abrupt("return",!1);case 18:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"GetNotificationName",value:function(){return"ProductTrackingData"===this.notificationType?oe.PRODUCT_TRACKING_PRICE_DROP_NOTIFICATION:oe.ViewedProductPriceDrop}},{key:"renderTrackingToggle",value:(n=t(i().mark((function e(t){var n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.productTrackingViewUtilities.shouldRenderProductTrackingUtilities(t.ProductUrl)){e.next=8;break}return(n=new Er(t.Title,t.imageUrl||"",t.CurrencySymbol)).ProductUrl=t.ProductUrl,n.price=t.CurrentPrice.toString(),e.next=6,this.productTrackingViewUtilities.createTrackingToggleSection(n,!1,this.GetNotificationName());case 6:return r=e.sent,e.abrupt("return",r);case 8:return e.abrupt("return");case 9:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getProductData",value:function(){var e,t=this.flyoutData.dataStoreModule,n=t.ViewedProductListData,i=t.ProductTrackingNotificationData;if("ViewedProductData"===this.notificationType){var r=new Ld(void 0),o=null==n?void 0:n.productShowItem;if(!o)return;return r.domain=o.domain,r.Title=o.title,r.CurrencySymbol=o.currencySymbol,r.ProductUrl=o.productUrl,r.imageUrl=o.imageUrl,r.CurrentPrice=o.currentPrice,r.basePrice=o.olderPrice,r}return null==i||null===(e=i.PriceDropProducts)||void 0===e?void 0:e[0]}},{key:"renderShopButton",value:function(e,t){var n=this,i=_i(this.utilities);return i.classList.add("lateralMargin"),i.style.marginBottom="0px",i.textContent=jn.ReplaceValueInKey("prodHPriceDropViewAt",this.flyoutData.strings.prodHPriceDropViewAt,e),i.title=jn.ReplaceValueInKey("prodHPriceDropViewAt",this.flyoutData.strings.prodHPriceDropViewAt,e),i.addEventListener("click",(function(){if(t.startsWith("http")||(t="https://"+t),"ViewedProductData"===n.notificationType){n.pageHandlerModule.RecordAsUserAction(qi.PWILO_NOTIFICATION_PRICE_DROP),n.pageHandlerModule.RecordAsUserEngagement(si.PWILO_NOTIFICATION_PRICE_DROP,n.flyoutData.common.popupOrigination);var i=new $i(O.PriceDropProductPage,n.telemetryUtilities.setContentViewed(n.GetNotificationName()),n.flyoutData.common.domain,e);n.logModule.LogInfoEvent(A.ButtonClick,"User navigated to retailer page with price drop product",i,yn.CouponImpressionId)}else{n.pageHandlerModule.RecordAsUserAction(qi.PRODUCT_TRACKING_PRODUCT_NOTIFICATION_CLICK),n.pageHandlerModule.RecordAsUserEngagement(si.PRODUCT_TRACKING_PRODUCT_NOTIFICATION_CLICK,n.flyoutData.common.popupOrigination);var r=new $i(O.ProductTrackingPriceDropVisitItem,n.telemetryUtilities.setContentViewed(n.GetNotificationName()),n.flyoutData.common.domain,JSON.stringify(n.getProductData()));n.logModule.LogInfoEvent(A.ButtonClick,"User navigated to retailer page with price drop product",r,yn.CouponImpressionId)}setTimeout((function(){n.pageHandlerModule.NavigateToUrl(t)}),10)})),i}}]),e}(),bie=Cie;function Sie(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=S(e);if(t){var r=S(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return b(this,n)}}var xie=function(e){C(n,e);var t=Sie(n);function n(e,i,o){var a;return r(this,n),u(m(a=t.call(this,i,o)),"stateManagement",void 0),u(m(a),"ShouldRenderNotification",(function(){var e;return Promise.resolve(!0===(null===(e=a.flyoutData.dataStoreModule.VirtualCardData)||void 0===e?void 0:e.hasError))})),u(m(a),"GetNotificationName",(function(){return oe.VIRTUAL_CARD})),a.flyoutData=i,a.utilities=o.viewModulesUtilities,a.logModule=o.logModule,a.pageHandlerModule=o.pageHandlerModule,a.stateManagement=e,a}return c(n,[{key:"GetPopupOriginationList",value:function(){return[]}},{key:"PostProcessingNotification",value:function(e,t){}},{key:"RenderNotification",value:function(){var e,t,n,i,r=this;this.strings=this.GetStringForCurrentProvider(),this.utilities.applyStyles(this.flyoutData.common.shopping,this.assets.getNotificationStyles());var o=document.createElement("div");o.id="virtual-card-notification",this.applyStyle(o,{textAlign:"center"});var a=document.createElement("div");this.applyStyle(a,{backgroundImage:'url("data:image/png;base64,'.concat(this.assets.getErrorImage(),'")'),backgroundRepeat:"no-repeat",backgroundSize:"cover",height:"90px",margin:"0 auto",position:"relative",width:"90px"}),o.appendChild(a);var s=document.createElement("h2");s.textContent=this.flyoutData.strings.virtualCardSystemFailureHeader,s.classList.add("txtLarge"),o.appendChild(s);var l=document.createElement("div");l.classList.add("description"),l.textContent=jn.ReplaceValueInKey("virtualCardSystemFailureDescription",this.flyoutData.strings.virtualCardSystemFailureDescription,null!==(e=null===(t=this.strings)||void 0===t?void 0:t.payment)&&void 0!==e?e:""),o.appendChild(l);var c=document.createElement("fluent-button");c.classList.add("detail-button"),c.textContent=jn.ReplaceValueInKey("virtualCardSystemFailurebutton",this.flyoutData.strings.virtualCardSystemFailureLink,null!==(n=null===(i=this.strings)||void 0===i?void 0:i.payment)&&void 0!==n?n:""),c.addEventListener("click",(function(){var e,t;r.pageHandlerModule.NavigateToUrl(null!==(e=null===(t=r.strings)||void 0===t?void 0:t.cardUrl)&&void 0!==e?e:"")})),zi.queueUpdate((function(){var e;null===(e=c.shadowRoot)||void 0===e||null===(e=e.querySelector(".control"))||void 0===e||e.setAttribute("style","\n                width: 100%;\n                height: 100%;\n                border: none;\n                font-size: 16px;\n            ")})),o.appendChild(c);var u=this.utilities.createNotificationModule(o,this.GetNotificationName(),this);return Promise.resolve(u)}}]),n}(H7);function Tie(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return kie(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return kie(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function kie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var Eie=function(){function e(t,n,i,o,a){r(this,e),u(this,"flyoutData",void 0),u(this,"stateManagement",void 0),u(this,"utilities",void 0),u(this,"pageHandlerModule",void 0),u(this,"telemetryHandler",void 0),u(this,"commonAssets",void 0),u(this,"logModule",void 0),u(this,"autoOpenControllerUtilities",void 0),u(this,"manageNotificationMenu",void 0),u(this,"manageSettingsMenu",void 0),u(this,"backgroundOverlay",void 0),u(this,"storageHandler",void 0),this.flyoutData=t,this.utilities=n.viewModulesUtilities,this.pageHandlerModule=i,this.telemetryHandler=n.telemetryHandler,this.logModule=o,this.stateManagement=a,this.commonAssets=n.commonAssets,this.autoOpenControllerUtilities=n.autoOpenControllerUtilities,this.storageHandler=n.storageHandler}var n,o,a;return c(e,[{key:"createSettingsMenu",value:(a=t(i().mark((function e(t,n){var r=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n&&(this.isDisableOptOutMenuActive()||(this.stateManagement.getState(ir.modulesRendered)&&this.createContextMenu(t,n),this.stateManagement.addEventListener(nr.ModulesRendered,(function(){r.createContextMenu(t,n)})))),zi.queueUpdate((function(){r.addListenerMenuItemKeyboardClick(t)}));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"handleClickOutsideMenu",value:function(e,t){var n=this;e.addEventListener("click",(function(e){var i,r;null!==(i=e.target.id)&&void 0!==i&&i.includes("main-background-overlay")&&("hide"!==t.className&&(t.className="hide"),null===(r=n.backgroundOverlay)||void 0===r||r.classList.add("hide"))}))}},{key:"manageMenuEvents",value:function(e,t){var n=this;e.addEventListener("keydown",(function(t){var i;if("Escape"===t.key)e.className="hide",null===(i=n.backgroundOverlay)||void 0===i||i.classList.add("hide"),t.preventDefault();else if("Tab"===t.key){var r;"btnFeedbackDislike"!==(null===(r=t.target)||void 0===r?void 0:r.id)||t.shiftKey||t.preventDefault()}}));var i=!1;this.stateManagement.addEventListener(nr.ShoppingSettingsOpened,(function(){var r;if(n.manageNotificationMenu&&"hide"!==n.manageNotificationMenu.className)n.manageNotificationMenu.classList.add("hide");else if(n.manageSettingsMenu&&"hide"!==n.manageSettingsMenu.className)n.manageSettingsMenu.classList.add("hide");else{null===(r=n.backgroundOverlay)||void 0===r||r.classList.toggle("hide");var o,a=Tie(document.querySelectorAll("fluent-menu[slot='start-content'], msft-cashback-header-card"));try{for(a.s();!(o=a.n()).done;){var s=o.value;s!==e&&s.classList.add("hide")}}catch(e){a.e(e)}finally{a.f()}e.classList.toggle("hide"),"hide"!==e.className&&t&&n.flyoutData.common.openedWith!==J.Auto&&!i&&(n.telemetryHandler.recordContentViewed(re.FEEDBACK,yn.EdgeImpressionId,!1,-1),i=!0)}}))}},{key:"addListenerMenuItemKeyboardClick",value:function(e){var t=this,n=e.querySelectorAll("fluent-menu-item:not(#manage-notification-button, #manage-notification-header, #manage-settings-button, #manage-settings-header,                 #manage-notification-menu fluent-menu-item, #manage-settings-menu fluent-menu-item)"),i=e.querySelector("#".concat(be.MENU_CONTENT)),r=e.querySelector("#".concat(be.MENU));n&&n.length>0&&i&&r&&n.forEach((function(e){t.utilities.makeHtmlElementKeyboardClickable(e,(function(){t.handlerMenuItemKeyboardClick(i,r)}))}))}},{key:"handlerMenuItemKeyboardClick",value:function(e,t){e.className="hide",t.setAttribute("aria-expanded","undefined"),t.focus()}},{key:"createContextMenu",value:(o=t(i().mark((function e(t,n){var r,o,a,s,l=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=t.querySelector("#".concat(be.MENU_CONTENT)))&&r.remove(),e.next=4,this.createContextMenuDiv(t);case 4:o=e.sent,this.manageMenuEvents(o,this.stateManagement),this.handleClickOutsideMenu(n,o),a=t.querySelector("#manage-notification-button"),this.manageNotificationMenu&&a&&this.handleClickOutsideMenu(n,this.manageNotificationMenu),s=t.querySelector("#manage-settings-button"),this.manageSettingsMenu&&s&&this.handleClickOutsideMenu(n,this.manageSettingsMenu),this.manageNotificationMenu&&this.manageNotificationMenu.addEventListener("keydown",(function(e){"Escape"===e.key&&(l.manageNotificationMenu.className="hide",e.preventDefault())})),this.manageSettingsMenu.addEventListener("keydown",(function(e){"Escape"===e.key&&(l.manageSettingsMenu.className="hide",e.preventDefault())}));case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"addManageNotificationItem",value:function(e,t){var n=this,i=document.createElement("DIV");i.innerHTML=this.commonAssets.getRightArrowIcon(),i.slot="end",i.style.display="flex",i.style.marginRight="0",i.setAttribute("aria-hidden","true");var r=document.createElement("fluent-menu-item");r.style.fontSize="12px";var o=document.createElement("DIV");o.innerHTML=this.commonAssets.getNotificationIcon(),o.style.display="flex",o.slot="start",o.setAttribute("aria-hidden","true"),r.title=this.flyoutData.strings.commonManageNotifications,r.textContent=this.flyoutData.strings.commonManageNotifications,r.id="manage-notification-button",r.className+="defaultFontFamily",r.appendChild(o),r.appendChild(i.cloneNode(!0));try{this.manageNotificationMenu||(this.manageNotificationMenu=new Ate(this.flyoutData,this.utilities,this.autoOpenControllerUtilities,this.stateManagement,this.pageHandlerModule,this.logModule,e).renderMenuModule(),t.querySelector("#".concat(this.manageNotificationMenu.id))||(t.appendChild(this.manageNotificationMenu),zi.queueUpdate((function(){n.manageNotificationMenu.setAttribute("slot","start-content")}))))}catch(e){var a=new k(P.OnErrorInvoked);this.logModule.LogErrorEvent(A.EdgeFlyoutStatus,"Error creating manage notifications menu ".concat(Ru.GetErrorString(e)),a)}var s=function(t){n.manageNotificationMenu.classList.remove("hide"),e.classList.add("hide"),t.stopPropagation();var i=new $i(O.ManageNotification,Ji.MENU);n.logModule.LogInfoEvent(A.ButtonClick,"Manage Notification button clicked",i)};r.addEventListener("click",s),this.utilities.makeHtmlElementKeyboardClickable(r,(function(e){s(e);var t=n.manageNotificationMenu.querySelectorAll("fluent-menu-item");null!=t&&t.length&&t[0].focus()})),e.appendChild(r)}},{key:"addShoppingSettingsItem",value:function(e,t){var n=this,i=document.createElement("DIV");i.innerHTML=this.commonAssets.getRightArrowIcon(),i.slot="end",i.style.display="flex",i.style.marginRight="0",i.setAttribute("aria-hidden","true");var r=document.createElement("DIV");r.innerHTML=this.commonAssets.getSettingsIcon(),r.slot="start",r.style.display="flex",r.setAttribute("aria-hidden","true");var o=document.createElement("fluent-menu-item");o.style.fontSize="12px",o.title=this.flyoutData.strings.commonShoppingSettings,o.textContent=this.flyoutData.strings.commonShoppingSettings,o.id="manage-settings-button",o.className+="defaultFontFamily",o.appendChild(r),o.appendChild(i);try{this.manageSettingsMenu||(Ru.isSafariClient(this.flyoutData)?this.manageSettingsMenu=new wte(this.flyoutData,this.utilities,this.autoOpenControllerUtilities,this.stateManagement,this.pageHandlerModule,this.logModule,e).renderMenuModule():this.manageSettingsMenu=new Pte(this.flyoutData,this.utilities,this.autoOpenControllerUtilities,this.stateManagement,this.pageHandlerModule,this.logModule,e,this.storageHandler).renderMenuModule(),t.querySelector("#".concat(this.manageSettingsMenu.id))||(t.appendChild(this.manageSettingsMenu),zi.queueUpdate((function(){n.manageSettingsMenu.setAttribute("slot","start-content")}))))}catch(e){var a=new k(P.OnErrorInvoked);this.logModule.LogErrorEvent(A.EdgeFlyoutStatus,"Error creating manage settings menu ".concat(Ru.GetErrorString(e)),a)}var s=function(t){n.manageSettingsMenu.classList.remove("hide"),e.classList.add("hide"),t.stopPropagation();var i=new $i(O.ShoppingSettings,Ji.MENU);n.logModule.LogInfoEvent(A.ButtonClick,"Manage Settings button clicked",i)};o.addEventListener("click",s),this.utilities.makeHtmlElementKeyboardClickable(o,(function(e){s(e);var t=n.manageSettingsMenu.querySelectorAll("fluent-menu-item");null!=t&&t.length&&t[0].focus()})),e.appendChild(o)}},{key:"createContextMenuDiv",value:(n=t(i().mark((function e(t){var n,r,o,a,s,l=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=document.createElement("fluent-menu")).id=be.MENU_CONTENT,n.setAttribute("aria-labelledby",be.MENU);try{Ru.isSafariClient(this.flyoutData)||this.addManageNotificationItem(n,t),this.addShoppingSettingsItem(n,t)}catch(e){r=new k(P.OnErrorInvoked),this.logModule.LogErrorEvent(A.EdgeFlyoutStatus,"Error creating menu buttons ".concat(Ru.GetErrorString(e)),r)}return o=new CustomEvent(nr.CreateFeedbackModule,{detail:{callback:function(e){if(e&&e.element){try{var t,i;null===(t=n.querySelector("#feedbackDiv"))||void 0===t||t.remove(),null===(i=n.querySelector("#menuSettingsBingPrivacy"))||void 0===i||i.remove()}catch(e){}e.element.style.background="var(--neutral-layer-floating)",e.element.setAttribute("role","menuitem"),n.appendChild(e.element),l.createBingPrivacyMesageOnMenu(n)}},wrapperHeight:0}}),this.stateManagement.dispatchEvent(o),this.flyoutData.common.currentDirection===Z.RTL?(a="35px",s="40px"):this.flyoutData.common.openedWith===J.Auto?(a="0px",s="45px"):(a="55px",s="0px"),n.style.top=s,n.style.left=a,n.style.width="230px",n.style.maxWidth="unset !important",n.tabIndex=-1,n.className="hide",this.backgroundOverlay||(this.backgroundOverlay=document.createElement("DIV"),this.backgroundOverlay.id="main-background-overlay",this.backgroundOverlay.classList.add("hide"),this.backgroundOverlay.style.top=s,t.appendChild(this.backgroundOverlay)),t.appendChild(n),zi.queueUpdate((function(){n.setAttribute("slot","start-content")})),e.abrupt("return",n);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"createBingPrivacyMesageOnMenu",value:function(e){var t=document.createElement("DIV"),n=document.createElement("SPAN");n.id="menuMessage",t.className="txtSmall",t.id="menuSettingsBingPrivacy",t.appendChild(n),n.title=this.flyoutData.strings.bingPrivacyMessage,n.textContent=this.flyoutData.strings.bingPrivacyMessage,t.style.fontSize="12px",t.style.lineHeight="12px",e.appendChild(t)}},{key:"isDisableOptOutMenuActive",value:function(){var e;if(Ru.isSafariClient(this.flyoutData)&&!this.flyoutData.common.isUserHadFirstExperience)return!0;if("amazon.com"===(null===(e=this.flyoutData)||void 0===e||null===(e=e.common)||void 0===e?void 0:e.domain)){this.pageHandlerModule.TriggerExperiment(h.showAmazonOtherSellers);var t=v.isExperimentActive(h.showAmazonOtherSellers),n=v.isVariantActive(h.showAmazonOtherSellers,Nt.AS_FeatureOpt);return t&&n}return!1}}]),e}(),Aie=Eie;function Oie(){try{var e="__storage__test";return window.sessionStorage.setItem(e,""),window.sessionStorage.removeItem(e),!0}catch(e){return!1}}function Iie(e){return Oie()?window.sessionStorage.getItem(e):null}function Pie(e,t){Oie()&&window.sessionStorage.setItem(e,t)}function _ie(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=S(e);if(t){var r=S(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return b(this,n)}}var Die=function(e){C(n,e);var t=_ie(n);function n(){var e;r(this,n);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return u(m(e=t.call.apply(t,[this].concat(o))),"visibilityFeedbackUrl",void 0),e}return c(n,[{key:"createSearchShopping",value:function(e,t){var n,i=v.isExperimentActive(h.spbAndQtOnMainSearchBar),r=document.getElementById("searchShopping");r?n=r:(n=Oi("msft-edge-shopping")).id="searchShopping",i&&t&&n.appendChild(t);var o=this.createAndInitializeFeed(this.transformShoppingEntities(e,"en-us"),!t);return o&&n.appendChild(o),!i&&t&&n.appendChild(t),n}},{key:"moduleFirstVisible",value:function(){}},{key:"GetStartShoppingModuleName",value:function(){return re.SEARCH_RESULTS}},{key:"GetModulePriority",value:function(){return te.MAX}},{key:"GetCardClickTelemetry",value:function(){return{buttonName:O.SearchResultsCard,engagement:si.FEED_SEARCH_RESULTS,engagementMojom:li.FEED_SEARCH_RESULTS}}},{key:"GetShowMoreClickTelemtry",value:function(){return{buttonName:O.SearchResultsShowMore,action:qi.FEED_SEARCH_RESULTS_SHOW_MORE,actionMojom:Zi.FEED_SEARCH_RESULTS_SHOW_MORE}}},{key:"GetEnabledMarkets",value:function(){return new Set(["en-us"])}},{key:"GetModuleViewed",value:function(){return Ji.SEARCH_RESULTS}},{key:"GetModuleViewedMojom",value:function(){return Qi.SEARCH_RESULTS}},{key:"createAndInitializeFeed",value:function(e){var t,n,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(null===(t=document.getElementById("searchProductFeed"))||void 0===t||t.remove(),null===(n=document.getElementById("noResultsDiv"))||void 0===n||n.remove(),e.length>0){var r=Oi("msft-product-feed");return r.id="searchProductFeed",r.titleText="Search results",r.showMoreButtonText="Show more",r.adSlugText=this.flyoutData.strings.adSlug,r.includeAdSlug=!0,r.navigateToAdSlugDestination=this.navigateToAdSlugDestination.bind(this),r.logShowMoreButtonClicked=this.logShowMoreButtonClicked.bind(this,this.GetShowMoreClickTelemtry()),r.navigateToDestination=this.navigateToDestination.bind(this,this.GetCardClickTelemetry()),r.sendAdVisibilityFeedback=rT.bind(null,this.visibilityFeedbackUrl),rT(this.visibilityFeedbackUrl,e.slice(0,6).map((function(e){return e.impressionToken}))),r.shoppingEntities=e,r}if(i)return this.createNoResultsDiv()}},{key:"createNoResultsDiv",value:function(){var e=document.getElementById("searchBox").value,t=Oi("DIV");t.id="noResultsDiv";var n=Oi("img");n.id="noResultsImg",n.src="".concat(this.flyoutData.common.resourcesEndpoint,"searchInPane/NoResultsImg.png"),n.setAttribute("aria-hidden","true");var i=Oi("p");return i.id="noResultsMsg",i.textContent="We didn't find any results for \"".concat(e,'". Try another search or continue shopping.'),t.appendChild(n),t.appendChild(i),t}}]),n}(IX),wie=Die,Nie=function(){function e(t,n,i,o,a,s){var l;r(this,e),u(this,"resultsHistory",void 0),u(this,"currentResultIndex",void 0),u(this,"searchResultsModule",void 0),u(this,"commonAssets",void 0),u(this,"tabs",void 0),u(this,"flyOutWrapper",void 0),u(this,"flyoutData",void 0),u(this,"logModule",void 0),u(this,"pageHandlerModule",void 0),u(this,"spbComponentUtils",void 0),u(this,"groceryComponentUtils",void 0),u(this,"telemetryUtilities",void 0),this.flyoutData=o,this.commonAssets=t,this.tabs=n,this.flyOutWrapper=i,this.searchResultsModule=new wie(this.flyoutData,a),this.logModule=s,this.pageHandlerModule=a.pageHandlerModule,this.resultsHistory=JSON.parse(null!==(l=Iie("resultsHistory"))&&void 0!==l?l:"[]");var c=Iie("currentResultIndex");this.currentResultIndex=c?JSON.parse(c):this.resultsHistory.length-1,this.spbComponentUtils=new Aj(o,a,this.commonAssets),this.groceryComponentUtils=new jZ(this.flyoutData,a,this.commonAssets),this.telemetryUtilities=a.telemetryHandler}var n,o,a,s,l;return c(e,[{key:"createSearchDiv",value:function(){var e,t=document.getElementById("searchDiv");return t?e=t:((e=Oi("DIV")).id="searchDiv",this.flyoutData.common.isSharedHeader&&(e.style.paddingTop="10px")),this.createSearchArrows(e),this.createSearchBoxWrapper(e),e}},{key:"createSearchArrows",value:function(e){var t,n=this,i=document.getElementById("leftArrowBtn");if(i)t=i;else{(t=Oi("fluent-button")).id="leftArrowBtn",t.appearance="stealth",t.disabled=!0,t.setAttribute("aria-label","Previous search result");var r=Oi("DIV");r.style.display="flex",r.style.alignContent="center",r.innerHTML=this.commonAssets.getLeftArrowIcon(),t.appendChild(r),e.appendChild(t)}var o,a=document.getElementById("rightArrowBtn");if(a)o=a;else{(o=Oi("fluent-button")).id="rightArrowBtn",o.appearance="stealth",o.disabled=!0,o.setAttribute("aria-label","Next search result");var s=Oi("DIV");s.style.display="flex",s.style.alignContent="center",s.innerHTML=this.commonAssets.getRightArrowIcon(),o.appendChild(s),e.appendChild(o)}t.addEventListener("click",(function(){if(0===n.currentResultIndex)n.createPaneInitialState();else if(n.currentResultIndex>0){var e;n.currentResultIndex--,Pie("currentResultIndex",JSON.stringify(n.currentResultIndex)),document.getElementById("searchBox").value=n.resultsHistory[n.currentResultIndex].qry,null===(e=document.getElementById("dismissBtn"))||void 0===e||e.setAttribute("style","display: flex"),n.searchResultsModule.createSearchShopping(n.resultsHistory[n.currentResultIndex].products)}o.disabled=!1;var t=new $i(O.PreviousSearchResults,n.telemetryUtilities.setContentViewed(re.SEARCH_IN_PANE));n.logModule.LogInfoEvent(A.ButtonClick,"Previous search results button clicked",t)})),o.addEventListener("click",(function(){if(n.currentResultIndex<n.resultsHistory.length-1){var e;n.currentResultIndex++,Pie("currentResultIndex",JSON.stringify(n.currentResultIndex)),document.getElementById("searchBox").value=n.resultsHistory[n.currentResultIndex].qry,null===(e=document.getElementById("dismissBtn"))||void 0===e||e.setAttribute("style","display: flex");var i=n.searchResultsModule.createSearchShopping(n.resultsHistory[n.currentResultIndex].products);n.currentResultIndex===n.resultsHistory.length-1&&(o.disabled=!0),0===n.currentResultIndex&&(n.tabs.style.display="none",n.flyOutWrapper.appendChild(i))}t.disabled=!1;var r=new $i(O.NextSearchResults,n.telemetryUtilities.setContentViewed(re.SEARCH_IN_PANE));n.logModule.LogInfoEvent(A.ButtonClick,"Next search results button clicked",r)}))}},{key:"createSearchBoxWrapper",value:function(e){var t,n=document.getElementById("searchBoxWrapper");n?t=n:((t=Oi("DIV")).id="searchBoxWrapper",e.appendChild(t)),this.createSearchBox(t)}},{key:"createSearchBox",value:function(e){var n,r=this,o=document.getElementById("searchBox");o?n=o:((n=Oi("fluent-text-field")).id="searchBox",n.setAttribute("aria-label","Shopping search bar"),n.placeholder="Search and shop the web",this.createSearchIcon(n),e.appendChild(n)),window.addEventListener("click",(function(e){e.target!==n&&r.removeSearchResultsMenu()})),n.addEventListener("focus",(function(){r.pageHandlerModule.RecordAsUserAction(qi.SEARCH_BOX_FOCUSED),r.pageHandlerModule.RecordAsUserEngagement(si.SEARCH_BOX_FOCUSED,r.flyoutData.common.popupOrigination);var e=new $i(O.SearchBoxInput,r.telemetryUtilities.setContentViewed(re.SEARCH_IN_PANE));r.logModule.LogInfoEvent(A.ButtonClick,"Search box focused",e)})),n.addEventListener("input",this.debounce((function(){return r.createSearchResultsMenu(e,n)}),150)),n.addEventListener("keydown",function(){var e=t(i().mark((function e(t){var o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("ArrowDown"===t.key&&(null===(o=document.getElementById("searchResultsMenu"))||void 0===o||o.focus()),"Escape"===t.key&&r.removeSearchResultsMenu(),"Enter"!==t.key){e.next=5;break}return e.next=5,r.displayProducts(n.value);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.createDismissBtn(n)}},{key:"createDismissBtn",value:function(e){var t,n=this,i=document.getElementById("dismissBtn");if(i)t=i;else{(t=Oi("fluent-button")).id="dismissBtn",t.appearance="stealth",t.setAttribute("tabindex","-1"),t.slot="end",t.style.display="none";var r=Oi("DIV");r.style.display="flex",r.style.alignContent="center",r.innerHTML=this.commonAssets.getDismissIcon(),t.appendChild(r),e.appendChild(t)}t.addEventListener("click",(function(){n.createPaneInitialState();var e=new $i(O.SearchDismissButton,n.telemetryUtilities.setContentViewed(re.SEARCH_IN_PANE));n.logModule.LogInfoEvent(A.ButtonClick,"Search dismiss button clicked",e)}))}},{key:"createSearchResultsMenu",value:(l=t(i().mark((function e(n,r){var o,a,s,l,c,u,d=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((o=document.getElementById("searchResultsMenu"))&&o.remove(),!(r.value.length>0)){e.next=10;break}return null===(a=document.getElementById("dismissBtn"))||void 0===a||a.setAttribute("style","display: flex"),e.next=6,this.fetchSuggestions(r.value);case 6:l=e.sent,(null===(s=l.suggestions)||void 0===s?void 0:s.length)>0?(r.setAttribute("resultsVisible","true"),(c=Oi("fluent-menu")).id="searchResultsMenu",c.setAttribute("aria-label","Search results"),c.addEventListener("keydown",(function(e){"Escape"===e.key&&(d.removeSearchResultsMenu(),r.focus())})),l.suggestions.forEach((function(e,n){var o=Oi("fluent-menu-item");o.id="searchMenuItem".concat(n),o.classList.add("searchMenuItem"),o.textContent=e,o.addEventListener("click",t(i().mark((function t(){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.value=e,t.next=3,d.displayProducts(e);case 3:case"end":return t.stop()}}),t)})))),o.addEventListener("keydown",(function(e){var t;if("Enter"===e.key&&o.click(),0===n&&("ArrowUp"===e.key||"Tab"===e.key&&e.shiftKey))null===(t=document.getElementById("searchMenuItem".concat(l.suggestions.length-1)))||void 0===t||t.focus(),e.preventDefault();else if("Tab"===e.key&&e.shiftKey){var i;null===(i=document.getElementById("searchMenuItem".concat(n-1)))||void 0===i||i.focus(),e.preventDefault()}else if(n!==l.suggestions.length-1||"ArrowDown"!==e.key&&"Tab"!==e.key){if("Tab"===e.key){var r;null===(r=document.getElementById("searchMenuItem".concat(n+1)))||void 0===r||r.focus(),e.preventDefault()}}else{var a;null===(a=document.getElementById("searchMenuItem0"))||void 0===a||a.focus(),e.preventDefault()}})),d.createSearchIcon(o),c.appendChild(o)})),n.appendChild(c)):r.setAttribute("resultsVisible","false"),e.next=12;break;case 10:null===(u=document.getElementById("dismissBtn"))||void 0===u||u.setAttribute("style","display: none"),r.setAttribute("resultsVisible","false");case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"createSearchIcon",value:function(e){var t=Oi("DIV");t.id="searchIcon",t.slot="start",t.setAttribute("aria-hidden","true"),t.style.display="flex",t.style.alignContent="center",t.innerHTML=this.commonAssets.getSearchIcon(),e.appendChild(t)}},{key:"removeSearchResultsMenu",value:function(){var e,t;null===(e=document.getElementById("searchResultsMenu"))||void 0===e||e.remove(),null===(t=document.getElementById("searchBox"))||void 0===t||t.setAttribute("resultsVisible","false")}},{key:"debounce",value:function(e,t){var n,i=this;return function(){for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];clearTimeout(n),n=setTimeout((function(){e.apply(i,o)}),t)}}},{key:"fetchSuggestions",value:(s=t(i().mark((function e(t){var n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://www.bing.com/api/shopping/v1/savings/shoppingSuggestions?qry=".concat(t));case 2:return n=e.sent,e.next=5,n.json();case 5:return r=e.sent,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})},{key:"fetchProductsFromSyndication",value:(a=t(i().mark((function e(t){var n,r,o,a,s,l,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={muid:this.flyoutData.common.muid},o={headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(r)},a="https://www.bing.com/api/shopping/v1/savings/shoppingProducts?qry=".concat(t),e.next=5,fetch(a,o);case 5:return s=e.sent,e.next=8,s.json();case 8:return l=e.sent,this.searchResultsModule.visibilityFeedbackUrl=null!==(n=l.visibilityFeedbackUrl)&&void 0!==n?n:"",c=this.transformSyndicationResponse(l.value),e.abrupt("return",c);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"transformSyndicationResponse",value:function(e){return e.map((function(e){var t,n,i,r;return{adType:"SearchResults",title:e.offer.itemOffered.name,seller:e.offer.seller.name,imageInfo:{altText:e.offer.itemOffered.Description+" image",sourceImageUrl:e.offer.itemOffered.image.contentUrl},priceInfo:{price:null!==(t=null===(n=e.offer)||void 0===n?void 0:n.price.toString())&&void 0!==t?t:0,priceCurrencySymbol:e.offer.priceCurrencySymbol},globalOfferId:e.globalOfferId,shippingPrice:null!==(i=null===(r=e.shippingInfo)||void 0===r?void 0:r.price.toString())&&void 0!==i?i:0,destination:e.offer.url,impressionToken:e.impressionToken}}))}},{key:"displayProducts",value:(o=t(i().mark((function e(t){var n,r,o,a,s,l,c,u,d,p,h,f,g;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.removeSearchResultsMenu(),document.getElementById("leftArrowBtn").disabled=!1,this.currentResultIndex++,Pie("currentResultIndex",JSON.stringify(this.currentResultIndex)),this.tabs.style.display="none",n=this.fetchProductsFromSyndication(t),r=this.fetchSpbAndQtData(t),e.next=9,Promise.all([n,r]);case 9:o=e.sent,a=$n(o,2),s=a[0],l=a[1],c=l.spbOffersWrapper,u=l.offersCount,this.resultsHistory.splice(this.currentResultIndex,0,{qry:t,products:s}),Pie("resultsHistory",JSON.stringify(this.resultsHistory)),d=this.searchResultsModule.createSearchShopping(s,c),this.flyOutWrapper.appendChild(d),this.pageHandlerModule.RecordAsUserAction(qi.FETCH_SEARCH_RESULTS),this.pageHandlerModule.RecordAsUserEngagement(si.FETCH_SEARCH_RESULTS,this.flyoutData.common.popupOrigination),p='Searched for "'.concat(t,'" and found ').concat(s.length," products"),h=new $i(O.FetchSearchResults,this.telemetryUtilities.setContentViewed(re.SEARCH_IN_PANE)),this.logModule.LogInfoEvent(A.ButtonClick,p,h),f='Searched for "'.concat(t,'" and found ').concat(u," products"),g=new $i(O.FetchSearchResultsSpb,this.telemetryUtilities.setContentViewed(re.SEARCH_IN_PANE)),this.logModule.LogInfoEvent(A.ButtonClick,f,g);case 27:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"createPaneInitialState",value:function(){var e,t;(null===(e=document.getElementById("dismissBtn"))||void 0===e||e.setAttribute("style","display: none"),this.removeSearchResultsMenu(),document.getElementById("searchBox").value="",this.currentResultIndex>=0)&&(null===(t=document.getElementById("searchShopping"))||void 0===t||t.remove(),this.tabs.style.display="grid",document.getElementById("leftArrowBtn").disabled=!0,document.getElementById("rightArrowBtn").disabled=!1,this.currentResultIndex=-1,Pie("currentResultIndex",JSON.stringify(this.currentResultIndex)))}},{key:"fetchSpbAndQtData",value:(n=t(i().mark((function e(t){var n,r,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(new Date).getTime(),e.next=3,this.spbComponentUtils.GetSearchResults(t,!0);case 3:return r=e.sent,o=(new Date).getTime(),e.next=7,this.spbComponentUtils.OnNewSearchResultsSpbOrQt(r,n,o,t,this.groceryComponentUtils);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),e}(),Mie=Nie,Rie=function(){function e(t,n){r(this,e),this.stateMgmt=t,this.flyoutData=n,u(this,"toastWrapper",void 0),u(this,"pendingToasts",[]),u(this,"MAX_TOASTS",3),u(this,"currentToastsCount",0),u(this,"removingToast",!1)}var n;return c(e,[{key:"renderModule",value:function(){var e=document.querySelector("#divContentWrapper");if(e){var t=e.querySelector("section#toastContainer");t||(t=this.createToastContainer(),this.toastWrapper=t.firstElementChild,e.appendChild(t)),this.subscribeToToastEvent()}}},{key:"subscribeToToastEvent",value:function(){var e=this;this.stateMgmt.addEventListener(nr.ToastNotification,(function(t){var n=e.extractToast(t);n&&(e.pendingToasts.push(n),e.checkAndInsertToasts())}))}},{key:"canAddToast",value:function(){return this.currentToastsCount<this.MAX_TOASTS&&!this.removingToast}},{key:"createToastContainer",value:function(){var e=Oi("section",{id:"toastContainer"}),t=Oi("div",{id:"toastWrapper"});return e.appendChild(t),e}},{key:"createToast",value:function(e){var t=this,n=Oi("output",{className:"toast"}),i=Oi("div",{className:"toastTextContainer"});e.title&&i.appendChild(Oi("h3",{className:"toastTitle"},e.title));var r=Oi("p",{className:"toastText".concat(e.title?" withTitle":"")},e.text);i.appendChild(r);var o=Oi("fluent-button",{className:"toastClose"});return o.appendChild(Oi("p",{},String.fromCharCode(215))),o.setAttribute("aria-label",this.flyoutData.strings.commonClose),o.addEventListener("click",(function(){return t.animateRemoveToast(n)})),n.appendChild(i),n.appendChild(o),this.currentToastsCount++,this.animateInsertToast(n)?n:null}},{key:"animateInsertToast",value:function(e){var t;if(!this.toastWrapper)return!1;null===(t=this.toastWrapper)||void 0===t||t.appendChild(e);var n=this.toastWrapper.offsetHeight+10;return this.toastWrapper.animate({transform:"translateY(-".concat(n,"px)")},{duration:200,fill:"forwards"}),!0}},{key:"animateRemoveToast",value:(n=t(i().mark((function e(t){var n,r,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.toastWrapper&&t){e.next=2;break}return e.abrupt("return");case 2:return r=this.toastWrapper.offsetHeight,o=r-t.offsetHeight,this.removingToast=!0,t.animate({transform:"translateY(40%)",opacity:.3},{duration:250,fill:"forwards"}),e.next=8,this.toastWrapper.animate({transform:"translateY(-".concat(o,"px)")},{duration:400,fill:"forwards",easing:"ease"}).finished;case 8:null===(n=this.toastWrapper)||void 0===n||n.removeChild(t),this.removingToast=!1,this.currentToastsCount--,this.checkAndInsertToasts();case 12:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"checkAndInsertToasts",value:function(){if(this.pendingToasts.length&&this.canAddToast()){var e=this.pendingToasts.shift();if(e){var t,n=this.createToast(e),i=Math.min(5e3,null!==(t=e.duration)&&void 0!==t?t:2e3);window.setTimeout(this.animateRemoveToast.bind(this),i,n)}}}},{key:"extractToast",value:function(e){return e.detail&&e.detail.text?e.detail:null}}]),e}(),Lie=Rie;function Bie(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=S(e);if(t){var r=S(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return b(this,n)}}var Fie=function(e){C(a,e);var n,o=Bie(a);function a(e,t,n,i,s,l,c,d){var p;r(this,a),u(m(p=o.call(this,e,t,n,i,s,l,c)),"tabs",void 0),u(m(p),"assets",new nte),u(m(p),"panelHomeId",ke.Home),u(m(p),"tabHomeId",xe.Home),u(m(p),"panelContextualId",ke.Contextual),u(m(p),"tabContextualId",xe.Contextual),u(m(p),"contextualShopping","contextualShopping"),u(m(p),"homeShopping","homeShopping"),u(m(p),"domainEligible",!1),u(m(p),"homeModules",void 0),u(m(p),"homeModulesViewed",!1),u(m(p),"contextualModules",void 0),u(m(p),"contextualModulesViewed",!1),u(m(p),"lastCommittedUrl",""),u(m(p),"shoppingTabId","shoppingTab"),u(m(p),"searchInPaneModule",void 0),u(m(p),"panelSingleScrollingId",ke.SingleScrolling),u(m(p),"tabMyShoppingId",xe.MyShopping),u(m(p),"tabCouponsSavingsId",xe.CouponsSavings),u(m(p),"tabExploreId",xe.Explore),u(m(p),"exploreModulesViewed",!1),u(m(p),"exploreModules",void 0),u(m(p),"myShoppingShopping",Te.MyShopping),u(m(p),"couponsSavingsShopping",Te.CouponsSavings),u(m(p),"exploreShopping",Te.Explore),u(m(p),"singleScrollingShopping",Te.SingleScrolling),u(m(p),"singleScrollingPaneWrapper",void 0),u(m(p),"isSingleScrollingPane",void 0),u(m(p),"isMyShoppingZeroState",!1),u(m(p),"isCouponsSavingsZeroState",!1),u(m(p),"isExploreZeroState",!1),u(m(p),"singleScrollingActiveTabId",void 0),u(m(p),"singleScrollingIntersectionObserver",void 0),u(m(p),"observeIntervalID",void 0),u(m(p),"isCjkEnabled",!1),u(m(p),"trendingCouponsModule",void 0),u(m(p),"trendingCouponsModuleType",void 0);try{new Lie(p.stateManagement,p.flyoutData).renderModule()}catch(e){var f=new k(P.ToastNotificationError);f.Metadata=e,p.logModule.LogErrorEvent(A.EdgeFlyoutStatus,"Failed to insert toast notification module",f)}var g=document.querySelector("fluent-design-system-provider");return g&&g.removeAttribute("role"),p.pageHandlerModule.TriggerExperiment(h.singleScrollingShoreline),p.isSingleScrollingPane=v.isExperimentActive(h.singleScrollingShoreline),p.isCjkEnabled=t.common.isCJKEnabled,p.isSingleScrollingPane&&(p.singleScrollingPaneWrapper=document.createElement("msft-edge-shopping"),p.singleScrollingPaneWrapper.id=p.singleScrollingShopping),p.domainEligible=p.flyoutData.common.isDomainEligible,d&&(p.trendingCouponsModule=d),p}return c(a,[{key:"renderModules",value:function(e,n){var r=this;this.utilities.viewModulesUtilities.applyStyles(n,this.assets.getStyles(),void 0,this.assets.getDarkModeStyles()),n.style.setProperty("--scrollbar-width","".concat(this.calculateScrollBarWidth(),"px")),this.isCjkEnabled&&this.stateManagement.addEventListener(nr.ChangeContextualTitle,(function(e){if(r.tabs){var t=r.tabs.querySelector("#".concat(r.tabContextualId));t&&(t.textContent=e.detail.title)}})),this.stateManagement.addEventListener(nr.onDataUpdate,(function(e){e&&e.detail&&e.detail.moduleType&&r.styleModulesInPane(e.detail.moduleType,n)})),this.stateManagement.addEventListener(nr.ReRankFlyout,function(){var e=t(i().mark((function e(t){var o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.GetRenderedModules();case 2:o=e.sent.filter((function(e){return e.paneTab===le.CONTEXTUAL})),v.isExperimentActive(h.singleScrollingShoreline)?r.renderReRankedContextualModulesInSinglePane(o,n):r.renderReRankedContextualModules(o,n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.stateManagement.addEventListener(nr.domainEligibility,(function(e){e&&e.detail&&(r.lastCommittedUrl=e.detail.lastCommittedUrl,e.detail.domainEligibility?(r.domainEligible=!0,r.switchTabs(!0)):(r.domainEligible=!1,r.switchTabs(!1))),r.isCjkEnabled&&zi.queueUpdate((function(){r.restoreTabName()}))})),this.stateManagement.addEventListener(nr.flyoutRefresh,(function(){var e=document.querySelector("#divActions");e&&r.createActionButtons(e,n)})),this.stateManagement.addEventListener(nr.PWILODeleted,(function(e){if(e&&e.detail&&void 0!==e.detail.index&&r.utilities.viewModulesUtilities.isKeyboardClick(e.detail.event)){var t=n.querySelector("#".concat(be.CLOSE));t&&t.focus()}})),this.stateManagement.addEventListener(nr.PWILOEmpty,(function(){var t,n=null===(t=e.filter((function(e){return e.paneTab===le.HOME})))||void 0===t?void 0:t.sort((function(e,t){return e.priority-t.priority}));if(n&&1===n.length&&n[0].name===re.PRODUCTHISTORY){if(r.isSingleScrollingPane){var i=document.getElementById("".concat(r.myShoppingShopping));i&&i.remove();var o=r.tabs.querySelector("#".concat(r.tabMyShoppingId));if(o){var a=r.getZeroStateContainer(r.myShoppingShopping);r.isMyShoppingZeroState=!0,r.manageTabControls(o,!1,a)}}else{var s=document.querySelector("#".concat(r.homeShopping));s&&s.remove();var l=r.tabs.querySelector("#".concat(r.tabHomeId));l&&r.manageTabControls(l,!1,null)}r.domainEligible?r.switchTabs(!0):r.switchTabs(!1)}})),v.isExperimentActive(h.shorelineinboxcoupons)&&this.stateManagement.addEventListener(nr.ActiveRetailerInboxCouponsEmpty,(function(){var t,n=null===(t=e.filter((function(e){return e.paneTab===le.CONTEXTUAL})))||void 0===t?void 0:t.filter((function(e){return e.name!==re.ACTIVE_RETAILER_INBOX_COUPONS}));if(!n||n&&0===n.length)if(r.isSingleScrollingPane){var i=document.getElementById("".concat(r.couponsSavingsShopping));i&&i.remove();var o=r.tabs.querySelector("#".concat(r.tabCouponsSavingsId));if(o){var a=r.getZeroStateContainer(r.couponsSavingsShopping);r.isCouponsSavingsZeroState=!0,r.manageTabControls(o,!1,a)}r.switchTabs(r.domainEligible)}else{var s=document.querySelector("#".concat(r.panelContextualId));r.createNullState(s);var l=document.querySelector("#".concat(r.tabHomeId)),c=document.querySelector("#".concat(r.panelHomeId));l&&c&&(r.manageTabControls(l,!0,c),r.setActiveTabId(r.tabHomeId),r.updateTabItemsStyling(1))}}));var o=[];this.stateManagement.addEventListener(nr.PDPRemoved,(function(t){if(t&&t.detail&&t.detail.moduleName){var n;o.push(t.detail.moduleName);var i=null===(n=e.filter((function(e){return e.paneTab===le.CONTEXTUAL&&-1===o.findIndex((function(t){return t===e.name}))&&e.name!==re.FEEDBACK&&e.name!==re.EMPTYCOUPON})))||void 0===n?void 0:n.sort((function(e,t){return e.priority-t.priority}));if(!i||i&&0===i.length)if(hn("isPDP","false"),r.isSingleScrollingPane){var a=document.getElementById("".concat(r.couponsSavingsShopping));a&&a.remove();var s=r.tabs.querySelector("#".concat(r.tabCouponsSavingsId));if(s){var l=r.getZeroStateContainer(r.couponsSavingsShopping);r.isCouponsSavingsZeroState=!0,r.manageTabControls(s,!1,l)}r.switchTabs(r.domainEligible)}else{var c=document.querySelector("#".concat(r.panelContextualId));r.createNullState(c);var u=document.querySelector("#".concat(r.tabHomeId)),d=document.querySelector("#".concat(r.panelHomeId));u&&d&&(r.manageTabControls(u,!0,d),r.setActiveTabId(r.tabHomeId),r.updateTabItemsStyling(1))}}}));var a=document.querySelector("fluent-tabs");if(a)this.tabs=a;else{this.tabs=Oi("fluent-tabs"),this.tabs.id=this.shoppingTabId,this.tabs.setAttribute("orientation","horizontal");var s=new Date("02-15-2023");new Date<s&&(this.flyoutData.common.channel===ne.CANARY?this.tabs.classList.add("valentinesCanary"):this.tabs.classList.add("valentines"))}if(this.isSingleScrollingPane){var l,c=document.getElementById("".concat(this.panelSingleScrollingId));c?l=c:(l=Oi("fluent-tab-panel")).id=this.panelSingleScrollingId,l.appendChild(this.singleScrollingPaneWrapper),c||this.tabs.appendChild(l),this.renderMyShoppingSection(e,n),this.renderCouponsSavingsSection(e,n),this.renderExploreSection(e,n)}else this.renderHomeModules(e,n),this.renderContextualModules(e,n);n.addEventListener(nr.ModulesRendered,(function(){zi.queueUpdate(t(i().mark((function t(){var n,o,a,s,l;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=r.tabs.getAttribute("activeid"),r.isSingleScrollingPane&&(r.addSentinels(),r.setIntersectionObservers(),r.handleSingleScrollingTabsOnStartUp(),o=r.singleScrollingActiveTabId),o===r.tabContextualId||r.isSingleScrollingPane&&o===r.tabCouponsSavingsId?(a=le.CONTEXTUAL,s=r.flyoutData.common.shopping,r.pageHandlerModule.TriggerExperiment(h.paneOpenWithTab2)):o===r.tabHomeId||r.isSingleScrollingPane&&o===r.tabMyShoppingId?(a=le.HOME,s=r.flyoutData.common.shoppingPersistent,r.pageHandlerModule.TriggerExperiment(h.paneOpenWithTab1)):r.isSingleScrollingPane&&o===r.tabExploreId&&(a=le.EXPLORE,s=r.flyoutData.common.shoppingExplore),l=null===(n=e.filter((function(e){return e.paneTab===a})))||void 0===n?void 0:n.sort((function(e,t){return e.priority-t.priority})),r.handleFlyoutFocus(l,void 0,s,!1),(!r.isCjkEnabled||r.isCjkEnabled&&!r.stateManagement.getState(ir.shouldChangeTitle))&&r.restoreTabName();case 6:case"end":return t.stop()}}),t)}))))})),dn(Yee.InboxCouponsUpsellOpen)}},{key:"appendContentToFlyout",value:function(e){var t=this;if(e){var n,i=new k(P.AppendNodeError);if(this.flyoutData.common.isSharedHeader){var r=Oi("DIV");e.appendChild(r);try{this.createUnifedHeaderShoppingMenu(r,e)}catch(e){this.logModule.LogErrorEvent(A.EdgeFlyoutStatus,"Failure when creating mainHeader on Pane - Unified header",i)}}else{var o=document.querySelector("#divMainHeader");o&&o.remove();try{n=this.createMainShoppingHeader(e),e.appendChild(n)}catch(e){this.logModule.LogErrorEvent(A.EdgeFlyoutStatus,"Failure when creating mainHeader on Pane",i)}}if(v.isExperimentActive(h.searchInPane)&&!this.isCjkEnabled){try{n&&(n.style.borderBottom="none"),this.searchInPaneModule=new Mie(this.commonAssets,this.tabs,e,this.flyoutData,this.utilities,this.logModule);var a=this.searchInPaneModule.createSearchDiv();e.appendChild(a)}catch(e){this.logModule.LogErrorEvent(A.EdgeFlyoutStatus,"Failure when creating searchDiV on Pane",i)}try{var s=document.getElementById("searchShopping");if(s){var l=this.searchInPaneModule.currentResultIndex,c=this.searchInPaneModule.resultsHistory[l].products;s=this.searchInPaneModule.searchResultsModule.createSearchShopping(c),e.appendChild(s)}}catch(e){this.logModule.LogErrorEvent(A.EdgeFlyoutStatus,"Failure when creating search results module on Pane",i)}}try{e.appendChild(this.tabs)}catch(e){this.logModule.LogErrorEvent(A.EdgeFlyoutStatus,"Failure when appending tabs to Pane",i)}zi.queueUpdate((function(){if(t.tabs){var e,n,i=null===(e=t.tabs.shadowRoot)||void 0===e?void 0:e.querySelector(".tablist");i&&(i.title=t.flyoutData.strings.commonFixedTitle);var r=null===(n=t.tabs.shadowRoot)||void 0===n?void 0:n.querySelector(".tabpanel");r&&(r.style.overflow="auto")}}))}}},{key:"switchTabs",value:function(e){if(this.isSingleScrollingPane)this.switchSingleScrollingTabs(e);else{var t=this.tabs.querySelector("#".concat(this.tabContextualId)),n=this.tabs.querySelector("#".concat(this.tabHomeId)),i=document.querySelector("#".concat(this.panelContextualId));if(e)t&&(this.setActiveTabId(this.tabContextualId),this.updateTabItemsStyling(2),i&&(this.manageTabControls(t,!0,i),this.createLoadingState(this.contextualShopping,this.panelContextualId)));else{var r=document.querySelector("#".concat(this.homeShopping));n&&r?(this.setActiveTabId(this.tabHomeId),this.updateTabItemsStyling(1),this.manageTabControls(n,!0,null),t&&this.manageTabControls(t,!1,i)):t&&i&&(this.setActiveTabId(this.tabContextualId),this.updateTabItemsStyling(2),this.manageTabControls(t,!0,i),this.manageTabControls(n,!1,null),this.createNullState(i))}}}},{key:"updateTabItemsStyling",value:function(e){var t,n,i=null===(t=this.tabs.shadowRoot)||void 0===t?void 0:t.querySelector(".activeIndicator"),r=null===(n=this.tabs.shadowRoot)||void 0===n?void 0:n.querySelector(".tablist");i&&i.style.gridColumn!=="".concat(e)&&(i.style.transform="translateX(0px)",i.style.gridColumn="".concat(e)),r&&(r.style.paddingBottom="15px")}},{key:"createMainShoppingHeader",value:function(e){var t=Oi("DIV");t.id="divMainHeader";var n=Oi("h1");n.className="txtMedium",n.style.fontWeight="500",n.style.fontSize="16px",n.textContent=this.flyoutData.strings.commonFixedTitlePane;var i=Oi("DIV");return i.id="divActions",this.createActionButtons(i,e),t.appendChild(n),t.appendChild(i),t}},{key:"createActionButtons",value:function(e,t){new Lte(this.flyoutData,this.utilities,this.pageHandlerModule,this.logModule,this.stateManagement).createFlyoutButtons(e,!0,t)}},{key:"createUnifedHeaderShoppingMenu",value:function(e,t){new Aie(this.flyoutData,this.utilities,this.pageHandlerModule,this.logModule,this.stateManagement).createSettingsMenu(e,t)}},{key:"renderContextualModules",value:function(e,t){var n,i=this;this.contextualModules=null===(n=e.filter((function(e){return e.paneTab===le.CONTEXTUAL})))||void 0===n?void 0:n.sort((function(e,t){return e.priority-t.priority}));var r,o=this.tabs.querySelector("#".concat(this.tabContextualId));if(o)r=o;else{(r=Oi("fluent-tab")).id=this.tabContextualId,r.style.display="flex",r.style.flexDirection="column";var a=Oi("P");a.className="paneTabText",a.style.color="inherit",a.textContent=this.flyoutData.strings.paneForYou,r.appendChild(a),this.tabs.appendChild(r)}r.addEventListener("click",this.sendClickTelemetry.bind(this)),new MutationObserver((function(){i.handleStyleTabSwitch(r),i.sendCTRLogs(i.tabContextualId)})).observe(r,{attributeFilter:["aria-selected"],attributes:!0}),document.querySelector("#".concat(this.contextualShopping))||(this.renderModulesInTab(this.contextualModules,this.flyoutData.common.shopping,this.panelContextualId,t),this.flyoutData.common.shopping.id=this.contextualShopping,this.flyoutData.common.shopping.fixedTitle=this.flyoutData.strings.commonContextualTab);var s=un("mitOpen");if(this.contextualModules&&this.contextualModules.length>0&&this.canRenderContentInTab(this.contextualModules,this.panelContextualId)&&(null==s||!s.includes("true"))){this.setActiveTabId(this.tabContextualId),this.updateTabItemsStyling(2);var l=document.querySelector("#".concat(this.panelContextualId));this.manageTabControls(r,!0,l)}else r&&zi.queueUpdate((function(){var e=document.querySelector("#".concat(i.homeShopping)),t=document.querySelector("#".concat(i.panelContextualId));if(e){var n=document.querySelector("#".concat(i.tabHomeId)),o=document.querySelector("#".concat(i.panelHomeId));n&&o&&(i.manageTabControls(n,!0,o),i.setActiveTabId(i.tabHomeId),i.updateTabItemsStyling(1),null!=s&&s.includes("true")||i.createNullState(t))}else t&&(i.manageTabControls(r,!0,t),i.setActiveTabId(i.tabContextualId),i.updateTabItemsStyling(2),null!=s&&s.includes("true")||i.createNullState(t))}));this.checkIfShouldFocusInboxCoupons()}},{key:"setActiveTabId",value:function(e){this.isSingleScrollingPane?this.singleScrollingActiveTabId=e:this.tabs.getAttribute("activeid")!==e&&this.tabs.setAttribute("activeid",e),(e===this.tabHomeId||this.isSingleScrollingPane&&e===this.tabMyShoppingId)&&this.stateManagement.dispatchEvent(new CustomEvent(nr.HomeTabActive)),this.sendCTRLogs(e)}},{key:"sendCTRLogs",value:function(e){var t=this;zi.queueUpdate((function(){var n=[];(t.isSingleScrollingPane?t.singleScrollingActiveTabId:t.tabs.getAttribute("activeid"))===e&&((e===t.tabHomeId||t.isSingleScrollingPane&&e===t.tabMyShoppingId)&&!t.homeModulesViewed&&(n=t.homeModules,t.homeModulesViewed=!0),(e===t.tabContextualId||t.isSingleScrollingPane&&e===t.tabCouponsSavingsId)&&!t.contextualModulesViewed&&(n=t.contextualModules,t.contextualModulesViewed=!0),t.isSingleScrollingPane&&e===t.tabExploreId&&!t.exploreModulesViewed&&(n=t.exploreModules,t.exploreModulesViewed=!0),n.forEach((function(e,n){t.utilities.telemetryHandler.sendCTRLog(e,n,t.GetImpressionType(e.name))})))}))}},{key:"sendClickTelemetry",value:function(e){var t,n,i,r=e.currentTarget.id;r===this.tabHomeId||this.isSingleScrollingPane&&r===this.tabMyShoppingId?(t=qi.SWITCH_TO_TAB1,n=qi.CJK_SWITCH_TO_TAB1,i=si.SWITCH_TO_TAB1):r===this.tabContextualId||this.isSingleScrollingPane&&r===this.tabCouponsSavingsId?(t=qi.SWITCH_TO_TAB2,n=qi.CJK_SWITCH_TO_TAB2,i=si.SWITCH_TO_TAB2):(t=qi.SWITCH_TO_TAB3,i=si.SWITCH_TO_TAB3);var o=new k(P.PaneTabClick);o.Metadata=JSON.stringify({type:r}),this.pageHandlerModule.RecordAsUserAction(t),this.pageHandlerModule.RecordAsUserEngagement(i,this.flyoutData.common.popupOrigination),this.logModule.LogInfoEvent(A.EdgeFlyoutStatus,"",o),this.isCjkEnabled&&n&&(this.pageHandlerModule.RecordAsUserAction(n),t in FW&&this.pageHandlerModule.RecordAsCjkScenario(UW.ACTION,FW[t]))}},{key:"sendScrollToTabTelemetry",value:function(e){var t,n;e===this.tabMyShoppingId?(t=qi.SCROLL_TO_TAB1,n=si.SCROLL_TO_TAB1):e?(t=qi.SCROLL_TO_TAB2,n=si.SCROLL_TO_TAB2):(t=qi.SCROLL_TO_TAB3,n=si.SCROLL_TO_TAB3);var i=new k(P.PaneTabClick);i.Metadata=JSON.stringify({type:e}),this.pageHandlerModule.RecordAsUserAction(t),this.pageHandlerModule.RecordAsUserEngagement(n,this.flyoutData.common.popupOrigination),this.logModule.LogInfoEvent(A.EdgeFlyoutStatus,"",i)}},{key:"manageTabControls",value:function(e,t,n){if(t){if(n){var i=n.querySelector(".paneNullWrapper");i&&i.remove()}e.style.pointerEvents="unset",e.setAttribute("aria-disabled","false")}else n?n.id===this.couponsSavingsShopping?this.createTrendingCouponsAsNullState(n):this.createNullState(n):(e.style.pointerEvents="none",e.setAttribute("aria-disabled","true"))}},{key:"renderHomeModules",value:function(e,t){var n,i,r=this;this.homeModules=null===(n=e.filter((function(e){return e.paneTab===le.HOME})))||void 0===n?void 0:n.sort((function(e,t){return e.priority-t.priority}));var o=this.tabs.querySelector("#".concat(this.tabHomeId));if(o)i=o;else{(i=Oi("fluent-tab")).id=this.tabHomeId;var a=Oi("P");a.className="paneTabText",a.style.color="inherit",a.textContent=this.flyoutData.strings.paneHome,i.appendChild(a),this.tabs.appendChild(i)}i.addEventListener("click",this.sendClickTelemetry.bind(this)),i.addEventListener("click",(function(){r.stateManagement.dispatchEvent(new CustomEvent(nr.HomeTabActive))})),new MutationObserver((function(){r.handleStyleTabSwitch(i),r.sendCTRLogs(r.tabHomeId)})).observe(i,{attributeFilter:["aria-selected"],attributes:!0}),document.querySelector("#".concat(this.homeShopping))||(this.renderModulesInTab(this.homeModules,this.flyoutData.common.shoppingPersistent,this.panelHomeId,t),this.flyoutData.common.shoppingPersistent.id=this.homeShopping,this.flyoutData.common.shoppingPersistent.fixedTitle=this.flyoutData.strings.commonHomeTab,this.homeModules&&this.homeModules.length>0?this.manageTabControls(i,!0,null):this.flyoutData.common.isWebAssistPending?(this.createLoadingState(this.homeShopping,this.panelHomeId),this.manageTabControls(i,!0,null)):this.manageTabControls(i,!1,null))}},{key:"renderModulesInTab",value:function(e,t,n,i){try{var r,o=document.querySelector("#".concat(n));o?r=o:(r=Oi("fluent-tab-panel")).id=n;var a=t;if(e&&e.length>0&&this.canRenderContentInTab(e,n)){this.appendModulesToShoppingElement(e,a,i);var s=r.querySelector(".paneLoadingWrapper");s&&s.remove();var l=r.querySelector(".paneNullWrapper");l&&l.remove(),r.appendChild(a)}o||this.tabs.appendChild(r),this.scrollContentTo00(a)}catch(e){this.onAddingModulesInTabError(e)}}},{key:"appendModulesToShoppingElement",value:function(e,t,n){for(var i,r,o=0;o<e.length;o++){var a=e[o];if(a.element.expanded=!0,o>0&&a.priority!==te.MAX&&(v.isExperimentActive(h.singleScrollingShoreline)||this.utilities.viewModulesUtilities.addSectionSeparator(t),this.flyoutData.common.isCJKEnabled&&o>1)){var s=t.getElementsByTagName("HR")[o-1];null==s||s.setAttribute("style","height: 12px; position: relative;")}t.appendChild(a.element),this.isStoryBookSection(n)?this.utilities.viewModulesUtilities.styleModules(a,1,n):this.utilities.viewModulesUtilities.styleModules(a,o,n);try{a.moduleInterface.PostProcessing(a.name,o,a.element),this.isStoryBookSection(n)?this.styleModulesInPane(a,n,1):this.styleModulesInPane(a,n,o)}catch(e){var l=new k(P.OnErrorInvoked);this.logModule.LogErrorEvent(A.EdgeFlyoutStatus,"Error while Post processing Module: ".concat(a.name," ").concat(Ru.GetErrorString(e)),l,this.GetImpressionType(a.name))}}this.isStoryBookSection(n)||this.setTitle(e[0]);var c=null!==(i=e[0].name===re.COUPON&&this.flyoutData.common.isCheckoutPage&&(null===(r=this.flyoutData.dataStoreModule.CouponData)||void 0===r?void 0:r.isCheckoutPageWithAutoApply))&&void 0!==i&&i,u="msft-edge-shopping-section"!==e[0].element.nodeName.toLowerCase()&&e[0].moduleLayout===ce.BLOCK,d=e[0].name===re.SOCIALCOUPONS&&"youtube.com"===this.flyoutData.common.domain;(c||u||d)&&(e[0].element.seeMoreSeparate?this.addClassToShopping(e[0].paneTab,"headerBlockSeeMore"):this.addClassToShopping(e[0].paneTab,"headerBlock"))}},{key:"scrollContentTo00",value:function(e){zi.queueUpdate((function(){var t,n=null===(t=e.shadowRoot)||void 0===t?void 0:t.querySelector(".content");n&&n.scrollTo(0,0),setTimeout((function(){n&&n.scrollTo(0,0)}),200)}))}},{key:"onAddingModulesInTabError",value:function(e){var t=new k(P.OnErrorInvoked);this.logModule.LogInfoEvent(A.EdgeFlyoutStatus,"Error adding modules to tabs ".concat(Ru.GetErrorString(e)),t)}},{key:"canRenderContentInTab",value:function(e,t){var n=!0;if(t===this.panelHomeId||this.isSingleScrollingPane&&t===this.tabMyShoppingId){var i=e.filter((function(e){return e.paneTab===le.HOME}));n=i&&i.length>0,this.isSingleScrollingPane&&(this.isMyShoppingZeroState=!n)}else if(t===this.panelContextualId||this.isSingleScrollingPane&&t===this.tabCouponsSavingsId){var r=e.filter((function(e){return e.paneTab===le.CONTEXTUAL&&e.name!==re.EMPTYCOUPON&&e.name!==re.FEEDBACK&&e.name!==re.COMMUNITY_COUPONS}));n=r&&r.length>0,this.isSingleScrollingPane&&(this.isCouponsSavingsZeroState=!n)}else if(t===this.tabExploreId){var o=e.filter((function(e){return e.paneTab===le.EXPLORE}));n=o&&o.length>0,this.isSingleScrollingPane&&(this.isExploreZeroState=!n)}return n}},{key:"handleStyleTabSwitch",value:function(e){"true"===e.getAttribute("aria-selected")?(e.style.fontWeight="600",e.id===this.tabContextualId||e.id===this.tabCouponsSavingsId?this.updateTabItemsStyling(2):e.id===this.tabHomeId||e.id===this.tabMyShoppingId?this.updateTabItemsStyling(1):e.id===this.tabExploreId&&this.updateTabItemsStyling(3)):e.style.fontWeight="normal"}},{key:"styleModulesInPane",value:function(e,t,n){var i;e.element.isPane=!0,e.element.isSingleScroll=this.isSingleScrollingPane&&0!==n;var r=null!==(i="msft-edge-shopping-section"===e.element.nodeName.toLowerCase())&&void 0!==i&&i;if(e.moduleLayout===ce.BLOCK)if(0!==n||this.isStoryBookSection(t)?r?e.name!==re.TIPS&&(e.element.isBlock=!0):e.element.classList.add("regionBlock"):(e.element.seeMoreSeparate?this.addClassToShopping(e.paneTab,"headerBlockSeeMore"):this.addClassToShopping(e.paneTab,"headerBlock"),e.name===re.CASHBACK&&this.flyoutData.common.shopping.classList.add("noPaddingBlock"),e.element.headerBlock=!0),e.name===re.CASHBACK){var o=this.flyoutData.dataStoreModule.CashBackData;o&&o.userRebatesResponse&&o.userRebatesResponse.isRebatesUser&&e&&o.userRebatesResponse.latestCashbackApproved?e.element.classList.add("previousSection"):0!==n&&(e.element.hasPadding=!0)}else e.name!==re.PRICECOMPARISON&&e.name!==re.SIMILARSELLERS&&r&&0!==n&&(e.element.hasPadding=!0)}},{key:"addClassToShopping",value:function(e,t){e===le.CONTEXTUAL?this.flyoutData.common.shopping.classList.add(t):e===le.EXPLORE?this.flyoutData.common.shoppingExplore.classList.add(t):this.flyoutData.common.shoppingPersistent.classList.add(t)}},{key:"createLoadingState",value:function(e,t){var n=this,i=document.querySelector("#".concat(t));if(i){var r=document.querySelector("#".concat(e));r&&r.remove(),(r=document.createElement("msft-edge-shopping")).id=e;var o=Oi("DIV",{style:"padding: 20px; display: flex; flex-direction: column; row-gap: 8px;"});o.className="paneLoadingWrapper";var a=Oi("DIV");a.className="smallBlock shimmerBlock";var s=Oi("DIV");s.className="bigBlock shimmerBlock",o.appendChild(a),o.appendChild(s),o.appendChild(s.cloneNode(!1)),o.appendChild(s.cloneNode(!1)),o.appendChild(a.cloneNode(!1)),o.appendChild(s.cloneNode(!1)),o.appendChild(s.cloneNode(!1)),o.appendChild(s.cloneNode(!1)),r.appendChild(o),i.appendChild(r),setTimeout((function(){zi.queueUpdate((function(){if(document.querySelector(".paneLoadingWrapper")){var e=new k(P.ErrorPaneStuckLoadingState);if(n.lastCommittedUrl){var t={url:n.lastCommittedUrl};e.Metadata=JSON.stringify(t)}n.logModule.LogInfoEvent(A.EdgeFlyoutStatus,"Pane stuck on loading state, forcing refresh. Domain Elegible: ".concat(n.domainEligible),e);var i=new CustomEvent(nr.RequestRefresh,{detail:{refreshType:cz.PaneStuck}});n.stateManagement.dispatchEvent(i)}}))}),15e3)}}},{key:"createTrendingCouponsAsNullState",value:(n=t(i().mark((function e(t){var n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isSingleScrollingPane||!this.trendingCouponsModule){e.next=18;break}if(e.prev=1,this.trendingCouponsModuleType){e.next=6;break}return e.next=5,this.trendingCouponsModule.renderModule();case 5:this.trendingCouponsModuleType=e.sent;case 6:if(!this.trendingCouponsModuleType){e.next=13;break}return e.next=9,this.trendingCouponsModule.PostProcessing(null===(n=this.trendingCouponsModuleType)||void 0===n?void 0:n.name,0,null===(r=this.trendingCouponsModuleType)||void 0===r?void 0:r.element);case 9:for(;t&&t.lastChild;)t.lastChild.remove();return t.appendChild(this.trendingCouponsModuleType.element),this.addSentinel(t,this.tabExploreId,this.tabCouponsSavingsId),e.abrupt("return");case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(1),this.createNullState(t);case 18:this.createNullState(t);case 19:case"end":return e.stop()}}),e,this,[[1,15]])}))),function(e){return n.apply(this,arguments)})},{key:"createNullState",value:function(e){if(!this.isCjkEnabled&&(!(null==e?void 0:e.querySelector(".paneNullWrapper"))&&e)){for(;e&&e.lastChild;)e.lastChild.remove();var t=Oi("DIV");t.className="paneNullWrapper",t.style.display="flex",t.style.flexDirection="column",t.style.justifyContent="center",t.style.alignItems="center",t.style.textAlign="center",t.style.padding="0 45px",t.style.height="100%",t.style.height="calc(100vh - 300px)";var n=Oi("DIV");n.className="nullContentContainer";var i=Oi("IMG");this.utilities.viewModulesUtilities.setImageSrc(i,this.flyoutData.common.resourcesEndpoint+"pane/nullState.png"),i.style.pointerEvents="none",i.setAttribute("aria-hidden","true");var r=Oi("H2");r.className="txtLarge",r.style.fontSize="20px",r.textContent=this.flyoutData.common.isCJKEnabled?this.flyoutData.strings.cjkPaneNullStateMessage:this.flyoutData.strings.paneNullStateMessage,n.appendChild(i),n.appendChild(r),t.appendChild(n),e.appendChild(t);var o=e.querySelector(".paneLoadingWrapper");o&&o.remove(),this.isSingleScrollingPane&&(t.style.height="fit-content",t.style.overflow="hidden",t.style.paddingBottom="15px")}}},{key:"renderMyShoppingSection",value:function(e,t){var n,i=this;this.homeModules=null===(n=e.filter((function(e){return e.paneTab===le.HOME})))||void 0===n?void 0:n.sort((function(e,t){return e.priority-t.priority}));var r,o=this.tabs.querySelector("#".concat(this.tabMyShoppingId));if(o)r=o;else{(r=Oi("fluent-tab")).id=this.tabMyShoppingId,r.style.gridColumn="1";var a=Oi("P");a.className="paneTabText",a.textContent=this.flyoutData.strings.paneMyShopping,r.appendChild(a),this.tabs.appendChild(r)}this.addClickListenersToTab(r,this.tabMyShoppingId),this.addTabArrowKeysListeners(r,this.tabMyShoppingId),this.addTabFocusListeners(r,this.myShoppingShopping),new MutationObserver((function(){i.handleStyleTabSwitch(r),i.sendCTRLogs(i.tabMyShoppingId)})).observe(r,{attributeFilter:["aria-selected"],attributes:!0}),document.getElementById("".concat(this.myShoppingShopping))||(this.renderModulesInSingleScrollingTabs(this.homeModules,this.flyoutData.common.shoppingPersistent,this.tabMyShoppingId,t),this.flyoutData.common.shoppingPersistent.id=this.myShoppingShopping,this.flyoutData.common.shopping.fixedTitle=this.flyoutData.strings.commonMyShoppingTab),this.checkIfShouldFocusInboxCoupons()}},{key:"checkIfShouldFocusInboxCoupons",value:function(){if("true"===un(Yee.InboxCouponsUpsellOpen)){this.utilities.viewModulesUtilities.switchShoppingTab(this.tabHomeId),this.setActiveTabId(this.tabHomeId);var e=document.getElementById("inboxCouponSection");null==e||e.scrollIntoView({behavior:"smooth"})}}},{key:"renderCouponsSavingsSection",value:function(e,t){var n,i=this;this.contextualModules=null===(n=e.filter((function(e){return e.paneTab===le.CONTEXTUAL})))||void 0===n?void 0:n.sort((function(e,t){return e.priority-t.priority}));var r,o=this.tabs.querySelector("#".concat(this.tabCouponsSavingsId));if(o)r=o;else{(r=Oi("fluent-tab")).id=this.tabCouponsSavingsId,r.style.gridColumn="2";var a=Oi("P");a.className="paneTabText",a.textContent=this.flyoutData.strings.paneCouponsSavings,r.appendChild(a),this.tabs.appendChild(r)}this.addClickListenersToTab(r,this.tabCouponsSavingsId),this.addTabArrowKeysListeners(r,this.tabCouponsSavingsId),this.addTabFocusListeners(r,this.couponsSavingsShopping),new MutationObserver((function(){i.handleStyleTabSwitch(r),i.sendCTRLogs(i.tabCouponsSavingsId)})).observe(r,{attributeFilter:["aria-selected"],attributes:!0}),document.getElementById("".concat(this.couponsSavingsShopping))||(this.renderModulesInSingleScrollingTabs(this.contextualModules,this.flyoutData.common.shopping,this.tabCouponsSavingsId,t),this.flyoutData.common.shopping.id=this.couponsSavingsShopping,this.flyoutData.common.shopping.fixedTitle=this.flyoutData.strings.commonContextualTab)}},{key:"renderExploreSection",value:function(e,t){var n,i,r=this;if(this.exploreModules=null===(n=e.filter((function(e){return e.paneTab===le.EXPLORE})))||void 0===n?void 0:n.sort((function(e,t){return e.priority-t.priority})),this.exploreModules&&0!==(null===(i=this.exploreModules)||void 0===i?void 0:i.length)){var o,a=this.tabs.querySelector("#".concat(this.tabExploreId));if(a)o=a;else{(o=Oi("fluent-tab")).id=this.tabExploreId,o.style.gridColumn="3";var s=Oi("P");s.className="paneTabText",s.textContent=this.flyoutData.strings.paneExplore,o.appendChild(s),this.tabs.appendChild(o)}this.addClickListenersToTab(o,this.tabExploreId),this.addTabArrowKeysListeners(o,this.tabExploreId),this.addTabFocusListeners(o,this.exploreShopping),new MutationObserver((function(){r.handleStyleTabSwitch(o),r.sendCTRLogs(r.tabExploreId)})).observe(o,{attributeFilter:["aria-selected"],attributes:!0}),document.getElementById("".concat(this.exploreShopping))||(this.renderModulesInSingleScrollingTabs(this.exploreModules,this.flyoutData.common.shoppingExplore,this.tabExploreId,t),this.flyoutData.common.shoppingExplore.id=this.exploreShopping,this.flyoutData.common.shopping.fixedTitle=this.flyoutData.strings.commonExploreTab)}else this.isExploreZeroState=!0}},{key:"renderModulesInSingleScrollingTabs",value:function(e,t,n,i){try{var r=t;e&&e.length>0&&this.canRenderContentInTab(e,n)?this.appendModulesToShoppingElement(e,r,i):(n===xe.CouponsSavings?this.createTrendingCouponsAsNullState(r):this.createNullState(r),n===this.tabMyShoppingId?this.isMyShoppingZeroState=!0:n===this.tabCouponsSavingsId&&(this.isCouponsSavingsZeroState=!0)),this.scrollContentTo00(r),this.singleScrollingPaneWrapper.appendChild(r)}catch(e){this.onAddingModulesInTabError(e)}}},{key:"switchSingleScrollingTabs",value:function(e){var t=this.tabs.querySelector("#".concat(this.tabMyShoppingId)),n=this.tabs.querySelector("#".concat(this.tabCouponsSavingsId)),i=this.tabs.querySelector("#".concat(this.tabExploreId)),r=document.getElementById("".concat(this.myShoppingShopping)),o=document.getElementById("".concat(this.couponsSavingsShopping)),a=document.getElementById("".concat(this.exploreShopping)),s=document.getElementById(this.panelSingleScrollingId);if(e)n&&o&&!this.isCouponsSavingsZeroState&&(this.scrollTabContentIntoView(o,""),this.onTabGetActivated(this.tabCouponsSavingsId),this.manageTabControls(n,!0,o));else if(t&&r&&!this.isMyShoppingZeroState){if(this.scrollTabContentIntoView(r,""),this.onTabGetActivated(this.tabMyShoppingId),this.manageTabControls(t,!0,null),n){var l=this.getZeroStateContainer(this.couponsSavingsShopping);this.isCouponsSavingsZeroState=!0,this.manageTabControls(n,!1,l)}}else if(i&&a&&!this.isExploreZeroState){if(this.onTabGetActivated(this.tabExploreId),this.manageTabControls(i,!0,null),t){var c=this.getZeroStateContainer(this.myShoppingShopping);this.isMyShoppingZeroState=!0,this.manageTabControls(t,!1,c)}if(n){var u=this.getZeroStateContainer(this.couponsSavingsShopping);this.isCouponsSavingsZeroState=!0,this.manageTabControls(n,!1,u)}this.scrollTabContentIntoView(a,"")}else n&&s&&(this.onTabGetActivated(this.tabCouponsSavingsId),this.manageTabControls(n,!0,s),this.isCouponsSavingsZeroState=!0,this.manageTabControls(t,!1,null),this.isMyShoppingZeroState=!0,i&&(this.manageTabControls(i,!1,null),this.isExploreZeroState=!0),this.createNullState(s))}},{key:"updateSingleScrollTabItemsStyling",value:function(e){var t=0;e===this.tabMyShoppingId?t=1:e===this.tabCouponsSavingsId?t=2:e===this.tabExploreId&&(t=3),this.updateTabItemsStyling(t)}},{key:"handleSingleScrollingTabControlsOnSelected",value:function(e){this.resetSingleScrollingTabs();var t=this.tabs.querySelector("#".concat(e)),n=document.getElementById("".concat(this.panelSingleScrollingId));null==n||n.setAttribute("aria-labelledby","".concat(e)),t&&(t.setAttribute("aria-controls","".concat(this.panelSingleScrollingId)),t.setAttribute("aria-selected","true"),t.tabIndex=0)}},{key:"resetSingleScrollingTabs",value:function(){var e=this.tabs.querySelector("#".concat(this.tabMyShoppingId)),t=this.tabs.querySelector("#".concat(this.tabCouponsSavingsId)),n=this.tabs.querySelector("#".concat(this.tabExploreId));n&&(n.setAttribute("aria-selected","false"),n.setAttribute("aria-controls",""),n.tabIndex=-1),e&&(e.setAttribute("aria-selected","false"),e.setAttribute("aria-controls",""),e.tabIndex=-1),t&&(t.setAttribute("aria-selected","false"),t.setAttribute("aria-controls",""),t.tabIndex=-1),this.tabs.setAttribute("activeid","")}},{key:"handleSingleScrollingTabsOnStartUp",value:function(){if(globalThis.singleScrollingActiveTab){var e=globalThis.singleScrollingActiveTab===xe.MyShopping?Te.MyShopping:globalThis.singleScrollingActiveTab===xe.CouponsSavings?Te.CouponsSavings:null,t=document.getElementById("".concat(e));e&&t&&(this.scrollTabContentIntoView(t,""),this.onTabGetActivated(globalThis.singleScrollingActiveTab))}else this.domainEligible||this.isCjkEnabled?this.switchTabs(!0):this.switchTabs(!1)}},{key:"onTabGetActivated",value:function(e){this.handleSingleScrollingTabControlsOnSelected(e),this.setActiveTabId(e),this.updateSingleScrollTabItemsStyling(e)}},{key:"addClickListenersToTab",value:function(e,t){var n=this,i=this.myShoppingShopping;t===this.tabCouponsSavingsId?i=this.couponsSavingsShopping:t===this.tabExploreId&&(i=this.exploreShopping),e.addEventListener("click",this.sendClickTelemetry.bind(this)),e.addEventListener("click",(function(){var e=document.getElementById("".concat(i));n.scrollTabContentIntoView(e,"smooth"),n.onTabGetActivated(t)}))}},{key:"getZeroStateContainer",value:function(e){var t=this,n=document.getElementById("".concat(e));if(!n){(n=document.createElement("msft-edge-shopping")).id=e;var i=document.getElementById("".concat(this.singleScrollingShopping));if(i)if(e===this.myShoppingShopping){var r=i.firstChild;r?i.insertBefore(n,r):i.appendChild(n)}else if(e===this.couponsSavingsShopping){var o=document.getElementById(this.exploreShopping);o?i.insertBefore(n,o):i.appendChild(n)}}return zi.queueUpdate((function(){t.unobserveAll(),t.addSentinels(),t.setIntersectionObservers()})),n}},{key:"scrollTabContentIntoView",value:function(e,t){var n,i=this,r=null===(n=this.tabs.shadowRoot)||void 0===n?void 0:n.querySelector(".tabpanel"),o=document.getElementById("".concat(this.panelSingleScrollingId));if(e&&r&&o){var a={};"smooth"===t&&(a={behavior:"smooth"}),this.unobserveAll(),o.addEventListener("wheel",this.preventScrollingEvent),e.scrollIntoView(a),this.observeIntervalID||(this.observeIntervalID=setInterval((function(){r&&e.getBoundingClientRect().top<=r.getBoundingClientRect().top+10&&e.getBoundingClientRect().top>=r.getBoundingClientRect().top-10&&(clearInterval(i.observeIntervalID),i.observeIntervalID=null,o.removeEventListener("wheel",i.preventScrollingEvent),i.observeAll())}),100),setTimeout((function(){clearInterval(i.observeIntervalID),i.observeIntervalID=null,o.removeEventListener("wheel",i.preventScrollingEvent),i.observeAll()}),5e3))}else e&&e.scrollIntoView()}},{key:"preventScrollingEvent",value:function(e){e.preventDefault()}},{key:"onScrollToTab",value:function(e){if(this.tabs.querySelector("#".concat(e))&&e){var t=e;t!==this.singleScrollingActiveTabId&&(this.onTabGetActivated(t),this.sendScrollToTabTelemetry(t))}}},{key:"observeAll",value:function(){var e=this;document.querySelectorAll(".sentinel").forEach((function(t){var n;null===(n=e.singleScrollingIntersectionObserver)||void 0===n||n.observe(t)}))}},{key:"unobserveAll",value:function(){var e=this;document.querySelectorAll(".sentinel").forEach((function(t){var n;null===(n=e.singleScrollingIntersectionObserver)||void 0===n||n.unobserve(t)}))}},{key:"addSentinel",value:function(e,t,n){var i=null==e?void 0:e.getElementsByClassName("sentinel");if(!i||i&&0===i.length){var r=Oi("DIV",{style:"\n            position: absolute;\n            left: 0;\n            right: 0;\n            height: 10px;\n            bottom: 50px;\n            z-index: -1;\n            "});r.className="sentinel",r.setAttribute("data-select-tab-up","".concat(t)),r.setAttribute("data-select-tab-down","".concat(n)),null==e||e.appendChild(r)}}},{key:"addSentinels",value:function(){var e=document.getElementById(this.myShoppingShopping),t=document.getElementById(this.couponsSavingsShopping),n=document.getElementById(this.exploreShopping);e&&this.addSentinel(e,this.tabCouponsSavingsId,this.tabMyShoppingId),t&&n&&this.addSentinel(t,this.tabExploreId,this.tabCouponsSavingsId)}},{key:"setIntersectionObservers",value:function(){var e,t={root:null===(e=this.tabs.shadowRoot)||void 0===e?void 0:e.querySelector(".tabpanel"),rootMargin:"0px"};this.singleScrollingIntersectionObserver=new IntersectionObserver(this.intersectionObserverCallback.bind(this),t),this.observeAll()}},{key:"intersectionObserverCallback",value:function(e){var t=this;e.forEach((function(e){if(!e.isIntersecting&&e.rootBounds&&e.boundingClientRect.top<=e.rootBounds.top&&e.boundingClientRect.height*e.boundingClientRect.width>0){var n=e.target.getAttribute("data-select-tab-up");t.onScrollToTab(n)}else if(e.rootBounds&&e.boundingClientRect.top<e.rootBounds.top+100&&e.boundingClientRect.height*e.boundingClientRect.width>0){var i=e.target.getAttribute("data-select-tab-down");t.onScrollToTab(i)}}))}},{key:"addTabArrowKeysListeners",value:function(e,t){var n=this,i=this.tabMyShoppingId,r=this.myShoppingShopping,o=this.tabCouponsSavingsId,a=this.couponsSavingsShopping;t===this.tabMyShoppingId?(i=this.tabCouponsSavingsId,r=this.couponsSavingsShopping,o=this.tabExploreId,a=this.exploreShopping):t===this.tabCouponsSavingsId&&(i=this.tabExploreId,r=this.exploreShopping,o=this.tabMyShoppingId,a=this.myShoppingShopping),e.addEventListener("keydown",(function(t){"ArrowRight"===t.key?n.arrowKeydownCallback(e,i,r):"ArrowLeft"===t.key&&n.arrowKeydownCallback(e,o,a)}))}},{key:"arrowKeydownCallback",value:function(e,t,n){e.blur(),this.tabs.querySelector("#".concat(t)).focus();var i=document.getElementById(n);this.scrollTabContentIntoView(i,""),this.onTabGetActivated(t)}},{key:"addTabFocusListeners",value:function(e,t){e.addEventListener("keydown",(function(e){if("Tab"===e.key&&!e.shiftKey){var n=document.getElementById(t);if(n){e.preventDefault();var i=_u.getFirstFocusableElementInParent(n);i&&i.focus()}}}))}},{key:"renderReRankedContextualModules",value:function(e,t){if(e&&0!==e.length&&!this.isSameModuleTypesArray(e)){var n=document.querySelector("#".concat(this.contextualShopping));if(n){var i=n.getElementsByClassName("sectionSeparator");if(i&&i.length>0)for(var r=i.length-1;r>=0;--r)i[r].remove();if(this.contextualModules&&this.contextualModules.length>0)for(var o=this.contextualModules.length-1;o>=0;--o)this.contextualModules[o].element.remove();this.renderModulesInTab(e,this.flyoutData.common.shopping,this.panelContextualId,t),this.contextualModules=e,this.updateHeader(e[0])}}}},{key:"renderReRankedContextualModulesInSinglePane",value:function(e,t){if(e&&0!==e.length&&!this.isSameModuleTypesArray(e)){var n=document.getElementById("".concat(this.couponsSavingsShopping));if(n){var i=n.getElementsByClassName("sectionSeparator");if(i&&i.length>0)for(var r=i.length-1;r>=0;--r)i[r].remove();if(this.contextualModules&&this.contextualModules.length>0)for(var o=this.contextualModules.length-1;o>=0;--o)this.contextualModules[o].element.remove();this.reRenderModulesInSingleScrollingTabs(e,n,this.tabCouponsSavingsId,t),this.contextualModules=e,this.updateHeader(e[0])}}}},{key:"reRenderModulesInSingleScrollingTabs",value:function(e,t,n,i){try{var r=t;e&&e.length>0&&this.canRenderContentInTab(e,n)?this.appendModulesToShoppingElement(e,r,i):(this.createNullState(r),n===this.tabMyShoppingId?this.isMyShoppingZeroState=!0:n===this.tabCouponsSavingsId&&(this.isCouponsSavingsZeroState=!0)),this.scrollContentTo00(r)}catch(e){this.onAddingModulesInTabError(e)}}},{key:"updateHeader",value:function(e){e.name!==re.COUPON&&(e.element.isHeader=!0,e.element.slot="header-content")}},{key:"isSameModuleTypesArray",value:function(e){var t=this,n=!0;return e.forEach((function(e){var i,r=t.contextualModules.findIndex((function(t){return t.name===e.name}));-1!==r&&(null===(i=t.contextualModules.at(r))||void 0===i?void 0:i.priority)===e.priority||(n=!1)})),n}},{key:"restoreTabName",value:function(){var e=this.tabs.querySelector("#".concat(this.tabContextualId));e&&(e.textContent=this.flyoutData.strings.paneForYou);var t=this.tabs.querySelector("#".concat(this.tabCouponsSavingsId));t&&(t.textContent=this.flyoutData.strings.paneCouponsSavings)}}]),a}(jte),Uie=Fie,Hie=function(){function e(){r(this,e)}return c(e,null,[{key:"getModuleOrCreate",value:function(e,t,n,i){if(this.cache.has(e))return this.cache.get(e);var r=new t(n,i);return this.cache.set(e,r),r}},{key:"getStartShoppingModuleOrCreate",value:function(e,t,n,i){return this.getModuleOrCreate(e,t,n,i)}}]),e}();u(Hie,"cache",new Map);var Gie=function(){function e(t,n,i){r(this,e),u(this,"axShopModule",void 0),u(this,"axShopNotificationModule",void 0),u(this,"cashBackModule",void 0),u(this,"cashBackActivateModule",void 0),u(this,"checkoutAutofillModule",void 0),u(this,"couponsModule",void 0),u(this,"dealsModule",void 0),u(this,"recommendationsModule",void 0),u(this,"recommendationsNotificationModule",void 0),u(this,"clippingModule",void 0),u(this,"priceComparisonModule",void 0),u(this,"priceHistoryModule",void 0),u(this,"bannerModule",void 0),u(this,"flyoutRendererModule",void 0),u(this,"paneRendererModule",void 0),u(this,"discoverPaneRendererModule",void 0),u(this,"stateManagementModule",void 0),u(this,"productHistoryModule",void 0),u(this,"similarSellerModule",void 0),u(this,"tipsModule",void 0),u(this,"flyoutData",void 0),u(this,"utilities",void 0),u(this,"commonAssets",void 0),u(this,"rewardModule",void 0),u(this,"cashBackNotificationModule",void 0),u(this,"similarSellersNotificationModule",void 0),u(this,"rewardNotificationModule",void 0),u(this,"priceComparisonNotificationModule",void 0),u(this,"paymentOptionsModule",void 0),u(this,"socialCouponsNotificationModule",void 0),u(this,"socialCouponsModule",void 0),u(this,"socialCouponsPersistentModule",void 0),u(this,"microNotificationModule",void 0),u(this,"packageTrackingModule",void 0),u(this,"sustainabilityModule",void 0),u(this,"sustainabilityNotificationModule",void 0),u(this,"packageTrackingConfirmationNotificationModule",void 0),u(this,"postPurchaseConsentNotificationModule",void 0),u(this,"virtualCardModule",void 0),u(this,"virtualCardNotificationModule",void 0),u(this,"viewedProductPriceDropNotificationModule",void 0),u(this,"groceryCouponModule",void 0),u(this,"printableCouponModule",void 0),u(this,"giftCardModule",void 0),u(this,"giftCardNotificationModule",void 0),u(this,"feedbackModule",void 0),u(this,"itemizedCashBackModule",void 0),u(this,"groceryCashbackModule",void 0),u(this,"groceryCashbacPendingkModule",void 0),u(this,"groceryCashbackActivatedModule",void 0),u(this,"groceryCashbackNotificationModule",void 0),u(this,"groceryCashbackPendingNotificationModule",void 0),u(this,"itemizedCashBackNotificationModule",void 0),u(this,"autosMarketplaceModule",void 0),u(this,"autosMyGarageModule",void 0),u(this,"autosReviewsModule",void 0),u(this,"autosPriceInsightModule",void 0),u(this,"autosIncentivesModule",void 0),u(this,"autosMarketplaceNotificationModule",void 0),u(this,"autosPriceInsightNotificationModule",void 0),u(this,"autosReviewsModuleNotificationModule",void 0),u(this,"priceHistoryNotificationModule",void 0),u(this,"momentInTimeModule",void 0),u(this,"trendingOffersModule",void 0),u(this,"similarOffersModule",void 0),u(this,"trendingOffersOnContextualTabModule",void 0),u(this,"wishlistModule",void 0),u(this,"campaignBannerModule",void 0),u(this,"campaignPDPCashbackModule",void 0),u(this,"campaignPDPCashbacNotificationModule",void 0),u(this,"campaignAwarenessNotificationModule",void 0),u(this,"campaignFeedModule",void 0),u(this,"dailyDealsModule",void 0),u(this,"nativeAdsModule",void 0),u(this,"visualSearchModule",void 0),u(this,"buyDirectModule",void 0),u(this,"couponsNotificationModule",void 0),u(this,"productBestCouponNotificationModule",void 0),u(this,"infiniteCategoryFeedModule",void 0),u(this,"shopRunnerShippingFeeSavingsNotificationModule",void 0),u(this,"shopRunnerSignUpNotificationModule",void 0),u(this,"shopRunnerSuccessfulSignUpNotificationModule",void 0),u(this,"shopRunnerModule",void 0),u(this,"productCollectionsModule",void 0),u(this,"abandonedCartModule",void 0),u(this,"winCartModule",void 0),u(this,"abandonedCartNotificationModule",void 0),u(this,"priceDropPlusCouponsCompositeNotificationModule",void 0),u(this,"priceDropPlusCashbackCompositeNotificationModule",void 0),u(this,"cashbackPlusCouponsCompositeNotificationModule",void 0),u(this,"productTrackingModule",void 0),u(this,"productTrackingNotificationModule",void 0),u(this,"communityCouponsModule",void 0),u(this,"clippingNotificationModule",void 0),u(this,"checkoutAutofillNotificationModule",void 0),u(this,"inboxCouponsModule",void 0),u(this,"activeRetailerInboxCouponsModule",void 0),u(this,"trendingCouponsModule",void 0),u(this,"trendingCouponsNotificationModule",void 0),u(this,"sanConsentModule",void 0),u(this,"sanConsentNotificationModule",void 0),u(this,"goodRxModule",void 0),u(this,"goodRxNotificationModule",void 0),u(this,"discoverChatChipsModule",void 0),u(this,"smartCompareModule",void 0),u(this,"productSummaryModule",void 0),u(this,"buyingGuidesModule",void 0),u(this,"cjkSimilarProductsModule",void 0),u(this,"enrollRebatesConfirmationNotificationModule",void 0),this.flyoutData=t,this.utilities=n,this.commonAssets=i}return c(e,[{key:"GetAXShopModule",value:function(){return this.axShopModule||(this.axShopModule=new pV(this.GetStateManagementModule(),this.flyoutData,this.utilities,this.commonAssets)),this.axShopModule}},{key:"GetAXShopNotificationModule",value:function(){return this.axShopNotificationModule||(this.axShopNotificationModule=new fV(this.flyoutData,this.utilities)),this.axShopNotificationModule}},{key:"GetEnrollRebatesConfirmationNotificationModule",value:function(){return this.enrollRebatesConfirmationNotificationModule||(this.enrollRebatesConfirmationNotificationModule=new Fne(this.flyoutData,this.utilities,this.stateManagementModule)),this.enrollRebatesConfirmationNotificationModule}},{key:"GetCouponModule",value:function(){return this.couponsModule||(this.couponsModule=new cq(this.GetStateManagementModule(),this.flyoutData,this.utilities,this.commonAssets)),this.couponsModule}},{key:"GetDealsModule",value:function(){return this.dealsModule||(this.dealsModule=new mq(this.flyoutData,this.utilities)),this.dealsModule}},{key:"GetRecommendationsModule",value:function(){return this.recommendationsModule||(this.recommendationsModule=new o9(this.flyoutData,this.utilities)),this.recommendationsModule}},{key:"GetRecommendationsNotificationModule",value:function(){return this.recommendationsNotificationModule||(this.recommendationsNotificationModule=new h9(this.flyoutData,this.utilities)),this.recommendationsNotificationModule}},{key:"GetSimilarSellerModule",value:function(){return this.similarSellerModule||(this.similarSellerModule=new B9(this.flyoutData,this.utilities,this.commonAssets)),this.similarSellerModule}},{key:"GetTipsModule",value:function(){return this.tipsModule||(this.tipsModule=new m7(this.flyoutData,this.utilities)),this.tipsModule}},{key:"GetCashBackModule",value:function(){return this.cashBackModule||(this.cashBackModule=new rW(this.GetStateManagementModule(),this.flyoutData,this.utilities,this.commonAssets)),this.cashBackModule}},{key:"GetCashBackActivateModule",value:function(){return this.cashBackActivateModule||(this.cashBackActivateModule=new uW(this.GetStateManagementModule(),this.flyoutData,this.utilities,this.commonAssets)),this.cashBackActivateModule}},{key:"GetPriceComparisonModule",value:function(){return this.priceComparisonModule||(this.priceComparisonModule=new JJ(this.GetStateManagementModule(),this.flyoutData,this.utilities)),this.priceComparisonModule}},{key:"GetPriceHistoryModule",value:function(){return this.priceHistoryModule||(this.priceHistoryModule=new Q6(this.GetStateManagementModule(),this.flyoutData,this.utilities)),this.priceHistoryModule}},{key:"GetClippingModule",value:function(){return this.clippingModule||(this.clippingModule=new vz(this.flyoutData,this.utilities,this.GetStateManagementModule(),this.commonAssets)),this.clippingModule}},{key:"GetAutosReviewsModule",value:function(){return this.autosReviewsModule||(this.autosReviewsModule=new qG(this.GetStateManagementModule(),this.flyoutData,this.utilities)),this.autosReviewsModule}},{key:"GetMomentInTimeModule",value:function(){return this.momentInTimeModule||(this.momentInTimeModule=Hie.getStartShoppingModuleOrCreate(re.MOMENT_IN_TIME,PJ,this.flyoutData,this.utilities)),this.momentInTimeModule}},{key:"GetTrendingOffersModule",value:function(){return this.trendingOffersModule||(this.trendingOffersModule=Hie.getStartShoppingModuleOrCreate(re.TRENDING_OFFERS,rZ,this.flyoutData,this.utilities)),this.trendingOffersModule}},{key:"GetTrendingOffersOnContextualTabModule",value:function(){return this.trendingOffersOnContextualTabModule||(this.trendingOffersOnContextualTabModule=Hie.getStartShoppingModuleOrCreate(re.TRENDING_OFFERS_ON_CONTEXTUAL_TAB,sZ,this.flyoutData,this.utilities)),this.trendingOffersOnContextualTabModule}},{key:"GetSimilarOffersModule",value:function(){return this.similarOffersModule||(this.similarOffersModule=new tZ(this.flyoutData,this.utilities)),this.similarOffersModule}},{key:"GetWishlistModule",value:function(){return this.wishlistModule||(this.wishlistModule=new iee(this.stateManagementModule,this.flyoutData,this.utilities)),this.wishlistModule}},{key:"GetCampaignBannerModule",value:function(){return this.campaignBannerModule||(this.campaignBannerModule=new rj(this.flyoutData,this.utilities)),this.campaignBannerModule}},{key:"GetCampaignPDPCashbackModule",value:function(){return this.campaignPDPCashbackModule||(this.campaignPDPCashbackModule=new sW(this.GetStateManagementModule(),this.flyoutData,this.utilities,this.commonAssets)),this.campaignPDPCashbackModule}},{key:"GetCampaignPDPCashbackNotificationModule",value:function(){return this.campaignPDPCashbacNotificationModule||(this.campaignPDPCashbacNotificationModule=new fne(this.GetStateManagementModule(),this.flyoutData,this.utilities,this.commonAssets)),this.campaignPDPCashbacNotificationModule}},{key:"GetCampaignAwarenessNotificationModule",value:function(){return this.campaignAwarenessNotificationModule||(this.campaignAwarenessNotificationModule=new dne(this.flyoutData,this.utilities)),this.campaignAwarenessNotificationModule}},{key:"GetCampaignFeedModule",value:function(){return this.campaignFeedModule||(this.campaignFeedModule=Hie.getStartShoppingModuleOrCreate(re.FEED_CAMPAIGN,HX,this.flyoutData,this.utilities)),this.campaignFeedModule}},{key:"GetDailyDealsModule",value:function(){return this.dailyDealsModule||(this.dailyDealsModule=Hie.getStartShoppingModuleOrCreate(re.DAILY_DEALS,jX,this.flyoutData,this.utilities)),this.dailyDealsModule}},{key:"GetVisualSearchModule",value:function(){return this.visualSearchModule||(this.visualSearchModule=new mZ(this.flyoutData,this.utilities)),this.visualSearchModule}},{key:"GetNativeAdsModule",value:function(){return this.nativeAdsModule||(this.nativeAdsModule=Hie.getStartShoppingModuleOrCreate(re.NATIVE_ADS,ZX,this.flyoutData,this.utilities)),this.nativeAdsModule}},{key:"GetBuyDirectModule",value:function(){return this.buyDirectModule||(this.buyDirectModule=Hie.getStartShoppingModuleOrCreate(re.BUY_DIRECT,NX,this.flyoutData,this.utilities)),this.buyDirectModule}},{key:"GetInfiniteCategoryFeedModule",value:function(){return this.infiniteCategoryFeedModule||(this.infiniteCategoryFeedModule=Hie.getStartShoppingModuleOrCreate(re.INFINITE_CATEGORY_FEED,YX,this.flyoutData,this.utilities)),this.infiniteCategoryFeedModule}},{key:"GetBannerModule",value:function(){return this.bannerModule||(this.bannerModule=new CV(this.GetCashBackModule(),this.GetPriceComparisonModule(),this.GetPriceHistoryModule(),this.GetCouponModule(),this.flyoutData,this.GetStateManagementModule(),this.utilities,this.commonAssets)),this.bannerModule}},{key:"GetFlyoutRendererModule",value:function(){if(!this.flyoutRendererModule){var e,t,n=null!==(e=null===(t=this.flyoutData.common.lastCommittedURL)||void 0===t?void 0:t.includes("pinterest.com/pin"))&&void 0!==e&&e;this.flyoutRendererModule=new Jte(this.GetStateManagementModule(),this.flyoutData,this.utilities,this.commonAssets,n?this.GetAvailableGuestModules():this.GetAvailableModules(),this.GetAvailableNotificationModules(),this.GetBannerModule())}return this.flyoutRendererModule}},{key:"GetPaneRendererModule",value:function(){return this.paneRendererModule||(this.paneRendererModule=new Uie(this.GetStateManagementModule(),this.flyoutData,this.utilities,this.commonAssets,this.GetAvailableModules(),this.GetAvailableNotificationModules(),this.GetBannerModule(),this.GetTrendingCouponsModule())),this.paneRendererModule}},{key:"GetDiscoverPaneRendererModule",value:function(){return this.discoverPaneRendererModule||(this.discoverPaneRendererModule=new Kte(this.GetStateManagementModule(),this.flyoutData,this.utilities,this.commonAssets,this.GetDiscoverPaneAvailableModules())),this.discoverPaneRendererModule}},{key:"GetCheckoutAutofillModule",value:function(){return this.checkoutAutofillModule||(this.checkoutAutofillModule=new BW(this.flyoutData,this.utilities)),this.checkoutAutofillModule}},{key:"GetStateManagementModule",value:function(e){var t;this.stateManagementModule||(t=e||document.querySelector("#divContentWrapper"),this.stateManagementModule=new ar(this.utilities.logModule,t));return this.stateManagementModule}},{key:"GetProductHistoryModule",value:function(){return this.productHistoryModule||(this.productHistoryModule=new B8(this.GetStateManagementModule(),this.flyoutData,this.utilities)),this.productHistoryModule}},{key:"GetRewardModule",value:function(){return this.rewardModule||(this.rewardModule=new C9(this.flyoutData,this.utilities,this.GetStateManagementModule())),this.rewardModule}},{key:"GetPackageTrackingModule",value:function(){return this.packageTrackingModule||(this.packageTrackingModule=new BJ(this.flyoutData,this.utilities,this.GetStateManagementModule(),this.commonAssets)),this.packageTrackingModule}},{key:"GetSustainabilityModule",value:function(){return this.sustainabilityModule||(this.sustainabilityModule=new d7(this.flyoutData,this.utilities)),this.sustainabilityModule}},{key:"GetPackageTrackingConfirmationNotificationModule",value:function(){return this.packageTrackingConfirmationNotificationModule||(this.packageTrackingConfirmationNotificationModule=new tie(this.flyoutData,this.utilities,this.GetStateManagementModule(),this.commonAssets)),this.packageTrackingConfirmationNotificationModule}},{key:"GetPostPurchaseConsentNotificationModule",value:function(){return this.postPurchaseConsentNotificationModule||(this.postPurchaseConsentNotificationModule=new nie(this.flyoutData,this.utilities,this.GetStateManagementModule(),this.commonAssets)),this.postPurchaseConsentNotificationModule}},{key:"GetCashBackNotificationModule",value:function(){return this.cashBackNotificationModule||(this.cashBackNotificationModule=new gW(this.GetStateManagementModule(),this.flyoutData,this.utilities,this.commonAssets)),this.cashBackNotificationModule}},{key:"GetSimilarSellersNotificationModule",value:function(){return this.similarSellersNotificationModule||(this.similarSellersNotificationModule=new V9(this.flyoutData,this.utilities,this.commonAssets)),this.similarSellersNotificationModule}},{key:"GetRewardNotificationModule",value:function(){return this.rewardNotificationModule||(this.rewardNotificationModule=new lie(this.GetStateManagementModule(),this.flyoutData,this.utilities)),this.rewardNotificationModule}},{key:"GetPriceComparisonNotificationModule",value:function(){return this.priceComparisonNotificationModule||(this.priceComparisonNotificationModule=new IQ(this.GetStateManagementModule(),this.flyoutData,this.utilities)),this.priceComparisonNotificationModule}},{key:"GetSocialCouponsNotificationModule",value:function(){return this.socialCouponsNotificationModule||(this.socialCouponsNotificationModule=new r7(this.GetStateManagementModule(),this.flyoutData,this.utilities,this.commonAssets)),this.socialCouponsNotificationModule}},{key:"GetGiftCardNotificationModule",value:function(){return this.giftCardNotificationModule||(this.giftCardNotificationModule=new Hne(this.flyoutData,this.utilities,this.commonAssets)),this.giftCardNotificationModule}},{key:"GetSocialCouponsModule",value:function(){return this.socialCouponsModule||(this.socialCouponsModule=new t7(this.GetStateManagementModule(),this.flyoutData,this.utilities,this.commonAssets)),this.socialCouponsModule}},{key:"GetSocialCouponsPersistentModule",value:function(){return this.socialCouponsPersistentModule||(this.socialCouponsPersistentModule=new s7(this.GetStateManagementModule(),this.flyoutData,this.utilities)),this.socialCouponsPersistentModule}},{key:"GetPaymentOptionsModule",value:function(){return this.paymentOptionsModule||(this.paymentOptionsModule=new jJ(this.flyoutData,this.utilities)),this.paymentOptionsModule}},{key:"GetMicroNotificationModule",value:function(){return this.microNotificationModule||(this.microNotificationModule=tte.getMicroNotificationModule(this.GetStateManagementModule(),this.flyoutData,this.utilities,this.commonAssets)),this.microNotificationModule}},{key:"GetViewedProductPriceDropNotificationModule",value:function(){return this.viewedProductPriceDropNotificationModule||(this.viewedProductPriceDropNotificationModule=new bie(this.GetStateManagementModule(),this.flyoutData,this.utilities)),this.viewedProductPriceDropNotificationModule}},{key:"GetVirtualCardModule",value:function(){return this.virtualCardModule||(this.virtualCardModule=new H7(this.flyoutData,this.utilities)),this.virtualCardModule}},{key:"GetVirtualCardNotificationModule",value:function(){return this.virtualCardNotificationModule||(this.virtualCardNotificationModule=new xie(this.GetStateManagementModule(),this.flyoutData,this.utilities)),this.virtualCardNotificationModule}},{key:"GetSustainabilityNotificationModule",value:function(){return this.sustainabilityNotificationModule||(this.sustainabilityNotificationModule=new h7(this.flyoutData,this.utilities)),this.sustainabilityNotificationModule}},{key:"GetGroceryCouponModule",value:function(){return this.groceryCouponModule||(this.groceryCouponModule=new lJ(this.flyoutData,this.utilities)),this.groceryCouponModule}},{key:"GetPrintableCouponModule",value:function(){return this.printableCouponModule||(this.printableCouponModule=new b8(this.flyoutData,this.utilities)),this.printableCouponModule}},{key:"GetGiftCardModule",value:function(){return this.giftCardModule||(this.giftCardModule=new SZ(this.flyoutData,this.utilities,this.commonAssets)),this.giftCardModule}},{key:"GetFeedbackModule",value:function(){return this.feedbackModule||(this.feedbackModule=new Pq(this.flyoutData,this.utilities,this.GetStateManagementModule(),this.commonAssets)),this.feedbackModule}},{key:"GetItemizedCashbackModule",value:function(){return this.itemizedCashBackModule||(this.itemizedCashBackModule=new vJ(this.flyoutData,this.utilities,this