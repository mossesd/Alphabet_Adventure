turn[];const t=[];return e.postConfirmCallback&&t.push({name:s.lR.PostConfirm,action:e.postConfirmCallback}),e.preCloseCallback&&t.push({name:s.lR.PreClose,action:e.preCloseCallback}),e.postCloseCallback&&t.push({name:s.lR.PostClose,action:e.postCloseCallback}),e.preActiveElementIds&&t.push({name:s.lR.PreActiveElementIds,action:e.preActiveElementIds}),e.closeByDocument&&t.push({name:s.lR.CloseByDocument,action:e.closeByDocument}),t})(t);this.dialogCallback.set(n,c);const d=(e=>{if(!e)return[];const t=[];return e.dialogTitle&&t.push({title:s._d.DialogTitle,text:e.dialogTitle}),e.dialogText&&t.push({title:s._d.DialogText,text:e.dialogText}),e.primaryButton&&t.push({title:s._d.PrimaryButton,text:e.primaryButton.text||""}),e.confirmMessageTitle&&t.push({title:s._d.ConfirmMessageTitle,text:e.confirmMessageTitle}),e.confirmMessageHtmlBody&&t.push({title:s._d.ConfirmMessageHtmlBody,text:e.confirmMessageHtmlBody}),e.okButtonText&&t.push({title:s._d.OkButtonText,text:e.okButtonText}),t})(t);this.dialogData.set(n,{dialogContent:d});const u="calling-content-event",g={visibility:a.cP.Show},m={source:{name:"DialogOpen",description:e}},h={event:e===a.WB.OptionsSettings?{typeName:u,content:{contentType:"calling-external-settings-pane",tabItemId:t.tabItemId},action:g}:{typeName:u,content:{contentType:"dialog",id:n,name:e,dialogActions:c.map((e=>e.name)),dialogStrings:d},action:g},context:m};l.mark(o.ck.BeforeCallingDialogCallingAppEventTriggered);try{yield this.callingAppEventsService.trigger(h)}catch(e){const t=`[open] Opening dialog error [dialogId: ${n}, error.name: ${null==e?void 0:e.name}, error.message: ${null==e?void 0:e.message}]`;return this.logger.error(t),l.fail({errors:t,errorCode:"calling-app-event-not-triggered"}),Promise.reject(null)}l.mark(o.ck.AfterCallingDialogCallingAppEventTriggered);const p=(null===(i=c.find((e=>e.name===s.lR.PostClose)))||void 0===i?void 0:i.action)||(()=>{});return Promise.resolve({id:n,close:p,closePromise:Promise.resolve({id:"",value:""})})}))}getDialogData(e){if(this.logger.log(`Getting dialog data for dialog ${e}`),!this.dialogData.get(e))throw new Error(`Unable to find out dialog data with id: ${e}`);return this.dialogData.get(e)||{}}executeDialogAction(e,t){var i;this.logger.log(`Attempting to execute ${t.toString()} action for dialog ${e}`);const n=null===(i=this.dialogActions(e).find((e=>e.name===t)))||void 0===i?void 0:i.action;if(!n)throw new Error(`Action ${t.toString()} not found for dialog ${e}`);n()}dialogActions(e){var t;this.logger.log(`Getting actions for dialog ${e}`);return(null===(t=this.dialogCallback)||void 0===t?void 0:t.get(e))||[]}}},228443:(e,t,i)=>{"use strict";var n,r,o;i.d(t,{WB:()=>n,lR:()=>r,_d:()=>o}),function(e){e.Alert="Alert",e.CallingConfirm="CallingConfirm",e.CallingUnparkCall="CallingUnparkCall",e.OptionsSettings="optionsSettingsDialog",e.PrejoinOverlay="PrejoinOverlay",e.UserMedia="GetUserMediaDialog"}(n||(n={})),function(e){e.PostConfirm="PostConfirm",e.PreClose="PreClose",e.PostClose="PostClose",e.PreActiveElementIds="PreActiveElementIds",e.CloseByDocument="CloseByDocument"}(r||(r={})),function(e){e.DialogTitle="DialogTitle",e.DialogText="DialogText",e.PrimaryButton="PrimaryButton",e.ConfirmMessageTitle="ConfirmMessageTitle",e.ConfirmMessageHtmlBody="ConfirmMessageHtmlBody",e.OkButtonText="OkButtonText"}(o||(o={}))},158853:(e,t,i)=>{"use strict";i.d(t,{V:()=>s});var n=i(659334),r=i(202663),o=i(137021);class s{constructor(e,t,i){var n,r;this.loggerFactory=e,this.scenarioFactory=t,this.platformService=i,this.context={},this._deviceId="",this.sessionId="seessionId",this.service=this,this.internalLogger=this.wrapLogger(e.newLogger("CallingLoggingService","services-io-calling-service-adapters")),this.sessionId=null===(r=null===(n=this.platformService)||void 0===n?void 0:n.host)||void 0===r?void 0:r.sessionId}deviceId(){var e,t;return(null===(t=null===(e=this.platformService)||void 0===e?void 0:e.host)||void 0===t?void 0:t.deviceId)||this.getDeviceId()}logMessage(e,t,i,n){var o,a;if(n===r.LogLevel.None)return!1;const l=s.loglevelMap.get(n)||"debug",c=` [${e}] `.concat(t);return null===(a=(o=this.internalLogger)[l])||void 0===a?void 0:a.call(o,c,...i)}newLogger(e){return this.wrapLogger(this.loggerFactory.newLogger(e,"services-io-calling-service-adapters"))}newScenario(e,t,i,n,r,o,s,a,l,c,d,u){var g,m;const h={callback:i,timeoutMs:n,startTime:s,clientId:c},p=this.scenarioFactory.newScenario(e,h);return u&&(null===(m=(g=this.scenarioFactory).hoistScenarioToCore)||void 0===m||m.call(g,p)),this.wrapScenario(p)}event(e,t){this.internalLogger.warn("LoggingService.event is not implemented!")}findAllScenariosByName(e){return this.internalLogger.warn("LoggingService.findAllScenariosByName is not implemented!"),[]}findScenario(e){return this.wrapScenarioOpt(this.scenarioFactory.findScenario(e))}findScenarioByNameAndId(e,t){return this.wrapScenarioOpt(this.scenarioFactory.findScenarioByNameAndId(e,t))}getContext(){return this.context}registerEventDecorator(e){(0,o.Rr)(e)}setContext(e,t,i){this.context[e]={value:t,piiKind:i}}log(e,...t){return this.internalLogger.log(e,...t)}warn(e,...t){return this.internalLogger.warn(e,...t)}error(e,...t){return this.internalLogger.error(e,...t)}errorToTelemetry(e,t,i,n){return this.internalLogger.errorToTelemetry?this.internalLogger.errorToTelemetry(e,t,i,n):(this.internalLogger.warn("LoggingService.errorToTelemetry is not implemented!"),this.internalLogger.error(e),!0)}infoToTelemetry(e,t,i,n){if(!this.internalLogger.infoToTelemetry)return this.internalLogger.warn("LoggingService.infoToTelemetry is not implemented!"),void this.internalLogger.log(e);this.internalLogger.infoToTelemetry(e,t,i,n)}info(e,...t){return this.internalLogger.info(e,...t)}debug(e,...t){return this.internalLogger.debug(e,...t)}getDeviceId(){return this._deviceId||(this._deviceId=(0,n.v4)())}wrapScenarioOpt(e){return e&&this.wrapScenario(e)}wrapScenario(e){return new Proxy(e,{has:(e,t)=>"cancelIfOffline"===t||"clientId"===t||Reflect.has(e,t),get:(t,i,n)=>{switch(i){case"whenStopped":return Promise.resolve("");case"cancelIfOffline":return!1;case"clientId":return e.clientId||"";case"stop":return(t,i,n)=>{return"string"==typeof i?e.stop(t,["success","failure","timeout","abandoned","incomplete","tab_switched","app_minimized"].includes(r=i)?r:void 0):e.stop(t,n);var r};case"timeoutInMs":return t=>{this.scenarioFactory.changeTimeout&&this.scenarioFactory.changeTimeout(e,t)}}return Reflect.get(t,i,n)},set:(t,i,n,r)=>{switch(i){case"cancelIfOffline":return!0;case"clientId":return e.clientId=n,!0}return Reflect.set(t,i,n,r)}})}wrapLogger(e){const t=(t,i,n)=>{var r;return null===(r=e[t])||void 0===r||r.call(e,i,...n),!0};return{service:this,log:(e,...i)=>t("log",e,i),warn:(e,...i)=>t("warn",e,i),error:(e,...i)=>t("error",e,i),info:(e,...i)=>t("log",e,i),debug:(e,...i)=>t("debug",e,i),errorToTelemetry:(t,i,n,r)=>{var o;return null===(o=e.errorToTelemetry)||void 0===o||o.call(e,t,i,n,r),!0},infoToTelemetry:(t,i,n,r)=>{var o;return null===(o=e.infoToTelemetry)||void 0===o||o.call(e,t,i,n,r),!0}}}}s.loglevelMap=new Map([[r.LogLevel.Debug,"debug"],[r.LogLevel.Verbose,"debug"],[r.LogLevel.Info,"log"],[r.LogLevel.Warn,"warn"],[r.LogLevel.Error,"error"],[r.LogLevel.Max,"error"]])},609485:(e,t,i)=>{"use strict";i.d(t,{HI:()=>n,LC:()=>r,aO:()=>o,YK:()=>s,UQ:()=>a});const n={addMembersToThread:"addMembersToThread",createThread:"createThread",deleteConversation:"deleteConversation",locationSharingQuery:"locationSharingQuery",removeMemberFromThread:"removeMemberFromThread",updateThreadProperties:"updateThreadProperties"},r={addMembersToThread:"beta/groups/{threadId}/members",createThread:"beta/groups/create",deleteConversation:"beta/groups/{threadId}/deleteChat",locationSharingQuery:"https://teams.live.com/api/location/prod",removeMemberFromThread:"beta/groups/{threadId}/members/{userMri}",updateThreadProperties:"beta/groups/{threadId}/properties"},o="ConsumerGroupsService",s="{threadId}",a="{userMri}"},624919:(e,t,i)=>{"use strict";i.d(t,{jP:()=>b,O5:()=>T,Nc:()=>I});var n=i(50805),r=i(486070),o=i(8122),s=i(299295),a=i(844729),l=i(609485),c=i(142513),d=i(863553),u=i(760005);const g=(e,t,i)=>(n,r)=>({url:e.replace(t,encodeURIComponent(n)).replace(i,encodeURIComponent(r)),method:"DELETE",headers:{"content-type":"application/json"},serviceName:o.EJ.GroupsServiceV2,apiName:l.HI.removeMemberFromThread}),m=(e,t)=>(i,n)=>{const r={topic:n};return{url:e.replace(t,encodeURIComponent(i)),method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(r),serviceName:o.EJ.GroupsServiceV2,apiName:l.HI.updateThreadProperties}},h=(e,t)=>i=>({url:e.replace(t,encodeURIComponent(i)),method:"DELETE",headers:{"content-type":"application/json"},serviceName:o.EJ.GroupsServiceV2,apiName:l.HI.deleteConversation}),p=(e,t)=>{const i={Query:e};return{url:`${t}/graphql`,method:"POST",headers:{"content-type":"application/json;charset=utf-8"},body:JSON.stringify(i),serviceName:o.EJ.MiddleTier,apiName:l.HI.locationSharingQuery}};function v(e){return(0,c.__awaiter)(this,void 0,void 0,(function*(){const{status:t,headers:{location:i},body:n}=e;if(void 0===i)throw new Error("location undefined");return{status:t,threadId:(0,d.F)(i),responseBody:n}}))}const y="v1/threads/{threadId}/members",f="v1/threads",S="v1/threads/{threadId}",k="v1/threads/{threadId}/members/{userMri}",w="v1/threads/{threadId}/properties",b="https://groupssvc.fl.teams.microsoft.com/teams.readwrite";function C(e){return Promise.resolve({constructRequest:e,rejectHttpError:!0})}const _=(e,t,i)=>{const n=(0,a.h)(t,i),r=(0,s.g)(C,n);return{addMembersToThread:r((d=e.groupsServiceAddToRosterEndpoint||y,b=e.groupsServiceThreadIdParameterToken||l.YK,(e,t,i=!0)=>{const n=d.replace(b,encodeURIComponent(e)),r=i?{members:t.map((e=>({id:e.id,role:u.nL.Admin,shareHistoryTime:0})))}:{members:t.map((e=>({id:e.id,role:e.role,shareHistoryTime:0})))};return{url:n,method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(r),serviceName:o.EJ.GroupsServiceV2,apiName:l.HI.addMembersToThread}})),createThread:r((c=e.groupsServiceCreateGroupEndpoint||f,(e,t,i,n)=>{const r="true"===t[u.Q5.IsStickyThread],s=""===i,a=""===n,d={members:e.map((e=>({id:e.id,role:r?u.nL.User:u.nL.Admin}))),properties:t,inviterMri:s?void 0:i,inviteLink:a?void 0:n};return{url:c,method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(d),serviceName:o.EJ.GroupsServiceV2,apiName:l.HI.createThread}})).withTransform(v),deleteConversation:r(h(e.groupsServiceDeleteConversationEndpoint||S,e.groupsServiceThreadIdParameterToken||l.YK)),locationSharingQuery:r(p),removeMemberFromThread:r(g(e.groupsServiceRemoveFromRosterEndpoint||k,e.groupsServiceThreadIdParameterToken||l.YK,e.groupsServiceUserMriParameterToken||l.UQ)),updateConversationTopic:r(m(e.groupsServiceUpdatePropertiesEndpoint||w,e.groupsServiceThreadIdParameterToken||l.YK))};var c,d,b},T=e=>{const{coreSettings:t,platformService:i,authenticationResources:s,authenticationService:a,config:l}=e,c=t.get(n.J.ConsumerGroups);return{serviceName:o.EJ.GroupsServiceV2,baseUrlPromise:()=>e.discover.regionGtm(r.Pn.groupsServiceV2),authResource:I(a,s,b),models:_(c,i,l)}},I=(e,t,i)=>n=>e.getUser().then((()=>t.composeAuthResources((t=>e.authorizeRequest(t,i)),t.skypeXTokenAuthResource)(n)))},232894:(e,t,i)=>{"use strict";var n;i.d(t,{Ut:()=>n,$O:()=>r,Ms:()=>o,h:()=>s}),function(e){e.feed="TeamsFeed",e.syncFeed="TeamsFeedSync"}(n||(n={}));const r={defaultSection:"TeamsFeed",defaultTimeSortedSection:"TeamsFeedTimeSorted",defaultItemsToFetch:3,defaultLoadMoreItemsCount:5,defaultItemsToCompare:3,defaultReadSignalMinDwellTime:5e3,defaultDataSyncIntervalTime:3e5,defaultDiscoverTriagingTime:3e5,defaultServerCacheRetentionTimeInHrsSinceFirstCall:72,defaultDiscoverPollingInterval:3e5};var o,s;!function(e){e.api="api",e.indexDB="indexdb",e.cdlCache="cdlcache",e.apolloCache="apollocache",e.unknown="unknown"}(o||(o={})),function(e){e.polling="polling",e.startup="startup",e.switch="switch",e.scroll="scroll",e.removeContent="removeContent"}(s||(s={}))},867328:(e,t,i)=>{"use strict";var n,r,o;i.d(t,{Hw:()=>n,F4:()=>r,cL:()=>o}),function(e){e[e.Valid=0]="Valid",e[e.Expired=1]="Expired",e[e.NoData=2]="NoData",e[e.NoCache=3]="NoCache"}(n||(n={})),function(e){e.Filters="Filters",e.None="None",e.ConsumerKey="ConsumerKey"}(r||(r={})),function(e){e.OnExpiry="OnExpiry",e.Never="Never"}(o||(o={}))},704680:(e,t,i)=>{"use strict";var n;i.d(t,{m:()=>n}),function(e){e[e.Success=0]="Success",e[e.Success_NoChanges=1]="Success_NoChanges",e[e.Abandoned_ClientVeryActive=2]="Abandoned_ClientVeryActive",e[e.Abandoned_NoNetwork=3]="Abandoned_NoNetwork",e[e.Error_TimedOut=4]="Error_TimedOut",e[e.Error_TransformFailed=5]="Error_TransformFailed",e[e.Error_BrowserError=6]="Error_BrowserError",e[e.Error_Unknown=7]="Error_Unknown",e[e.NotStarted=8]="NotStarted"}(n||(n={}))},143285:(e,t,i)=>{"use strict";var n;i.d(t,{z:()=>n}),function(e){e[e.Manual=0]="Manual",e[e.WhenExpired=1]="WhenExpired"}(n||(n={}))},806982:(e,t,i)=>{"use strict";i.d(t,{bn:()=>k,fh:()=>w,un:()=>S});var n=i(142513),r=i(223005),o=i(143285),s=i(704680),a=i(867328),l=i(659334),c=i(974509),d=i(320225);const u=(e,t,i)=>Promise.resolve({constructRequest:(t,n,r)=>({apiName:"getConfiguration",url:e,method:"GET",headers:Object.assign(Object.assign({},i),r?{"If-None-Match":r}:void 0),correlationId:t}),customTelemetry:m,transformResponse:h(t),allowedResponses:[c.qb.OK,c.qb.NOT_MODIFIED,c.qb.CREATED,c.qb.NO_CONTENT]});function g(e,t,i){const n=function(e){return`${e.domain}/config/v1/${e.client}/`}(e),r=function(e){const t=[];if((0,d.forOwn)(e.filters,((e,i)=>{e&&t.push(`${i}=${e}`)})),e.agents){const i=e.agents.join(",");t.push(`agents=${i}`)}return`${e.version}?${t.join("&")}`}(e),o=function(e){const t=e.client,i=e.version;return{"X-ECS-Client-Last-Telemetry-Events":`ecs_client_library_name=EcsClientWeb,ecs_client_app_name=${t},ecs_client_version=${i}`}}(e);return{endpointUrl:`${n}${r}`,endpointModels:()=>({baseUrl:n,serviceName:t,models:{getConfigurationAsync:u(r,i,o)}})}}function m(e,t,i){return JSON.stringify({correlationId:e,serviceName:t,eTag:i,initialFetch:void 0===i})}const h=e=>t=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var i,n;switch(e.debug(`Response headers: ${JSON.stringify(t.headers)}`),t.status){case c.qb.OK:const e=yield t.body.json(),r=null!==(i=t.headers.expires)&&void 0!==i?i:e.Headers.Expires,o=null!==(n=t.headers.etag)&&void 0!==n?n:e.Headers.ETag;return{requestStatus:s.m.Success,ecsConfiguration:e,headers:p(r,o)};case c.qb.NOT_MODIFIED:case c.qb.CREATED:case c.qb.NO_CONTENT:return{requestStatus:s.m.Success_NoChanges,headers:p(t.headers.expires,t.headers.etag)};default:throw new Error(`Response status ${t.status} unexpectedly allowed`)}})),p=(e,t)=>{let i=Date.parse(e);if(isNaN(i)){const t=e.match(/\d+/g);if(t&&1===t.length&&(i=Number.parseInt(e,10)),isNaN(i))throw new Error(`Invalid or missing expiration date: '${e}'`)}if(!t)throw new Error("Missing etag value");return{ETag:t,Expires:new Date(i)}};class v{constructor(e,t,i){this.serviceName=e,this.ecsParameters=i,this.logger=t.newLogger(`EcsClient_${this.serviceName}`,"services-io-ecs")}initializeCache(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){this.cache={storage:e.storage,partitionOptions:{strategy:e.partitionBy||a.F4.None,excludeFilters:e.excludeFiltersFromPartition||[],consumerKey:e.consumerKey},invalidate:e.invalidateCache||a.cL.Never};const{configKey:t,metadataKey:i}=this.generateCacheKeys();try{const e=yield this.cache.storage.getItem(t),n=yield this.cache.storage.getItem(i);if(e){const i=JSON.parse(e),r=n?JSON.parse(n):{requestStatus:s.m.Success};this.data=Object.assign({ecsConfiguration:i},r),this.logger.log(`Cache successfully loaded: ${t}`)}else this.logger.log(`No cached data found: ${t}`)}catch(e){this.logger.log(`Error while loading from cache '${t}', error:`,e)}}))}get(){var e;return(null===(e=this.cache)||void 0===e?void 0:e.invalidate)===a.cL.OnExpiry&&this.cacheState===a.Hw.Expired&&(this.logger.log("Cache expired, clearing cache"),this.clearCache()),this.data}get expiration(){var e,t;const i=null===(t=null===(e=this.data)||void 0===e?void 0:e.headers)||void 0===t?void 0:t.Expires;return i&&new Date(i)}get cacheState(){return void 0===this.cache?a.Hw.NoCache:this.data?this.expiration&&this.expiration.valueOf()>Date.now()?a.Hw.Valid:a.Hw.Expired:a.Hw.NoData}getDiagnosticInfo(){return{expirationTime:this.expiration}}generateCacheKeys(){if(void 0===this.cache)throw new Error("Cannot generate keys until after initializeCache() is called");const{strategy:e,excludeFilters:t,consumerKey:i}=this.cache.partitionOptions;let n=`ecs.cache.${this.serviceName}`;switch(e){case a.F4.ConsumerKey:if(!i)throw new Error("Cannot generate key using PartitionStrategy.ConsumerKey if consumerKey is not provided");n=`${i}`;break;case a.F4.Filters:if(!this.ecsParameters)throw new Error("Cannot generate key using PartitionStrategy.Filters if ecsParameters is not set during instantiation");const e=this.ecsParameters.filters||{};t.length&&t.forEach((t=>{e[t]&&delete e[t]}));const r=Object.values(e).filter((e=>void 0!==e||null!==e));r.length&&(n+=`.${r.join(".")}`);break;case a.F4.None:}const r=`${n}.metadata`;return this.logger.debug(`Storage Keys calculated: ${n}, ${r}`),{configKey:n,metadataKey:r}}clearCache(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(this.data=void 0,void 0===this.cache)return;const{configKey:e,metadataKey:t}=this.generateCacheKeys();yield this.cache.storage.removeItem(e),yield this.cache.storage.removeItem(t),this.logger.log(`Cache for '${e}' and ${t} cleared.`)}))}}class y extends v{constructor(e,t,i,n,r,s,a){super(e,i,t),this.ecsParameters=t,this.endpointsManager=n,this.fetchPrecheck=r,this.transformData=s,this.fetchMode=o.z.Manual,this.clientType="EcsClient";const{endpointUrl:l,endpointModels:c}=g(this.ecsParameters,this.serviceName,this.logger);this.fetchUrl=l,this.ecsApi=this.endpointsManager.createApi(c),a&&(this.data=a.data,this.cache=a.cache)}fetch(){var e,t;return(0,n.__awaiter)(this,void 0,void 0,(function*(){const i=void 0===this.eTag,n=(0,l.v4)();this.lastAttemptedFetch=new Date,this.logger.log(`Getting ECS configuration from ${this.fetchUrl}. correlationId=${n}, isInitialFetch=${i}`);const r=(null===(e=this.fetchPrecheck)||void 0===e?void 0:e.call(this))||!0;if(!0!==r)return this.scheduleNextConfigurationFetch(),this.logger.debug(`${r.errorMessage}. correlationId=${n}`),{requestStatus:r.requestStatus};try{const e=yield this.ecsApi.getConfigurationAsync(n,this.serviceName,this.eTag);this.logger.log(`ECS configuration fetch complete. status=${s.m[e.requestStatus]}, correlationId=${n}, isInitialFetch=${i}`),this.data=this.onSuccess(e,n),this.configIds=null===(t=e.ecsConfiguration)||void 0===t?void 0:t.ConfigIDs,this.updateCache()}catch(e){return this.onError(e,n)}return this.scheduleNextConfigurationFetch(),this.data}))}startFetchSchedule(e,t){this.host=e,this.callbackFunction=t,this.fetchMode=o.z.WhenExpired,this.logger.debug("Starting ECS configuration fetch schedule in WhenExpired mode."),this.scheduleNextConfigurationFetch()}updateParameters(e){const t=this.fetchUrl,{endpointUrl:i,endpointModels:n}=g(e,this.serviceName,this.logger);return this.fetchUrl=i,this.ecsApi=this.endpointsManager.createApi(n),this.ecsParameters=e,t!==this.fetchUrl}dispose(){this.fetchMode=o.z.Manual,this.clearConfigurationFetchSchedule()}getDiagnosticInfo(){return{configIds:this.configIds,etag:this.eTag,fetchUrl:this.fetchUrl,lastAttemptedFetch:this.lastAttemptedFetch,lastSuccessfulFetch:this.lastSuccessfulFetch,nextScheduledFetch:this.nextScheduledFetch,fetchMode:this.fetchMode,expirationTime:this.expiration}}get eTag(){var e,t;return null===(t=null===(e=this.data)||void 0===e?void 0:e.headers)||void 0===t?void 0:t.ETag}updateCache(){var e;return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(void 0===this.cache)return;const{storage:t}=this.cache,{configKey:i,metadataKey:r}=this.generateCacheKeys();if(!(null===(e=this.data)||void 0===e?void 0:e.ecsConfiguration)||0===Object.keys(this.data.ecsConfiguration).length)return void this.logger.log(`updateCache() received empty data. Cache State: ${a.Hw[this.cacheState]} (Storage key: ${i})`);const o=this.data,{ecsConfiguration:s}=o,l=(0,n.__rest)(o,["ecsConfiguration"]);yield t.setItem(i,JSON.stringify(s)),yield t.setItem(r,JSON.stringify(l)),this.logger.log(`Cache '${i}' updated.`)}))}onSuccess(e,t){var i;let n;switch(e.requestStatus){case s.m.Success:if(!e.ecsConfiguration)throw new Error("ECS configuration is unexpectedly undefined on a successful response");if(!e.headers)throw new Error("Headers object is unexpectedly undefined on a successful response");n=(null===(i=this.transformData)||void 0===i?void 0:i.call(this,e))||e;break;case s.m.Success_NoChanges:if(!e.headers)throw new Error("Headers object is unexpectedly undefined on a successful response");n=Object.assign(Object.assign({},this.data),{requestStatus:e.requestStatus,headers:e.headers}),this.data=n,this.updateCache(),this.logger.debug(`ECS configuration is unchanged. eTag=${this.eTag}, correlationId=${t}`);break;default:throw new Error(`Received unexpected request status of ${s.m[e.requestStatus]}`)}return this.lastSuccessfulFetch=this.lastAttemptedFetch,n}onError(e,t){var i,n;const o=this.processErrorText(e,"unknown error");let a=s.m.Error_Unknown;switch(null==e?void 0:e.reason){case r.A.TimedOut:a=s.m.Error_TimedOut;break;case r.A.TransformFailed:a=s.m.Error_TransformFailed;break;default:a=(null==e?void 0:e.reason)===r.A.RejectHttpError&&void 0===(null===(i=null==e?void 0:e.serverResponse)||void 0===i?void 0:i.status)?s.m.Error_BrowserError:s.m.Error_Unknown}return this.logger.error(`Fetching ECS configuration failed. error=${e}, innerExceptionMessage=${null===(n=e.innerException)||void 0===n?void 0:n.message} correlationId=${t}`),{requestStatus:a,errorMessage:o}}processE